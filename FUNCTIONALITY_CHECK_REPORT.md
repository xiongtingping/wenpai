# åŠŸèƒ½æ¨¡å—è¯¦ç»†æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ¦‚è¿°

æœ¬æŠ¥å‘Šè¯¦ç»†æ£€æŸ¥äº†ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½æ¨¡å—çš„å®ç°æƒ…å†µï¼š
1. ç”¨æˆ·æ³¨å†Œç™»å½•åŠæƒé™åŠŸèƒ½
2. ç”¨æˆ·åç”ŸæˆåŠé‚€è¯·å¥–åŠ±å‘æ”¾
3. AIæ¥å£æœåŠ¡

## ğŸ” 1. ç”¨æˆ·æ³¨å†Œç™»å½•åŠæƒé™åŠŸèƒ½

### âœ… æ¶æ„è®¾è®¡
- **ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ**: åŸºäº Authing çš„å•ä¸€è®¤è¯æº
- **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ React Context ç»Ÿä¸€ç®¡ç†è®¤è¯çŠ¶æ€
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æƒé™å’Œè§’è‰²ç®¡ç†ç³»ç»Ÿ
- **ä¸´æ—¶ç”¨æˆ·**: æ”¯æŒæœªç™»å½•ç”¨æˆ·çš„ä¸´æ—¶IDç”Ÿæˆ

### âœ… æ ¸å¿ƒç»„ä»¶

#### AuthContext.tsx - ç»Ÿä¸€è®¤è¯ä¸Šä¸‹æ–‡
```typescript
// ä¸»è¦åŠŸèƒ½
- æ•´åˆ Authing Guard è®¤è¯
- ç»Ÿä¸€ç”¨æˆ·çŠ¶æ€ç®¡ç†
- æä¾›è®¤è¯æ–¹æ³•ï¼ˆloginã€registerã€logoutï¼‰
- è‡ªåŠ¨å¤„ç†è®¤è¯çŠ¶æ€æ£€æŸ¥
- äº‹ä»¶ç›‘å¬å’ŒçŠ¶æ€åŒæ­¥
- ä¸´æ—¶ç”¨æˆ·IDç®¡ç†
```

#### usePermissions.ts - æƒé™ç®¡ç†Hook
```typescript
// ä¸»è¦åŠŸèƒ½
- å¼€å‘ç¯å¢ƒæœ€é«˜æƒé™é…ç½®
- çœŸå®APIæƒé™è·å–
- ç»†ç²’åº¦æƒé™æ£€æŸ¥
- è§’è‰²éªŒè¯
- æƒé™åˆ·æ–°æœºåˆ¶
```

#### ProtectedRoute.tsx - è·¯ç”±ä¿æŠ¤
```typescript
// ä¸»è¦åŠŸèƒ½
- åŸºäºç»Ÿä¸€è®¤è¯ä¸Šä¸‹æ–‡
- ç®€åŒ–çš„æƒé™æ£€æŸ¥é€»è¾‘
- ç»Ÿä¸€çš„åŠ è½½çŠ¶æ€å¤„ç†
- æ¸…æ™°çš„é‡å®šå‘æœºåˆ¶
```

### âœ… åŠŸèƒ½ç‰¹æ€§

#### è®¤è¯æµç¨‹
1. **ä¸´æ—¶ç”¨æˆ·**: æœªç™»å½•ç”¨æˆ·è‡ªåŠ¨ç”Ÿæˆä¸´æ—¶ID
2. **æ­£å¼æ³¨å†Œ**: æ”¯æŒé‚®ç®±å’Œæ‰‹æœºå·æ³¨å†Œ
3. **ç™»å½•éªŒè¯**: åŸºäº Authing çš„èº«ä»½éªŒè¯
4. **çŠ¶æ€åŒæ­¥**: è‡ªåŠ¨åŒæ­¥è®¤è¯çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
5. **IDç»‘å®š**: ä¸´æ—¶ç”¨æˆ·IDç»‘å®šåˆ°æ­£å¼è´¦å·

#### æƒé™ç³»ç»Ÿ
1. **å¼€å‘ç¯å¢ƒ**: è‡ªåŠ¨è·å¾—æœ€é«˜æƒé™ï¼ˆä¾¿äºæµ‹è¯•ï¼‰
2. **ç”Ÿäº§ç¯å¢ƒ**: åŸºäºçœŸå®APIçš„æƒé™éªŒè¯
3. **æƒé™æ£€æŸ¥**: æ”¯æŒèµ„æºçº§åˆ«çš„æƒé™æ§åˆ¶
4. **è§’è‰²ç®¡ç†**: æ”¯æŒå¤šè§’è‰²æƒé™åˆ†é…
5. **åŠ¨æ€åˆ·æ–°**: æƒé™ä¿¡æ¯åŠ¨æ€æ›´æ–°

### âœ… å®‰å…¨ç‰¹æ€§
- **JWT Token**: åŸºäº Authing çš„ JWT è®¤è¯
- **çŠ¶æ€æŒä¹…åŒ–**: å®‰å…¨çš„æœ¬åœ°å­˜å‚¨ç®¡ç†
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **è¶…æ—¶æ§åˆ¶**: API è°ƒç”¨è¶…æ—¶ä¿æŠ¤

### âš ï¸ æ½œåœ¨é—®é¢˜
1. **ç½‘ç»œä¾èµ–**: å®Œå…¨ä¾èµ– Authing æœåŠ¡
2. **é…ç½®å¤æ‚**: Authing é…ç½®éœ€è¦æ­£ç¡®è®¾ç½®
3. **é”™è¯¯æ¢å¤**: ç½‘ç»œé”™è¯¯æ—¶çš„æ¢å¤æœºåˆ¶éœ€è¦å®Œå–„

---

## ğŸ 2. ç”¨æˆ·åç”ŸæˆåŠé‚€è¯·å¥–åŠ±å‘æ”¾

### âœ… æ¶æ„è®¾è®¡
- **çŠ¶æ€ç®¡ç†**: åŸºäº Zustand çš„ç”¨æˆ·çŠ¶æ€ç®¡ç†
- **é‚€è¯·ç³»ç»Ÿ**: å®Œæ•´çš„é‚€è¯·ç ç”Ÿæˆå’Œè·Ÿè¸ª
- **å¥–åŠ±æœºåˆ¶**: åŒå‘å¥–åŠ±ç³»ç»Ÿï¼ˆæ¨èäººå’Œè¢«æ¨èäººï¼‰
- **æ•°æ®æŒä¹…åŒ–**: æœ¬åœ°å­˜å‚¨å’Œæ•°æ®åº“åŒé‡è®°å½•

### âœ… æ ¸å¿ƒåŠŸèƒ½

#### userStore.ts - ç”¨æˆ·çŠ¶æ€ç®¡ç†
```typescript
// ä¸»è¦åŠŸèƒ½
- ä¸´æ—¶ç”¨æˆ·IDç®¡ç†
- é‚€è¯·ç ç”Ÿæˆå’Œè·Ÿè¸ª
- ä½¿ç”¨é‡ç®¡ç†
- æ¨èå¥–åŠ±å¤„ç†
- ç”¨æˆ·è¡Œä¸ºè®°å½•
```

#### é‚€è¯·ç³»ç»Ÿ
1. **é‚€è¯·ç ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€é‚€è¯·ç 
2. **é“¾æ¥åˆ†äº«**: æ”¯æŒé‚€è¯·é“¾æ¥ç”Ÿæˆå’Œå¤åˆ¶
3. **ç‚¹å‡»è·Ÿè¸ª**: è®°å½•é‚€è¯·é“¾æ¥ç‚¹å‡»æ¬¡æ•°
4. **æ³¨å†Œè·Ÿè¸ª**: è®°å½•æˆåŠŸé‚€è¯·çš„æ³¨å†Œæ•°
5. **å¥–åŠ±ç»Ÿè®¡**: ç»Ÿè®¡é‚€è¯·å¥–åŠ±å‘æ”¾æƒ…å†µ

#### å¥–åŠ±æœºåˆ¶
1. **åŒå‘å¥–åŠ±**: æ¨èäººå’Œè¢«æ¨èäººå„å¾—20æ¬¡ä½¿ç”¨æœºä¼š
2. **é˜²é‡å¤**: é˜²æ­¢é‡å¤å¥–åŠ±çš„æœºåˆ¶
3. **éªŒè¯æœºåˆ¶**: æ¨èäººIDæ ¼å¼éªŒè¯
4. **åç«¯é€šçŸ¥**: é€šçŸ¥åç«¯å‘æ”¾æ¨èäººå¥–åŠ±
5. **æœ¬åœ°è®°å½•**: æœ¬åœ°è®°å½•å¥–åŠ±å‘æ”¾çŠ¶æ€

### âœ… å®ç°ç»†èŠ‚

#### æ¨èäººIDå¤„ç†
```typescript
// ä»URLå‚æ•°ä¸­æå–æ¨èäººID
export function saveReferrerFromURL(): string | null {
  const urlParams = new URLSearchParams(window.location.search);
  const referrerId = urlParams.get('ref');
  
  if (referrerId && validateReferrerId(referrerId)) {
    localStorage.setItem('referrer-id', referrerId);
    return referrerId;
  }
  return null;
}
```

#### å¥–åŠ±å‘æ”¾æµç¨‹
```typescript
// å¤„ç†æ¨èå¥–åŠ±
processReferralReward: () => {
  // 1. éªŒè¯æ¨èäººID
  // 2. æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
  // 3. ç»™è¢«æ¨èäººå¢åŠ 20æ¬¡ä½¿ç”¨æœºä¼š
  // 4. é€šçŸ¥åç«¯ç»™æ¨èäººå¢åŠ 20æ¬¡ä½¿ç”¨æœºä¼š
  // 5. æ ‡è®°å·²å¤„ç†ï¼Œé¿å…é‡å¤å¥–åŠ±
  // 6. æ¸…é™¤æ¨èäººID
}
```

#### é‚€è¯·ç»Ÿè®¡
```typescript
// é‚€è¯·ç»Ÿè®¡æ•°æ®ç»“æ„
interface UserInviteStats {
  totalClicks: number;        // æ€»ç‚¹å‡»æ¬¡æ•°
  totalRegistrations: number; // æ€»æ³¨å†Œæ•°
  totalRewards: number;       // æ€»å¥–åŠ±æ•°
}
```

### âœ… åç«¯æ”¯æŒ

#### Netlify Functions
```javascript
// æ¨èå¥–åŠ±å¤„ç†å‡½æ•°
async function handleReferralReward(event) {
  // 1. ç»™æ¨èäººå¢åŠ ä½¿ç”¨æ¬¡æ•°
  // 2. ç»™è¢«æ¨èäººå¢åŠ ä½¿ç”¨æ¬¡æ•°
  // 3. è®°å½•æ¨èå¥–åŠ±
  // 4. è¿”å›æ›´æ–°åçš„ä½¿ç”¨æ¬¡æ•°
}
```

### âœ… ç”¨æˆ·ä½“éªŒ
1. **å®æ—¶åé¦ˆ**: é‚€è¯·é“¾æ¥å¤åˆ¶æˆåŠŸæç¤º
2. **å¥–åŠ±æç¤º**: æ³¨å†ŒæˆåŠŸåæ˜¾ç¤ºå¥–åŠ±ä¿¡æ¯
3. **ç»Ÿè®¡å±•ç¤º**: ä¸ªäººä¸­å¿ƒæ˜¾ç¤ºé‚€è¯·ç»Ÿè®¡
4. **é˜²é‡å¤**: é¿å…é‡å¤å¥–åŠ±çš„ç”¨æˆ·æç¤º

### âš ï¸ æ½œåœ¨é—®é¢˜
1. **æ•°æ®ä¸€è‡´æ€§**: æœ¬åœ°å­˜å‚¨å’Œæ•°æ®åº“æ•°æ®åŒæ­¥
2. **ç½‘ç»œå¼‚å¸¸**: å¥–åŠ±å‘æ”¾å¤±è´¥çš„å¤„ç†æœºåˆ¶
3. **æ¶æ„åˆ©ç”¨**: é˜²æ­¢é‚€è¯·ç³»ç»Ÿçš„æ¶æ„åˆ©ç”¨

---

## ğŸ¤– 3. AIæ¥å£æœåŠ¡

### âœ… æ¶æ„è®¾è®¡
- **ç»Ÿä¸€æœåŠ¡å±‚**: åŸºäº `aiService.ts` çš„ç»Ÿä¸€AIè°ƒç”¨æ¥å£
- **ç¯å¢ƒé€‚é…**: å¼€å‘ç¯å¢ƒç›´æ¥è°ƒç”¨ï¼Œç”Ÿäº§ç¯å¢ƒé€šè¿‡ä»£ç†
- **å¤šæä¾›å•†æ”¯æŒ**: æ”¯æŒ OpenAIã€DeepSeekã€Gemini
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### âœ… æ ¸å¿ƒåŠŸèƒ½

#### aiService.ts - ç»Ÿä¸€AIæœåŠ¡
```typescript
// ä¸»è¦åŠŸèƒ½
- æ–‡æœ¬ç”Ÿæˆï¼ˆGPT-4oç­‰ï¼‰
- å›¾åƒç”Ÿæˆï¼ˆDALL-Eï¼‰
- å†…å®¹åˆ†æ
- å†…å®¹é€‚é…
- æ‰¹é‡å¤„ç†
- çŠ¶æ€æ£€æŸ¥
```

#### æ”¯æŒçš„AIåŠŸèƒ½
1. **æ–‡æœ¬ç”Ÿæˆ**: åˆ›æ„æ–‡æ¡ˆã€å†…å®¹æ€»ç»“ã€å“ç‰Œåˆ†æ
2. **å›¾åƒç”Ÿæˆ**: Emojiç”Ÿæˆã€å“ç‰Œå›¾åƒã€åˆ›æ„å›¾ç‰‡
3. **å†…å®¹åˆ†æ**: å“ç‰Œè°ƒæ€§åˆ†æã€å†…å®¹è´¨é‡æ£€æŸ¥
4. **å†…å®¹é€‚é…**: å¤šå¹³å°å†…å®¹é€‚é…
5. **æ‰¹é‡å¤„ç†**: æ‰¹é‡å›¾åƒç”Ÿæˆã€æ‰¹é‡æ–‡æœ¬å¤„ç†

### âœ… æŠ€æœ¯ç‰¹æ€§

#### ç¯å¢ƒé€‚é…
```typescript
// å¼€å‘ç¯å¢ƒï¼šç›´æ¥è°ƒç”¨OpenAI API
if (this.useDevProxy && provider === 'openai') {
  return await this.callOpenAIDevProxy({
    messages,
    model,
    temperature,
    maxTokens
  });
} else {
  // ç”Ÿäº§ç¯å¢ƒï¼šé€šè¿‡Netlifyå‡½æ•°ä»£ç†
  return await this.callNetlifyProxy({
    provider,
    action: 'generate',
    messages,
    model,
    temperature,
    maxTokens
  });
}
```

#### é‡è¯•æœºåˆ¶
```typescript
// å¸¦é‡è¯•çš„AIè°ƒç”¨
for (let attempt = 1; attempt <= DEFAULT_CONFIG.maxRetries; attempt++) {
  try {
    // AIè°ƒç”¨é€»è¾‘
  } catch (error) {
    if (attempt === DEFAULT_CONFIG.maxRetries) {
      return { success: false, error: 'è°ƒç”¨å¤±è´¥' };
    }
    // ç­‰å¾…åé‡è¯•
    await new Promise(resolve => setTimeout(resolve, DEFAULT_CONFIG.retryDelay * attempt));
  }
}
```

#### è¶…æ—¶æ§åˆ¶
```typescript
// 30ç§’è¶…æ—¶æ§åˆ¶
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), DEFAULT_CONFIG.timeout);

const response = await fetch(API_ENDPOINTS.DEV, {
  signal: controller.signal,
  // ... å…¶ä»–é…ç½®
});

clearTimeout(timeoutId);
```

### âœ… é…ç½®ç®¡ç†

#### ç¯å¢ƒå˜é‡
```bash
# OpenAI API é…ç½®
VITE_OPENAI_API_KEY=sk-your-openai-api-key

# DeepSeek API é…ç½®ï¼ˆå¯é€‰ï¼‰
VITE_DEEPSEEK_API_KEY=sk-your-deepseek-api-key

# Google Gemini API é…ç½®ï¼ˆå¯é€‰ï¼‰
VITE_GEMINI_API_KEY=your-gemini-api-key
```

#### é»˜è®¤é…ç½®
```typescript
const DEFAULT_CONFIG = {
  model: 'gpt-4o',
  temperature: 0.7,
  maxTokens: 1000,
  timeout: 30000,
  maxRetries: 3,
  retryDelay: 1000
};
```

### âœ… åç«¯æ”¯æŒ

#### Netlify Functions
```javascript
// æ”¯æŒå¤šç§AIæä¾›å•†
switch (provider) {
  case 'openai':
    return await generateWithOpenAI(requestBody, headers);
  case 'deepseek':
    return await generateWithDeepSeek(requestBody, headers);
  case 'gemini':
    return await generateWithGemini(requestBody, headers);
}
```

#### å›¾åƒç”Ÿæˆ
```javascript
// DALL-E å›¾åƒç”Ÿæˆ
async function generateImage(requestBody, headers) {
  const { prompt, n = 1, size = '512x512' } = requestBody;
  
  const response = await fetch('https://api.openai.com/v1/images/generations', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      prompt,
      n,
      size,
      response_format: 'url'
    })
  });
}
```

### âœ… ç»„ä»¶é›†æˆ

#### å·²è¿ç§»çš„ç»„ä»¶
1. **AISummarizer.tsx**: ä½¿ç”¨ `aiService.summarizeContent()`
2. **EmojiGenerator.tsx**: ä½¿ç”¨ `aiService.generateImage()`
3. **BrandEmojiGenerator.tsx**: ä½¿ç”¨ `aiService.generateImage()`
4. **CreativeCube.tsx**: ä½¿ç”¨ `aiService.generateCreativeContent()`
5. **ContentExtractorPage.tsx**: ä½¿ç”¨ `aiService.extractContent()`
6. **MomentsTextGenerator.tsx**: ä½¿ç”¨ `aiService.generateCreativeContent()`

### âœ… é”™è¯¯å¤„ç†
1. **ç½‘ç»œé”™è¯¯**: ç½‘ç»œè¿æ¥å¤±è´¥çš„å¤„ç†
2. **APIé”™è¯¯**: OpenAI API é”™è¯¯å“åº”å¤„ç†
3. **è¶…æ—¶é”™è¯¯**: è¯·æ±‚è¶…æ—¶çš„å¤„ç†
4. **é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
5. **ç”¨æˆ·åé¦ˆ**: å‹å¥½çš„é”™è¯¯æç¤º

### âš ï¸ æ½œåœ¨é—®é¢˜
1. **APIé™åˆ¶**: OpenAI API è°ƒç”¨é¢‘ç‡é™åˆ¶
2. **æˆæœ¬æ§åˆ¶**: API è°ƒç”¨æˆæœ¬ç®¡ç†
3. **ç½‘ç»œä¾èµ–**: å®Œå…¨ä¾èµ–å¤–éƒ¨AIæœåŠ¡
4. **æ•°æ®å®‰å…¨**: ç”¨æˆ·æ•°æ®åœ¨AIæœåŠ¡ä¸­çš„å¤„ç†

---

## ğŸ“Š æ€»ä½“è¯„ä¼°

### âœ… ä¼˜åŠ¿
1. **æ¶æ„ç»Ÿä¸€**: ä¸‰ä¸ªæ¨¡å—éƒ½æœ‰ç»Ÿä¸€çš„æ¶æ„è®¾è®¡
2. **åŠŸèƒ½å®Œæ•´**: è¦†ç›–äº†æ ¸å¿ƒä¸šåŠ¡éœ€æ±‚
3. **ç”¨æˆ·ä½“éªŒ**: è‰¯å¥½çš„ç”¨æˆ·äº¤äº’è®¾è®¡
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
5. **æ‰©å±•æ€§**: è‰¯å¥½çš„æ‰©å±•æ€§è®¾è®¡

### âš ï¸ æ”¹è¿›å»ºè®®
1. **ç›‘æ§å‘Šè­¦**: æ·»åŠ ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
2. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–APIè°ƒç”¨æ€§èƒ½
3. **å®‰å…¨åŠ å›º**: åŠ å¼ºæ•°æ®å®‰å…¨ä¿æŠ¤
4. **æµ‹è¯•è¦†ç›–**: å¢åŠ è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–
5. **æ–‡æ¡£å®Œå–„**: å®Œå–„æŠ€æœ¯æ–‡æ¡£

### ğŸ¯ ä¼˜å…ˆçº§å»ºè®®
1. **é«˜ä¼˜å…ˆçº§**: å®Œå–„é”™è¯¯æ¢å¤æœºåˆ¶
2. **ä¸­ä¼˜å…ˆçº§**: æ·»åŠ ç³»ç»Ÿç›‘æ§
3. **ä½ä¼˜å…ˆçº§**: æ€§èƒ½ä¼˜åŒ–å’Œæ–‡æ¡£å®Œå–„

## ğŸ“ ç»“è®º

ä¸‰ä¸ªåŠŸèƒ½æ¨¡å—éƒ½å®ç°äº†å®Œæ•´çš„åŠŸèƒ½ï¼Œæ¶æ„è®¾è®¡åˆç†ï¼Œä»£ç è´¨é‡è¾ƒé«˜ã€‚å»ºè®®é‡ç‚¹å…³æ³¨é”™è¯¯å¤„ç†å’Œç³»ç»Ÿç›‘æ§ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ 