<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authing Guard å·¥ä½œæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
    <!-- ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ -->
    <link rel="stylesheet" href="/public/authing-guard.min.css">
</head>
<body>
    <div class="container">
        <h1>Authing Guard å·¥ä½œæµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. åˆå§‹åŒ–çŠ¶æ€</h3>
            <div id="initStatus" class="status info">æ­£åœ¨åˆå§‹åŒ– AuthingGuard...</div>
            <button onclick="checkInitStatus()">æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€</button>
        </div>

        <div class="test-section">
            <h3>2. ç™»å½•å¼¹çª—æµ‹è¯•</h3>
            <button onclick="showLogin()">æ˜¾ç¤ºç™»å½•å¼¹çª—</button>
            <button onclick="showRegister()">æ˜¾ç¤ºæ³¨å†Œå¼¹çª—</button>
            <div id="loginStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>3. è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugInfo" class="status info">
                <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong><br>
                <div id="debugContent"></div>
            </div>
            <button onclick="updateDebugInfo()">æ›´æ–°è°ƒè¯•ä¿¡æ¯</button>
        </div>
    </div>

    <!-- ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ -->
    <script src="/public/authing-guard.min.js"></script>

    <script>
        let guard = null;

        // æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
        function checkInitStatus() {
            const statusDiv = document.getElementById('initStatus');
            
            if (typeof GuardFactory === 'undefined') {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ GuardFactory æœªåŠ è½½';
                return;
            }

            if (typeof GuardFactory.Guard === 'undefined') {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ GuardFactory.Guard æœªæ‰¾åˆ°';
                return;
            }

            if (typeof GuardFactory.Guard !== 'function') {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ GuardFactory.Guard ä¸æ˜¯å‡½æ•°';
                return;
            }

            statusDiv.className = 'status success';
            statusDiv.innerHTML = 'âœ… GuardFactory.Guard æ„é€ å‡½æ•°å·²æ‰¾åˆ°ï¼';
            
            if (!guard) {
                initializeGuard();
            }
        }

        // åˆå§‹åŒ– Guard
        function initializeGuard() {
            try {
                console.log('ä½¿ç”¨ GuardFactory.Guard åˆå§‹åŒ–...');
                
                guard = new GuardFactory.Guard({
                    appId: '6867fdc88034eb95ae86167d', // çœŸå®çš„ App ID
                    host: 'https://qutkgzkfaezk-demo.authing.cn', // Authing åº”ç”¨åŸŸå
                    requestHostname: 'https://qutkgzkfaezk-demo.authing.cn', // è¯·æ±‚åŸŸå
                    redirectUri: `${window.location.origin}/callback`, // é‡å®šå‘ URI
                    mode: 'modal',
                    config: {
                        mode: 'modal',
                        defaultScenes: 'login',
                        // å¼¹çª—æ¨¡å¼é¢å¤–é…ç½®
                        autoRegister: false,
                        skipComplateFileds: false,
                        skipComplateFiledsPlace: 'modal',
                        closeable: true,
                        clickCloseableMask: true,
                        // ç™»å½•é…ç½®
                        loginMethodList: ['password', 'phone-code', 'email-code'],
                        // æ³¨å†Œé…ç½®
                        registerMethodList: ['phone', 'email'],
                        // ç•Œé¢é…ç½®
                        logo: 'https://cdn.authing.co/authing-console/logo.png',
                        title: 'æ–‡æ´¾',
                        // å›½é™…åŒ–
                        lang: 'zh-CN',
                    }
                });

                console.log('Guard å®ä¾‹åˆ›å»ºæˆåŠŸ:', guard);

                // ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
                guard.on('login', (user) => {
                    console.log('ç™»å½•æˆåŠŸ:', user);
                    document.getElementById('loginStatus').className = 'status success';
                    document.getElementById('loginStatus').innerHTML = `âœ… ç™»å½•æˆåŠŸï¼ç”¨æˆ·: ${user.username || user.email || 'æœªçŸ¥ç”¨æˆ·'}`;
                    
                    // ç™»å½•æˆåŠŸåè‡ªåŠ¨å…³é—­å¼¹çª—
                    setTimeout(() => {
                        guard.hide();
                        document.getElementById('loginStatus').innerHTML += '<br>ğŸ”„ æ­£åœ¨è‡ªåŠ¨å…³é—­å¼¹çª—...';
                    }, 1000);
                });

                // ç›‘å¬ç™»å½•å¤±è´¥äº‹ä»¶
                guard.on('login-error', (error) => {
                    console.log('ç™»å½•å¤±è´¥:', error);
                    document.getElementById('loginStatus').className = 'status error';
                    document.getElementById('loginStatus').innerHTML = `âŒ ç™»å½•å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`;
                });

                // ç›‘å¬å…³é—­äº‹ä»¶
                guard.on('close', () => {
                    console.log('å¼¹çª—å·²å…³é—­');
                    document.getElementById('loginStatus').className = 'status info';
                    document.getElementById('loginStatus').innerHTML = 'â„¹ï¸ ç™»å½•å¼¹çª—å·²å…³é—­';
                });

                document.getElementById('initStatus').className = 'status success';
                document.getElementById('initStatus').innerHTML = 'âœ… AuthingGuard åˆå§‹åŒ–æˆåŠŸï¼';

                updateDebugInfo();
            } catch (error) {
                console.error('åˆå§‹åŒ– Guard å¤±è´¥:', error);
                document.getElementById('initStatus').className = 'status error';
                document.getElementById('initStatus').innerHTML = `âŒ åˆå§‹åŒ– Guard å¤±è´¥: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºç™»å½•å¼¹çª—
        function showLogin() {
            if (!guard) {
                document.getElementById('loginStatus').className = 'status error';
                document.getElementById('loginStatus').innerHTML = 'âŒ Guard æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆç­‰å¾…åŠ è½½å®Œæˆ';
                return;
            }

            try {
                guard.show();
                document.getElementById('loginStatus').className = 'status info';
                document.getElementById('loginStatus').innerHTML = 'â„¹ï¸ æ­£åœ¨æ˜¾ç¤ºç™»å½•å¼¹çª—...';
            } catch (error) {
                console.error('æ˜¾ç¤ºç™»å½•å¼¹çª—å¤±è´¥:', error);
                document.getElementById('loginStatus').className = 'status error';
                document.getElementById('loginStatus').innerHTML = `âŒ æ˜¾ç¤ºç™»å½•å¼¹çª—å¤±è´¥: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºæ³¨å†Œå¼¹çª—
        function showRegister() {
            if (!guard) {
                document.getElementById('loginStatus').className = 'status error';
                document.getElementById('loginStatus').innerHTML = 'âŒ Guard æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆç­‰å¾…åŠ è½½å®Œæˆ';
                return;
            }

            try {
                guard.startRegister();
                document.getElementById('loginStatus').className = 'status info';
                document.getElementById('loginStatus').innerHTML = 'â„¹ï¸ æ­£åœ¨æ˜¾ç¤ºæ³¨å†Œå¼¹çª—...';
            } catch (error) {
                console.error('æ˜¾ç¤ºæ³¨å†Œå¼¹çª—å¤±è´¥:', error);
                document.getElementById('loginStatus').className = 'status error';
                document.getElementById('loginStatus').innerHTML = `âŒ æ˜¾ç¤ºæ³¨å†Œå¼¹çª—å¤±è´¥: ${error.message}`;
            }
        }

        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const debugContent = document.getElementById('debugContent');
            const info = {
                timestamp: new Date().toLocaleString(),
                guardFactoryLoaded: typeof GuardFactory !== 'undefined',
                guardConstructorLoaded: typeof GuardFactory?.Guard === 'function',
                guardInstance: guard ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–',
                windowObjects: Object.keys(window).filter(key => 
                    key.toLowerCase().includes('authing') || 
                    key.toLowerCase().includes('guard') ||
                    key.toLowerCase().includes('factory')
                ),
                userAgent: navigator.userAgent,
                localFiles: {
                    js: '/public/authing-guard.min.js',
                    css: '/public/authing-guard.min.css'
                }
            };

            debugContent.innerHTML = `<pre>${JSON.stringify(info, null, 2)}</pre>`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkInitStatus, 1000);
        });

        // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
        setInterval(updateDebugInfo, 5000);
    </script>
</body>
</html> 