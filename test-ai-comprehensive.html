<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåŠŸèƒ½å…¨é¢æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #007acc;
            background: #f8f9fa;
        }
        .test-result.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-result.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .test-result.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .image-result {
            max-width: 200px;
            margin: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online {
            background: #28a745;
        }
        .status-offline {
            background: #dc3545;
        }
        .status-warning {
            background: #ffc107;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .loading {
            color: #007acc;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– AIåŠŸèƒ½å…¨é¢æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ APIè¿æ¥çŠ¶æ€æµ‹è¯•</h2>
        <button onclick="testAPIStatus()">æµ‹è¯•APIè¿æ¥çŠ¶æ€</button>
        <div id="api-status-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ–¼ï¸ å›¾åƒç”Ÿæˆæµ‹è¯•</h2>
        <button onclick="testImageGeneration()">æµ‹è¯•å›¾åƒç”Ÿæˆ</button>
        <button onclick="testBatchImageGeneration()">æµ‹è¯•æ‰¹é‡å›¾åƒç”Ÿæˆ</button>
        <div id="image-generation-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æ–‡æœ¬ç”Ÿæˆæµ‹è¯•</h2>
        <button onclick="testTextGeneration()">æµ‹è¯•æ–‡æœ¬ç”Ÿæˆ</button>
        <button onclick="testContentSummarization()">æµ‹è¯•å†…å®¹æ‘˜è¦</button>
        <button onclick="testBrandAnalysis()">æµ‹è¯•å“ç‰Œåˆ†æ</button>
        <div id="text-generation-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¨ åˆ›æ„å†…å®¹æµ‹è¯•</h2>
        <button onclick="testEmojiRecommendation()">æµ‹è¯•Emojiæ¨è</button>
        <button onclick="testCreativeContent()">æµ‹è¯•åˆ›æ„å†…å®¹ç”Ÿæˆ</button>
        <div id="creative-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”„ å†…å®¹é€‚é…æµ‹è¯•</h2>
        <button onclick="testContentAdaptation()">æµ‹è¯•å†…å®¹é€‚é…</button>
        <div id="adaptation-result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <div id="test-summary"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8888/.netlify/functions/api';
        let testResults = {};

        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `
                <span class="status-indicator status-${type === 'success' ? 'online' : type === 'error' ? 'offline' : 'warning'}"></span>
                ${message}
            `;
            container.appendChild(resultDiv);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testAPIStatus() {
            clearResults('api-status-result');
            addResult('api-status-result', 'æ­£åœ¨æµ‹è¯•APIè¿æ¥çŠ¶æ€...', 'info');

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        provider: 'openai',
                        action: 'status'
                    })
                });

                const data = await response.json();
                
                if (data.success && data.available) {
                    addResult('api-status-result', 
                        `âœ… APIè¿æ¥æ­£å¸¸ï¼å“åº”æ—¶é—´: ${data.responseTime}ms`, 'success');
                    testResults.apiStatus = true;
                } else {
                    addResult('api-status-result', 
                        `âŒ APIè¿æ¥å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.apiStatus = false;
                }
            } catch (error) {
                addResult('api-status-result', 
                    `âŒ APIè¿æ¥é”™è¯¯: ${error.message}`, 'error');
                testResults.apiStatus = false;
            }
        }

        async function testImageGeneration() {
            clearResults('image-generation-result');
            addResult('image-generation-result', 'æ­£åœ¨æµ‹è¯•å›¾åƒç”Ÿæˆ...', 'info');

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        provider: 'openai',
                        action: 'generate-image',
                        prompt: 'ä¸€åªå¯çˆ±çš„å°çŒ«ï¼Œå¡é€šé£æ ¼ï¼Œé€æ˜èƒŒæ™¯',
                        n: 1,
                        size: '512x512'
                    })
                });

                const data = await response.json();
                
                if (data.success && data.data?.images?.length > 0) {
                    addResult('image-generation-result', 
                        'âœ… å›¾åƒç”ŸæˆæˆåŠŸï¼', 'success');
                    
                    const imageUrl = data.data.images[0].url;
                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.className = 'image-result';
                    img.alt = 'ç”Ÿæˆçš„å›¾åƒ';
                    document.getElementById('image-generation-result').appendChild(img);
                    
                    testResults.imageGeneration = true;
                } else {
                    addResult('image-generation-result', 
                        `âŒ å›¾åƒç”Ÿæˆå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.imageGeneration = false;
                }
            } catch (error) {
                addResult('image-generation-result', 
                    `âŒ å›¾åƒç”Ÿæˆé”™è¯¯: ${error.message}`, 'error');
                testResults.imageGeneration = false;
            }
        }

        async function testBatchImageGeneration() {
            clearResults('image-generation-result');
            addResult('image-generation-result', 'æ­£åœ¨æµ‹è¯•æ‰¹é‡å›¾åƒç”Ÿæˆ...', 'info');

            const prompts = [
                'ä¸€åªå¯çˆ±çš„å°ç‹—',
                'ä¸€æœµç¾ä¸½çš„èŠ±',
                'ä¸€ä¸ªç§‘æŠ€æ„Ÿçš„æœºå™¨äºº'
            ];

            try {
                const promises = prompts.map(prompt => 
                    fetch(API_BASE, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            provider: 'openai',
                            action: 'generate-image',
                            prompt: prompt,
                            n: 1,
                            size: '256x256'
                        })
                    }).then(res => res.json())
                );

                const results = await Promise.all(promises);
                const successCount = results.filter(r => r.success).length;
                
                if (successCount === prompts.length) {
                    addResult('image-generation-result', 
                        `âœ… æ‰¹é‡å›¾åƒç”ŸæˆæˆåŠŸï¼${successCount}/${prompts.length}`, 'success');
                    
                    results.forEach((result, index) => {
                        if (result.success && result.data?.images?.length > 0) {
                            const img = document.createElement('img');
                            img.src = result.data.images[0].url;
                            img.className = 'image-result';
                            img.alt = `æ‰¹é‡ç”Ÿæˆå›¾åƒ ${index + 1}`;
                            document.getElementById('image-generation-result').appendChild(img);
                        }
                    });
                    
                    testResults.batchImageGeneration = true;
                } else {
                    addResult('image-generation-result', 
                        `âš ï¸ æ‰¹é‡å›¾åƒç”Ÿæˆéƒ¨åˆ†æˆåŠŸ: ${successCount}/${prompts.length}`, 'warning');
                    testResults.batchImageGeneration = false;
                }
            } catch (error) {
                addResult('image-generation-result', 
                    `âŒ æ‰¹é‡å›¾åƒç”Ÿæˆé”™è¯¯: ${error.message}`, 'error');
                testResults.batchImageGeneration = false;
            }
        }

        async function testTextGeneration() {
            clearResults('text-generation-result');
            addResult('text-generation-result', 'æ­£åœ¨æµ‹è¯•æ–‡æœ¬ç”Ÿæˆ...', 'info');

            try {
                // ç”±äºå¼€å‘APIæœåŠ¡å™¨ä¸æ”¯æŒæ–‡æœ¬ç”Ÿæˆï¼Œæˆ‘ä»¬æµ‹è¯•å‰ç«¯AIæœåŠ¡
                const response = await fetch('/api/ai/generate-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'user', content: 'è¯·ç”¨ä¸€å¥è¯ä»‹ç»AIæŠ€æœ¯' }
                        ],
                        model: 'gpt-4o',
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('text-generation-result', 
                        `âœ… æ–‡æœ¬ç”ŸæˆæˆåŠŸï¼å†…å®¹: ${data.data?.content || 'æ— å†…å®¹'}`, 'success');
                    testResults.textGeneration = true;
                } else {
                    addResult('text-generation-result', 
                        `âŒ æ–‡æœ¬ç”Ÿæˆå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.textGeneration = false;
                }
            } catch (error) {
                addResult('text-generation-result', 
                    `âŒ æ–‡æœ¬ç”Ÿæˆé”™è¯¯: ${error.message}`, 'error');
                testResults.textGeneration = false;
            }
        }

        async function testContentSummarization() {
            clearResults('text-generation-result');
            addResult('text-generation-result', 'æ­£åœ¨æµ‹è¯•å†…å®¹æ‘˜è¦...', 'info');

            const testContent = `
                AIæŠ€æœ¯æ­£åœ¨å¿«é€Ÿå‘å±•ï¼Œä»æœºå™¨å­¦ä¹ åˆ°æ·±åº¦å­¦ä¹ ï¼Œä»è‡ªç„¶è¯­è¨€å¤„ç†åˆ°è®¡ç®—æœºè§†è§‰ï¼Œ
                å„ä¸ªé¢†åŸŸéƒ½å–å¾—äº†é‡å¤§çªç ´ã€‚è¿™äº›æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼ï¼Œä»æ™ºèƒ½æ‰‹æœºåŠ©æ‰‹
                åˆ°è‡ªåŠ¨é©¾é©¶æ±½è½¦ï¼Œä»åŒ»ç–—è¯Šæ–­åˆ°é‡‘èåˆ†æï¼ŒAIçš„åº”ç”¨æ— å¤„ä¸åœ¨ã€‚
            `;

            try {
                const response = await fetch('/api/ai/summarize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: testContent
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('text-generation-result', 
                        `âœ… å†…å®¹æ‘˜è¦æˆåŠŸï¼æ‘˜è¦: ${data.data?.summary || 'æ— æ‘˜è¦'}`, 'success');
                    testResults.contentSummarization = true;
                } else {
                    addResult('text-generation-result', 
                        `âŒ å†…å®¹æ‘˜è¦å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.contentSummarization = false;
                }
            } catch (error) {
                addResult('text-generation-result', 
                    `âŒ å†…å®¹æ‘˜è¦é”™è¯¯: ${error.message}`, 'error');
                testResults.contentSummarization = false;
            }
        }

        async function testBrandAnalysis() {
            clearResults('text-generation-result');
            addResult('text-generation-result', 'æ­£åœ¨æµ‹è¯•å“ç‰Œåˆ†æ...', 'info');

            const testContent = 'æˆ‘ä»¬æ˜¯ä¸€ä¸ªä¸“æ³¨äºAIæŠ€æœ¯çš„åˆ›æ–°å…¬å¸ï¼Œè‡´åŠ›äºä¸ºç”¨æˆ·æä¾›æ™ºèƒ½åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚';

            try {
                const response = await fetch('/api/ai/analyze-brand', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: testContent
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('text-generation-result', 
                        `âœ… å“ç‰Œåˆ†ææˆåŠŸï¼åˆ†æç»“æœ: ${JSON.stringify(data.data, null, 2)}`, 'success');
                    testResults.brandAnalysis = true;
                } else {
                    addResult('text-generation-result', 
                        `âŒ å“ç‰Œåˆ†æå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.brandAnalysis = false;
                }
            } catch (error) {
                addResult('text-generation-result', 
                    `âŒ å“ç‰Œåˆ†æé”™è¯¯: ${error.message}`, 'error');
                testResults.brandAnalysis = false;
            }
        }

        async function testEmojiRecommendation() {
            clearResults('creative-result');
            addResult('creative-result', 'æ­£åœ¨æµ‹è¯•Emojiæ¨è...', 'info');

            const testContext = 'ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œå¿ƒæƒ…æ„‰å¿«';

            try {
                const response = await fetch('/api/ai/recommend-emojis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        context: testContext
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('creative-result', 
                        `âœ… Emojiæ¨èæˆåŠŸï¼æ¨è: ${data.data?.emojis?.join(' ') || 'æ— æ¨è'}`, 'success');
                    testResults.emojiRecommendation = true;
                } else {
                    addResult('creative-result', 
                        `âŒ Emojiæ¨èå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.emojiRecommendation = false;
                }
            } catch (error) {
                addResult('creative-result', 
                    `âŒ Emojiæ¨èé”™è¯¯: ${error.message}`, 'error');
                testResults.emojiRecommendation = false;
            }
        }

        async function testCreativeContent() {
            clearResults('creative-result');
            addResult('creative-result', 'æ­£åœ¨æµ‹è¯•åˆ›æ„å†…å®¹ç”Ÿæˆ...', 'info');

            try {
                const response = await fetch('/api/ai/generate-creative', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: 'ä¸ºä¸€å®¶ç§‘æŠ€å…¬å¸å†™ä¸€æ®µåˆ›æ„å¹¿å‘Šæ–‡æ¡ˆ',
                        contentType: 'text'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('creative-result', 
                        `âœ… åˆ›æ„å†…å®¹ç”ŸæˆæˆåŠŸï¼å†…å®¹: ${data.data?.content || 'æ— å†…å®¹'}`, 'success');
                    testResults.creativeContent = true;
                } else {
                    addResult('creative-result', 
                        `âŒ åˆ›æ„å†…å®¹ç”Ÿæˆå¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.creativeContent = false;
                }
            } catch (error) {
                addResult('creative-result', 
                    `âŒ åˆ›æ„å†…å®¹ç”Ÿæˆé”™è¯¯: ${error.message}`, 'error');
                testResults.creativeContent = false;
            }
        }

        async function testContentAdaptation() {
            clearResults('adaptation-result');
            addResult('adaptation-result', 'æ­£åœ¨æµ‹è¯•å†…å®¹é€‚é…...', 'info');

            const testContent = 'æˆ‘ä»¬æ¨å‡ºäº†æ–°çš„AIäº§å“ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨ç®€å•ã€‚';
            const targetPlatforms = ['weibo', 'xiaohongshu'];

            try {
                const response = await fetch('/api/ai/adapt-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: testContent,
                        platforms: targetPlatforms
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    addResult('adaptation-result', 
                        `âœ… å†…å®¹é€‚é…æˆåŠŸï¼é€‚é…ç»“æœ: ${JSON.stringify(data.data, null, 2)}`, 'success');
                    testResults.contentAdaptation = true;
                } else {
                    addResult('adaptation-result', 
                        `âŒ å†…å®¹é€‚é…å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    testResults.contentAdaptation = false;
                }
            } catch (error) {
                addResult('adaptation-result', 
                    `âŒ å†…å®¹é€‚é…é”™è¯¯: ${error.message}`, 'error');
                testResults.contentAdaptation = false;
            }
        }

        async function runAllTests() {
            clearResults('test-summary');
            addResult('test-summary', 'ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            
            testResults = {};
            
            // è¿è¡Œæ‰€æœ‰æµ‹è¯•
            await testAPIStatus();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testImageGeneration();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testBatchImageGeneration();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testTextGeneration();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testContentSummarization();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testBrandAnalysis();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testEmojiRecommendation();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testCreativeContent();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testContentAdaptation();
            
            // ç”Ÿæˆæµ‹è¯•æ€»ç»“
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const failedTests = totalTests - passedTests;
            
            addResult('test-summary', 
                `ğŸ“Š æµ‹è¯•æ€»ç»“: é€šè¿‡ ${passedTests}/${totalTests} é¡¹æµ‹è¯•`, 
                passedTests === totalTests ? 'success' : 'warning');
            
            if (failedTests > 0) {
                addResult('test-summary', 
                    `âŒ å¤±è´¥çš„æµ‹è¯•: ${Object.keys(testResults).filter(key => !testResults[key]).join(', ')}`, 
                    'error');
            }
            
            addResult('test-summary', 
                `è¯¦ç»†ç»“æœ: ${JSON.stringify(testResults, null, 2)}`, 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•APIçŠ¶æ€
        window.addEventListener('load', () => {
            testAPIStatus();
        });
    </script>
</body>
</html> 