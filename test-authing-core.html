<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authingæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 14px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .config-item { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” Authingæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="status info">
        <strong>æµ‹è¯•ç›®æ ‡ï¼š</strong>éªŒè¯App IDé…ç½®ä¿®å¤æ˜¯å¦è§£å†³äº†"appId is required"é”™è¯¯
    </div>
    
    <h2>ğŸ“‹ é…ç½®éªŒè¯</h2>
    <div id="config-section"></div>
    
    <h2>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h2>
    <div id="test-section">
        <button class="btn-primary" onclick="testConfigRetrieval()">æµ‹è¯•é…ç½®è·å–</button>
        <button class="btn-primary" onclick="testGuardInit()">æµ‹è¯•Guardåˆå§‹åŒ–</button>
        <button class="btn-success" onclick="openMainApp()">æ‰“å¼€ä¸»åº”ç”¨</button>
    </div>
    
    <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
    <div id="results"></div>
    
    <script>
        // é…ç½®ä¿¡æ¯
        const EXPECTED_CONFIG = {
            appId: '68823897631e1ef8ff3720b2',
            domain: 'rzcswqd4sq0f.authing.cn',
            host: 'https://rzcswqd4sq0f.authing.cn'
        };
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
        
        function addConfig(key, value, isCorrect = null) {
            const div = document.createElement('div');
            div.className = 'config-item';
            const status = isCorrect === null ? '' : (isCorrect ? ' âœ…' : ' âŒ');
            div.innerHTML = `<strong>${key}:</strong> <code>${value || 'undefined'}</code>${status}`;
            document.getElementById('config-section').appendChild(div);
        }
        
        // æ˜¾ç¤ºé¢„æœŸé…ç½®
        function showExpectedConfig() {
            addConfig('é¢„æœŸApp ID', EXPECTED_CONFIG.appId);
            addConfig('é¢„æœŸDomain', EXPECTED_CONFIG.domain);
            addConfig('é¢„æœŸHost', EXPECTED_CONFIG.host);
        }
        
        // æµ‹è¯•é…ç½®è·å–
        function testConfigRetrieval() {
            addResult('ğŸ”§ å¼€å§‹æµ‹è¯•é…ç½®è·å–...', 'info');
            
            try {
                // æ¨¡æ‹ŸgetEnvVarå‡½æ•°é€»è¾‘
                function mockGetEnvVar(key, defaultValue = '') {
                    // æ¨¡æ‹Ÿç¯å¢ƒå˜é‡
                    const mockEnv = {
                        VITE_AUTHING_APP_ID: EXPECTED_CONFIG.appId,
                        VITE_AUTHING_DOMAIN: EXPECTED_CONFIG.domain,
                        VITE_AUTHING_HOST: EXPECTED_CONFIG.host
                    };
                    return mockEnv[key] || defaultValue;
                }
                
                const config = {
                    appId: mockGetEnvVar('VITE_AUTHING_APP_ID', EXPECTED_CONFIG.appId),
                    domain: mockGetEnvVar('VITE_AUTHING_DOMAIN', EXPECTED_CONFIG.domain),
                    host: mockGetEnvVar('VITE_AUTHING_HOST', EXPECTED_CONFIG.host),
                    redirectUri: `${window.location.origin}/callback`
                };
                
                // éªŒè¯é…ç½®
                const appIdCorrect = config.appId === EXPECTED_CONFIG.appId;
                const domainCorrect = config.domain === EXPECTED_CONFIG.domain;
                const hostCorrect = config.host === EXPECTED_CONFIG.host;
                const hasRedirectUri = !!config.redirectUri;
                
                addResult('âœ… é…ç½®è·å–æˆåŠŸ', 'success');
                addResult(`<pre>${JSON.stringify(config, null, 2)}</pre>`, 'info');
                
                if (appIdCorrect && domainCorrect && hostCorrect && hasRedirectUri) {
                    addResult('ğŸ‰ æ‰€æœ‰é…ç½®é¡¹éªŒè¯é€šè¿‡ï¼', 'success');
                    addResult('âœ… App IDä¿®å¤æˆåŠŸï¼Œåº”è¯¥ä¸å†å‡ºç°"appId is required"é”™è¯¯', 'success');
                } else {
                    addResult('âŒ éƒ¨åˆ†é…ç½®é¡¹éªŒè¯å¤±è´¥', 'error');
                    if (!appIdCorrect) addResult(`App IDé”™è¯¯: æœŸæœ› ${EXPECTED_CONFIG.appId}, å®é™… ${config.appId}`, 'error');
                    if (!domainCorrect) addResult(`Domainé”™è¯¯: æœŸæœ› ${EXPECTED_CONFIG.domain}, å®é™… ${config.domain}`, 'error');
                    if (!hostCorrect) addResult(`Hosté”™è¯¯: æœŸæœ› ${EXPECTED_CONFIG.host}, å®é™… ${config.host}`, 'error');
                    if (!hasRedirectUri) addResult('Redirect URIç¼ºå¤±', 'error');
                }
                
            } catch (error) {
                addResult(`âŒ é…ç½®è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•Guardåˆå§‹åŒ–
        function testGuardInit() {
            addResult('ğŸ”§ å¼€å§‹æµ‹è¯•Guardåˆå§‹åŒ–...', 'info');
            
            try {
                const config = {
                    appId: EXPECTED_CONFIG.appId,
                    domain: EXPECTED_CONFIG.domain,
                    host: EXPECTED_CONFIG.host,
                    redirectUri: `${window.location.origin}/callback`
                };
                
                // éªŒè¯å¿…è¦å‚æ•°
                if (!config.appId) {
                    throw new Error('appIdä¸ºç©º');
                }
                
                if (!config.domain) {
                    throw new Error('domainä¸ºç©º');
                }
                
                addResult('âœ… Guardåˆå§‹åŒ–å‚æ•°éªŒè¯é€šè¿‡', 'success');
                addResult('âœ… ä¸å†å‡ºç°"appId is required"é”™è¯¯', 'success');
                addResult('ğŸ¯ ä¿®å¤æˆåŠŸï¼å¯ä»¥åœ¨ä¸»åº”ç”¨ä¸­æ­£å¸¸ä½¿ç”¨Authing', 'success');
                
            } catch (error) {
                addResult(`âŒ Guardåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ‰“å¼€ä¸»åº”ç”¨
        function openMainApp() {
            addResult('ğŸš€ æ­£åœ¨æ‰“å¼€ä¸»åº”ç”¨...', 'info');
            window.open('http://localhost:5174', '_blank');
            addResult('ğŸ“ è¯·åœ¨ä¸»åº”ç”¨ä¸­æµ‹è¯•ç™»å½•åŠŸèƒ½ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦è¿˜æœ‰é”™è¯¯', 'warning');
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé…ç½®
        window.onload = function() {
            showExpectedConfig();
            addResult('é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'info');
        };
    </script>
    
    <div class="status warning" style="margin-top: 30px;">
        <h3>ğŸ¯ éªŒæ”¶æ ‡å‡†</h3>
        <ul>
            <li>âœ… é…ç½®è·å–æµ‹è¯•é€šè¿‡</li>
            <li>âœ… Guardåˆå§‹åŒ–æµ‹è¯•é€šè¿‡</li>
            <li>âœ… ä¸»åº”ç”¨æ§åˆ¶å°æ— "appId is required"é”™è¯¯</li>
            <li>âœ… ç™»å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
        </ul>
    </div>
</body>
</html>
