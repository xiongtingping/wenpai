<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯å¢ƒå˜é‡æµ‹è¯•</title>
</head>
<body>
    <h1>ç¯å¢ƒå˜é‡æµ‹è¯•</h1>
    <div id="env-status"></div>
    
    <script>
        // è¿è¡Œæ—¶é…ç½®å¯¹è±¡
        window.__RUNTIME_CONFIG__ = {
            VITE_OPENAI_API_KEY: '',
            VITE_DEEPSEEK_API_KEY: '',
            VITE_GEMINI_API_KEY: '',
            VITE_CREEM_API_KEY: '',
            VITE_AUTHING_APP_ID: '',
            VITE_AUTHING_HOST: '',
            VITE_API_BASE_URL: '',
            VITE_DEBUG_MODE: '',
            VITE_LOG_LEVEL: ''
        };
        
        // ç¯å¢ƒå˜é‡æ£€æµ‹å’Œå›é€€æœºåˆ¶
        window.__detectEnvVars__ = function() {
            const config = window.__RUNTIME_CONFIG__;
            const detected = {};
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é…ç½®éƒ½æ˜¯ç©ºçš„
            const allEmpty = Object.values(config).every(value => 
                !value || value === ''
            );
            
            if (allEmpty) {
                console.warn('âš ï¸ æ£€æµ‹åˆ°æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½æ˜¯ç©ºçš„ï¼Œå°è¯•ä»å…¶ä»–æ¥æºè·å–...');
                
                // å°è¯•ä»metaæ ‡ç­¾è·å–
                const metaElements = document.querySelectorAll('meta[name^="VITE_"]');
                metaElements.forEach(meta => {
                    const name = meta.getAttribute('name');
                    const content = meta.getAttribute('content');
                    if (name && content && content !== '') {
                        detected[name] = content;
                        console.log(`âœ… ä»metaæ ‡ç­¾è·å–åˆ° ${name}`);
                    }
                });
                
                // å°è¯•ä» Netlify dev ç¯å¢ƒè·å–ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
                if (window.location.hostname === 'localhost') {
                    // æ£€æŸ¥æ˜¯å¦æœ‰ Netlify dev æ³¨å…¥çš„ç¯å¢ƒå˜é‡
                    const netlifyEnv = window.__NETLIFY_DEV__ || {};
                    Object.keys(config).forEach(key => {
                        if (netlifyEnv[key]) {
                            detected[key] = netlifyEnv[key];
                            console.log(`âœ… ä» Netlify dev è·å–åˆ° ${key}`);
                        }
                    });
                }
                
                // å°è¯•ä»URLå‚æ•°è·å–ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
                if (window.location.hostname === 'localhost') {
                    const urlParams = new URLSearchParams(window.location.search);
                    Object.keys(config).forEach(key => {
                        const value = urlParams.get(key);
                        if (value) {
                            detected[key] = value;
                            console.log(`âœ… ä»URLå‚æ•°è·å–åˆ° ${key}`);
                        }
                    });
                }
                
                // å°è¯•ä»localStorageè·å–ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
                if (window.location.hostname === 'localhost') {
                    Object.keys(config).forEach(key => {
                        const value = localStorage.getItem(key);
                        if (value) {
                            detected[key] = value;
                            console.log(`âœ… ä»localStorageè·å–åˆ° ${key}`);
                        }
                    });
                }
                
                // æ›´æ–°é…ç½®
                Object.assign(config, detected);
            }
            
            return config;
        };
        
        // é…ç½®éªŒè¯å‡½æ•°
        window.__validateConfig__ = function() {
            const config = window.__detectEnvVars__();
            const missing = [];
            
            // æ£€æŸ¥å¿…éœ€çš„é…ç½®
            if (!config.VITE_OPENAI_API_KEY || config.VITE_OPENAI_API_KEY === '') {
                missing.push('OpenAI API Key');
            }
            if (!config.VITE_AUTHING_APP_ID || config.VITE_AUTHING_APP_ID === '') {
                missing.push('Authing App ID');
            }
            
            if (missing.length > 0) {
                console.warn('âš ï¸ ç¼ºå°‘å¿…éœ€çš„é…ç½®:', missing.join(', '));
                console.warn('è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ­£ç¡®è®¾ç½®äº†ç¯å¢ƒå˜é‡');
                
                // åœ¨å¼€å‘ç¯å¢ƒä¸­æä¾›æ›´è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯
                if (window.location.hostname === 'localhost') {
                    console.log('ğŸ’¡ å¼€å‘ç¯å¢ƒé…ç½®æç¤º:');
                    console.log('1. åˆ›å»º .env.local æ–‡ä»¶');
                    console.log('2. æ·»åŠ  VITE_OPENAI_API_KEY=your-api-key');
                    console.log('3. é‡å¯å¼€å‘æœåŠ¡å™¨');
                }
            } else {
                console.log('âœ… æ‰€æœ‰å¿…éœ€é…ç½®å·²æ­£ç¡®è®¾ç½®');
            }
            
            return missing.length === 0;
        };
        
        // é¡µé¢åŠ è½½æ—¶éªŒè¯é…ç½®
        document.addEventListener('DOMContentLoaded', function() {
            const config = window.__validateConfig__();
            const statusDiv = document.getElementById('env-status');
            
            let html = '<h2>ç¯å¢ƒå˜é‡çŠ¶æ€:</h2>';
            Object.entries(window.__RUNTIME_CONFIG__).forEach(([key, value]) => {
                const maskedValue = value && value.length > 8 ? value.substring(0, 8) + '...' : value;
                const status = value ? 'âœ…' : 'âŒ';
                html += `<p>${status} ${key}: ${maskedValue}</p>`;
            });
            
            statusDiv.innerHTML = html;
        });
    </script>
</body>
</html> 