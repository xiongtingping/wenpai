import{c as e,r as s,j as t,b as a,w as r,x as i,y as n,R as l,u as o,A as c,P as d,e as m,d as h,z as u,D as x,E as p,G as f,H as g,I as j,h as b,J as v,C as w,t as N,o as y,B as k,p as C,k as I,K as S,F as T}from"./index-CqEx2ZQ2.js";import{P as E}from"./PageNavigation-D2O4Qkdm.js";import{T as O}from"./textarea-D-dOGWbu.js";import{C as A,a as P,b as z,c as _,d as D}from"./card-DrUj54Xk.js";import{T as $,a as M,b as R,c as B,C as L,d as F,S as U,e as J,f as H,g as q,h as K}from"./select-x3iTviKa.js";import{S as G}from"./slider-BcxjE1QU.js";import{u as V}from"./index-DSe_Qqii.js";import{L as X}from"./label-7gl6F879.js";import{B as W}from"./badge-CY8ouemD.js";import Y from"./aiService-C_sfoPJp.js";import{D as Z,a as Q,b as ee,c as se,d as te}from"./dialog-CwiCL0Lj.js";import{I as ae}from"./input-CrmJOG1J.js";import{I as re}from"./info-F2_x9WlH.js";import{R as ie}from"./refresh-cw-Dgb94Q6d.js";import{S as ne}from"./shield-D6KSoUFB.js";import{E as le}from"./external-link-BZjY4ckH.js";import{C as oe}from"./circle-x-DnzhD4kF.js";import{C as ce}from"./circle-check-big-BO31TZ-5.js";import{T as de}from"./triangle-alert-BmHPuVcw.js";import{C as me}from"./crown-Bb8YyAK7.js";import{A as he,B as ue,V as xe,S as pe,T as fe,a as ge,R as je}from"./video-BBWTykCk.js";import{L as be}from"./lock-6NOyKcxB.js";import{M as ve,H as we}from"./message-square-B_7vbu0b.js";import{G as Ne}from"./globe-CpJJX4gW.js";import{Z as ye}from"./zap-CKqZoK8L.js";import{S as ke}from"./save-M8A5BkI7.js";import{S as Ce}from"./upload-KPy_Dsha.js";import{S as Ie}from"./square-pen-C9dPvocD.js";import{H as Se}from"./heart-Cm045W9y.js";import{C as Te}from"./copy-HXuvyyMP.js";import"./apiConfig-CndcvE7E.js";
/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=e("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),Oe=e("languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);var[Ae,Pe]=a("Tooltip",[r]),ze=r(),_e="TooltipProvider",De=700,$e="tooltip.open",[Me,Re]=Ae(_e),Be=e=>{const{__scopeTooltip:a,delayDuration:r=De,skipDelayDuration:i=300,disableHoverableContent:n=!1,children:l}=e,o=s.useRef(!0),c=s.useRef(!1),d=s.useRef(0);return s.useEffect(()=>{const e=d.current;return()=>window.clearTimeout(e)},[]),t.jsx(Me,{scope:a,isOpenDelayedRef:o,delayDuration:r,onOpen:s.useCallback(()=>{window.clearTimeout(d.current),o.current=!1},[]),onClose:s.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.current=!0,i)},[i]),isPointerInTransitRef:c,onPointerInTransitChange:s.useCallback(e=>{c.current=e},[]),disableHoverableContent:n,children:l})};Be.displayName=_e;var Le="Tooltip",[Fe,Ue]=Ae(Le),Je=e=>{const{__scopeTooltip:a,children:r,open:o,defaultOpen:c,onOpenChange:d,disableHoverableContent:m,delayDuration:h}=e,u=Re(Le,e.__scopeTooltip),x=ze(a),[p,f]=s.useState(null),g=i(),j=s.useRef(0),b=m??u.disableHoverableContent,v=h??u.delayDuration,w=s.useRef(!1),[N,y]=n({prop:o,defaultProp:c??!1,onChange:e=>{e?(u.onOpen(),document.dispatchEvent(new CustomEvent($e))):u.onClose(),null==d||d(e)},caller:Le}),k=s.useMemo(()=>N?w.current?"delayed-open":"instant-open":"closed",[N]),C=s.useCallback(()=>{window.clearTimeout(j.current),j.current=0,w.current=!1,y(!0)},[y]),I=s.useCallback(()=>{window.clearTimeout(j.current),j.current=0,y(!1)},[y]),S=s.useCallback(()=>{window.clearTimeout(j.current),j.current=window.setTimeout(()=>{w.current=!0,y(!0),j.current=0},v)},[v,y]);return s.useEffect(()=>()=>{j.current&&(window.clearTimeout(j.current),j.current=0)},[]),t.jsx(l,{...x,children:t.jsx(Fe,{scope:a,contentId:g,open:N,stateAttribute:k,trigger:p,onTriggerChange:f,onTriggerEnter:s.useCallback(()=>{u.isOpenDelayedRef.current?S():C()},[u.isOpenDelayedRef,S,C]),onTriggerLeave:s.useCallback(()=>{b?I():(window.clearTimeout(j.current),j.current=0)},[I,b]),onOpen:C,onClose:I,disableHoverableContent:b,children:r})})};Je.displayName=Le;var He="TooltipTrigger",qe=s.forwardRef((e,a)=>{const{__scopeTooltip:r,...i}=e,n=Ue(He,r),l=Re(He,r),h=ze(r),u=s.useRef(null),x=o(a,u,n.onTriggerChange),p=s.useRef(!1),f=s.useRef(!1),g=s.useCallback(()=>p.current=!1,[]);return s.useEffect(()=>()=>document.removeEventListener("pointerup",g),[g]),t.jsx(c,{asChild:!0,...h,children:t.jsx(d.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...i,ref:x,onPointerMove:m(e.onPointerMove,e=>{"touch"!==e.pointerType&&(f.current||l.isPointerInTransitRef.current||(n.onTriggerEnter(),f.current=!0))}),onPointerLeave:m(e.onPointerLeave,()=>{n.onTriggerLeave(),f.current=!1}),onPointerDown:m(e.onPointerDown,()=>{n.open&&n.onClose(),p.current=!0,document.addEventListener("pointerup",g,{once:!0})}),onFocus:m(e.onFocus,()=>{p.current||n.onOpen()}),onBlur:m(e.onBlur,n.onClose),onClick:m(e.onClick,n.onClose)})})});qe.displayName=He;var Ke="TooltipPortal",[Ge,Ve]=Ae(Ke,{forceMount:void 0}),Xe=e=>{const{__scopeTooltip:s,forceMount:a,children:r,container:i}=e,n=Ue(Ke,s);return t.jsx(Ge,{scope:s,forceMount:a,children:t.jsx(h,{present:a||n.open,children:t.jsx(u,{asChild:!0,container:i,children:r})})})};Xe.displayName=Ke;var We="TooltipContent",Ye=s.forwardRef((e,s)=>{const a=Ve(We,e.__scopeTooltip),{forceMount:r=a.forceMount,side:i="top",...n}=e,l=Ue(We,e.__scopeTooltip);return t.jsx(h,{present:r||l.open,children:l.disableHoverableContent?t.jsx(ts,{side:i,...n,ref:s}):t.jsx(Ze,{side:i,...n,ref:s})})}),Ze=s.forwardRef((e,a)=>{const r=Ue(We,e.__scopeTooltip),i=Re(We,e.__scopeTooltip),n=s.useRef(null),l=o(a,n),[c,d]=s.useState(null),{trigger:m,onClose:h}=r,u=n.current,{onPointerInTransitChange:x}=i,p=s.useCallback(()=>{d(null),x(!1)},[x]),f=s.useCallback((e,s)=>{const t=e.currentTarget,a={x:e.clientX,y:e.clientY},r=function(e,s,t=5){const a=[];switch(s){case"top":a.push({x:e.x-t,y:e.y+t},{x:e.x+t,y:e.y+t});break;case"bottom":a.push({x:e.x-t,y:e.y-t},{x:e.x+t,y:e.y-t});break;case"left":a.push({x:e.x+t,y:e.y-t},{x:e.x+t,y:e.y+t});break;case"right":a.push({x:e.x-t,y:e.y-t},{x:e.x-t,y:e.y+t})}return a}(a,function(e,s){const t=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),r=Math.abs(s.right-e.x),i=Math.abs(s.left-e.x);switch(Math.min(t,a,r,i)){case i:return"left";case r:return"right";case t:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,t.getBoundingClientRect())),i=function(e){const s=e.slice();return s.sort((e,s)=>e.x<s.x?-1:e.x>s.x?1:e.y<s.y?-1:e.y>s.y?1:0),function(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const t=e[a];for(;s.length>=2;){const e=s[s.length-1],a=s[s.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;s.pop()}s.push(t)}s.pop();const t=[];for(let a=e.length-1;a>=0;a--){const s=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(s.y-a.y)>=(e.y-a.y)*(s.x-a.x)))break;t.pop()}t.push(s)}return t.pop(),1===s.length&&1===t.length&&s[0].x===t[0].x&&s[0].y===t[0].y?s:s.concat(t)}(s)}([...r,...function(e){const{top:s,right:t,bottom:a,left:r}=e;return[{x:r,y:s},{x:t,y:s},{x:t,y:a},{x:r,y:a}]}(s.getBoundingClientRect())]);d(i),x(!0)},[x]);return s.useEffect(()=>()=>p(),[p]),s.useEffect(()=>{if(m&&u){const e=e=>f(e,u),s=e=>f(e,m);return m.addEventListener("pointerleave",e),u.addEventListener("pointerleave",s),()=>{m.removeEventListener("pointerleave",e),u.removeEventListener("pointerleave",s)}}},[m,u,f,p]),s.useEffect(()=>{if(c){const e=e=>{const s=e.target,t={x:e.clientX,y:e.clientY},a=(null==m?void 0:m.contains(s))||(null==u?void 0:u.contains(s)),r=!function(e,s){const{x:t,y:a}=e;let r=!1;for(let i=0,n=s.length-1;i<s.length;n=i++){const e=s[i],l=s[n],o=e.x,c=e.y,d=l.x,m=l.y;c>a!=m>a&&t<(d-o)*(a-c)/(m-c)+o&&(r=!r)}return r}(t,c);a?p():r&&(p(),h())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[m,u,c,h,p]),t.jsx(ts,{...e,ref:l})}),[Qe,es]=Ae(Le,{isInside:!1}),ss=f("TooltipContent"),ts=s.forwardRef((e,a)=>{const{__scopeTooltip:r,children:i,"aria-label":n,onEscapeKeyDown:l,onPointerDownOutside:o,...c}=e,d=Ue(We,r),m=ze(r),{onClose:h}=d;return s.useEffect(()=>(document.addEventListener($e,h),()=>document.removeEventListener($e,h)),[h]),s.useEffect(()=>{if(d.trigger){const e=e=>{const s=e.target;(null==s?void 0:s.contains(d.trigger))&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,h]),t.jsx(x,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:t.jsxs(p,{"data-state":d.stateAttribute,...m,...c,ref:a,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[t.jsx(ss,{children:i}),t.jsx(Qe,{scope:r,isInside:!0,children:t.jsx(g,{id:d.contentId,role:"tooltip",children:n||i})})]})})});Ye.displayName=We;var as="TooltipArrow";s.forwardRef((e,s)=>{const{__scopeTooltip:a,...r}=e,i=ze(a);return es(as,a).isInside?null:t.jsx(j,{...i,...r,ref:s})}).displayName=as;var rs=Xe,is=Ye;const ns=Be,ls=Je,os=qe,cs=s.forwardRef(({className:e,sideOffset:s=4,...a},r)=>t.jsx(rs,{children:t.jsx(is,{ref:r,sideOffset:s,className:b("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...a})}));cs.displayName=is.displayName;var ds="Checkbox",[ms,hs]=a(ds),[us,xs]=ms(ds);function ps(e){const{__scopeCheckbox:a,checked:r,children:i,defaultChecked:l,disabled:o,form:c,name:d,onCheckedChange:m,required:h,value:u="on",internal_do_not_use_render:x}=e,[p,f]=n({prop:r,defaultProp:l??!1,onChange:m,caller:ds}),[g,j]=s.useState(null),[b,v]=s.useState(null),w=s.useRef(!1),N=!g||!!c||!!g.closest("form"),y={checked:p,disabled:o,setChecked:f,control:g,setControl:j,name:d,form:c,value:u,hasConsumerStoppedPropagationRef:w,required:h,defaultChecked:!ks(l)&&l,isFormControl:N,bubbleInput:b,setBubbleInput:v};return t.jsx(us,{scope:a,...y,children:ys(x)?x(y):i})}var fs="CheckboxTrigger",gs=s.forwardRef(({__scopeCheckbox:e,onKeyDown:a,onClick:r,...i},n)=>{const{control:l,value:c,disabled:h,checked:u,required:x,setControl:p,setChecked:f,hasConsumerStoppedPropagationRef:g,isFormControl:j,bubbleInput:b}=xs(fs,e),v=o(n,p),w=s.useRef(u);return s.useEffect(()=>{const e=null==l?void 0:l.form;if(e){const s=()=>f(w.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}},[l,f]),t.jsx(d.button,{type:"button",role:"checkbox","aria-checked":ks(u)?"mixed":u,"aria-required":x,"data-state":Cs(u),"data-disabled":h?"":void 0,disabled:h,value:c,...i,ref:v,onKeyDown:m(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:m(r,e=>{f(e=>!!ks(e)||!e),b&&j&&(g.current=e.isPropagationStopped(),g.current||e.stopPropagation())})})});gs.displayName=fs;var js=s.forwardRef((e,s)=>{const{__scopeCheckbox:a,name:r,checked:i,defaultChecked:n,required:l,disabled:o,value:c,onCheckedChange:d,form:m,...h}=e;return t.jsx(ps,{__scopeCheckbox:a,checked:i,defaultChecked:n,disabled:o,required:l,onCheckedChange:d,name:r,form:m,value:c,internal_do_not_use_render:({isFormControl:e})=>t.jsxs(t.Fragment,{children:[t.jsx(gs,{...h,ref:s,__scopeCheckbox:a}),e&&t.jsx(Ns,{__scopeCheckbox:a})]})})});js.displayName=ds;var bs="CheckboxIndicator",vs=s.forwardRef((e,s)=>{const{__scopeCheckbox:a,forceMount:r,...i}=e,n=xs(bs,a);return t.jsx(h,{present:r||ks(n.checked)||!0===n.checked,children:t.jsx(d.span,{"data-state":Cs(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...e.style}})})});vs.displayName=bs;var ws="CheckboxBubbleInput",Ns=s.forwardRef(({__scopeCheckbox:e,...a},r)=>{const{control:i,hasConsumerStoppedPropagationRef:n,checked:l,defaultChecked:c,required:m,disabled:h,name:u,value:x,form:p,bubbleInput:f,setBubbleInput:g}=xs(ws,e),j=o(r,g),b=V(l),w=v(i);s.useEffect(()=>{const e=f;if(!e)return;const s=window.HTMLInputElement.prototype,t=Object.getOwnPropertyDescriptor(s,"checked").set,a=!n.current;if(b!==l&&t){const s=new Event("click",{bubbles:a});e.indeterminate=ks(l),t.call(e,!ks(l)&&l),e.dispatchEvent(s)}},[f,b,l,n]);const N=s.useRef(!ks(l)&&l);return t.jsx(d.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??N.current,required:m,disabled:h,name:u,value:x,form:p,...a,tabIndex:-1,ref:j,style:{...a.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function ys(e){return"function"==typeof e}function ks(e){return"indeterminate"===e}function Cs(e){return ks(e)?"indeterminate":e?"checked":"unchecked"}Ns.displayName=ws;const Is=s.forwardRef(({className:e,...s},a)=>t.jsx(js,{ref:a,className:b("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:t.jsx(vs,{className:b("flex items-center justify-center text-current"),children:t.jsx(w,{className:"h-4 w-4"})})}));Is.displayName=js.displayName;const Ss={wechat:{name:"微信",description:"微信公众号、朋友圈",maxLength:2e3,hashtagCount:0,tone:"专业、权威",features:["图文并茂","深度内容","专业术语"]},weibo:{name:"微博",description:"新浪微博",maxLength:140,hashtagCount:3,tone:"简洁、热点",features:["话题标签","@用户","转发互动"]},xiaohongshu:{name:"小红书",description:"小红书笔记",maxLength:1e3,hashtagCount:20,tone:"种草、分享",features:["个人体验","图片展示","标签丰富"]},douyin:{name:"抖音",description:"抖音短视频",maxLength:300,hashtagCount:5,tone:"轻松、有趣",features:["视频脚本","音乐配合","互动引导"]},zhihu:{name:"知乎",description:"知乎问答",maxLength:5e3,hashtagCount:0,tone:"专业、深度",features:["详细解答","专业术语","引用来源"]},bilibili:{name:"B站",description:"B站视频",maxLength:500,hashtagCount:10,tone:"年轻、活力",features:["弹幕互动","视频标题","分区标签"]}};let Ts="gpt-4o-mini";const Es={"gpt-4o":{id:"gpt-4o",name:"OpenAI GPT-4o",provider:"OpenAI",description:"最新最强大的AI模型，性能卓越，创意丰富，支持多模态输入输出",features:["超强理解能力","创意内容生成","多模态支持","上下文记忆优秀","代码生成能力强"],maxTokens:128e3,pricing:{input:.0025,output:.01}},"gpt-4o-mini":{id:"gpt-4o-mini",name:"OpenAI GPT-4o mini",provider:"OpenAI",description:"GPT-4o的轻量版本，性价比极高，适合日常使用",features:["性价比极高","响应速度快","理解能力优秀","适合日常对话","成本控制友好"],maxTokens:128e3,pricing:{input:15e-5,output:6e-4}},"deepseek-v3":{id:"deepseek-v3",name:"DeepSeek V3",provider:"DeepSeek",description:"中文优化模型，理解力强，适合本地化内容和中文创作",features:["中文理解优秀","本地化内容创作","文化语境理解","中文表达自然","适合中文用户"],maxTokens:128e3,pricing:{input:14e-5,output:56e-5}}},Os={trial:["gpt-4o-mini","deepseek-v3"],pro:["gpt-4o","gpt-4o-mini","deepseek-v3"],premium:["gpt-4o","gpt-4o-mini","deepseek-v3"]};function As(e){return Es[e]}const Ps={weibo:{platformId:"weibo",platformName:"微博",authUrl:"https://open.weibo.com/oauth2/authorize",apiBaseUrl:"https://api.weibo.com/2",isAuthorized:!1},zhihu:{platformId:"zhihu",platformName:"知乎",authUrl:"https://www.zhihu.com/oauth/authorize",apiBaseUrl:"https://api.zhihu.com",isAuthorized:!1},xiaohongshu:{platformId:"xiaohongshu",platformName:"小红书",authUrl:"https://oauth.xiaohongshu.com/oauth/authorize",apiBaseUrl:"https://api.xiaohongshu.com",isAuthorized:!1},bilibili:{platformId:"bilibili",platformName:"B站",authUrl:"https://passport.bilibili.com/login",apiBaseUrl:"https://api.bilibili.com",isAuthorized:!1},douyin:{platformId:"douyin",platformName:"抖音",authUrl:"https://open.douyin.com/oauth/authorize",apiBaseUrl:"https://open.douyin.com",isAuthorized:!1},twitter:{platformId:"twitter",platformName:"Twitter",authUrl:"https://twitter.com/i/oauth2/authorize",apiBaseUrl:"https://api.twitter.com/2",isAuthorized:!1},linkedin:{platformId:"linkedin",platformName:"LinkedIn",authUrl:"https://www.linkedin.com/oauth/v2/authorization",apiBaseUrl:"https://api.linkedin.com/v2",isAuthorized:!1}};function zs(){return Object.values(Ps)}function _s(e){const s=`platform_api_config_${e}`,t=localStorage.getItem(s);if(!t)return null;try{const s=JSON.parse(t);return{...Ps[e],...s}}catch{return null}}async function Ds(e,s){const t=_s(e);if(!t)return{success:!1,error:"平台配置不存在"};switch(e){case"weibo":return await async function(e,s){var t;try{if(!s.accessToken)return{success:!1,error:"未授权，请先完成微博授权"};const a=await fetch(`${s.apiBaseUrl}/statuses/update.json`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${s.accessToken}`},body:new URLSearchParams({status:e.text,source:"wenpai-app"})}),r=await a.json();return r.id?{success:!0,publishId:r.id,publishUrl:`https://weibo.com/${null==(t=r.user)?void 0:t.id}/${r.id}`,response:r}:{success:!1,error:r.error||"发布失败"}}catch(a){return{success:!1,error:a instanceof Error?a.message:"网络错误"}}}(s,t);case"zhihu":return await async function(e,s){try{if(!s.accessToken)return{success:!1,error:"未授权，请先完成知乎授权"};const t=await fetch(`${s.apiBaseUrl}/drafts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.accessToken}`},body:JSON.stringify({title:e.title||"新文章",content:e.text,topics:e.hashtags||[]})}),a=await t.json();if(a.id){const e=await fetch(`${s.apiBaseUrl}/drafts/${a.id}/publish`,{method:"POST",headers:{Authorization:`Bearer ${s.accessToken}`}}),t=await e.json();if(t.url)return{success:!0,publishId:a.id,publishUrl:t.url,response:t}}return{success:!1,error:"发布失败"}}catch(t){return{success:!1,error:t instanceof Error?t.message:"网络错误"}}}(s,t);case"twitter":return await async function(e,s){var t,a,r;try{if(!s.accessToken)return{success:!1,error:"未授权，请先完成Twitter授权"};const i=await fetch(`${s.apiBaseUrl}/tweets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.accessToken}`},body:JSON.stringify({text:e.text})}),n=await i.json();return(null==(t=n.data)?void 0:t.id)?{success:!0,publishId:n.data.id,publishUrl:`https://twitter.com/user/status/${n.data.id}`,response:n}:{success:!1,error:(null==(r=null==(a=n.errors)?void 0:a[0])?void 0:r.message)||"发布失败"}}catch(i){return{success:!1,error:i instanceof Error?i.message:"网络错误"}}}(s,t);default:return{success:!1,error:"暂不支持该平台的API直发"}}}function $s(e){const s=_s(e);return(null==s?void 0:s.isAuthorized)||!1}function Ms({open:e,onOpenChange:a}){const{toast:r}=N(),[i,n]=s.useState([]),[l,o]=s.useState(null),[c,d]=s.useState(!1),[m,h]=s.useState(""),[u,x]=s.useState(""),[p,f]=s.useState("");s.useEffect(()=>{if(e){const e=zs().map(e=>_s(e.platformId)||e);n(e)}},[e]);const g=e=>e.isAuthorized?t.jsx(ce,{className:"w-4 h-4 text-green-500"}):e.accessToken?t.jsx(de,{className:"w-4 h-4 text-yellow-500"}):t.jsx(oe,{className:"w-4 h-4 text-gray-400"}),j=e=>e.isAuthorized?"已授权":e.accessToken?"待验证":"未配置",b=e=>e.isAuthorized?"bg-green-100 text-green-800 border-green-200":e.accessToken?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-gray-100 text-gray-600 border-gray-200";return t.jsx(Z,{open:e,onOpenChange:a,children:t.jsxs(Q,{className:"max-w-4xl max-h-[80vh] overflow-hidden",children:[t.jsx(ee,{children:t.jsxs(se,{className:"flex items-center gap-2",children:[t.jsx(y,{className:"w-5 h-5"}),"平台API配置管理"]})}),t.jsx("div",{className:"flex-1 overflow-hidden",children:t.jsxs($,{defaultValue:"platforms",className:"h-full",children:[t.jsxs(M,{className:"grid w-full grid-cols-2",children:[t.jsx(R,{value:"platforms",children:"平台配置"}),t.jsx(R,{value:"help",children:"使用说明"})]}),t.jsx(B,{value:"platforms",className:"h-full overflow-auto",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"w-4 h-4 text-blue-500"}),t.jsx("span",{className:"text-sm text-gray-600",children:"配置平台API密钥和访问令牌，支持内容直发功能"})]}),t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{const e=zs().map(e=>_s(e.platformId)||e);n(e),r({title:"状态已刷新",description:"平台配置状态已更新"})},children:[t.jsx(ie,{className:"w-4 h-4 mr-1"}),"刷新状态"]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(e=>t.jsxs(A,{className:"relative",children:[t.jsxs(P,{className:"pb-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(z,{className:"text-lg",children:e.platformName}),t.jsxs("div",{className:"flex items-center gap-2",children:[g(e),t.jsx(W,{variant:"outline",className:b(e),children:j(e)})]})]}),t.jsxs(_,{children:["平台ID: ",e.platformId]})]}),t.jsxs(D,{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(Ee,{className:"w-4 h-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:["API密钥: ",e.apiKey?"已配置":"未配置"]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(ne,{className:"w-4 h-4 text-gray-400"}),t.jsxs("span",{className:"text-gray-600",children:["访问令牌: ",e.accessToken?"已配置":"未配置"]})]}),t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsxs(k,{size:"sm",variant:"outline",onClick:()=>(e=>{o(e),h(e.apiKey||""),x(e.accessToken||""),f(e.userId||""),d(!0)})(e),children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"配置"]}),e.authUrl&&t.jsxs(k,{size:"sm",variant:"outline",onClick:()=>(e=>{const s=function(e){const s=function(e){return Ps[e]||null}(e);return(null==s?void 0:s.authUrl)||null}(e.platformId);s?(window.open(s,"_blank","noopener,noreferrer"),r({title:"授权页面已打开",description:"请在授权页面完成授权，然后返回配置访问令牌"})):r({title:"授权失败",description:"该平台暂不支持授权",variant:"destructive"})})(e),children:[t.jsx(le,{className:"w-4 h-4 mr-1"}),"授权"]}),(e.apiKey||e.accessToken)&&t.jsxs(k,{size:"sm",variant:"outline",onClick:()=>{return function(e){const s=`platform_api_config_${e}`;localStorage.removeItem(s)}(s=e.platformId),n(e=>e.map(e=>e.platformId===s?{...e,apiKey:void 0,accessToken:void 0,userId:void 0,isAuthorized:!1}:e)),void r({title:"配置已清除",description:"平台API配置已清除"});var s},children:[t.jsx(oe,{className:"w-4 h-4 mr-1"}),"清除"]})]})]})]},e.platformId))})]})}),t.jsx(B,{value:"help",className:"h-full overflow-auto",children:t.jsx("div",{className:"space-y-6",children:t.jsxs(A,{children:[t.jsx(P,{children:t.jsx(z,{children:"API直发功能说明"})}),t.jsxs(D,{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"什么是API直发？"}),t.jsx("p",{className:"text-sm text-gray-600",children:"API直发功能允许您通过平台的官方API直接发布内容，无需手动复制粘贴。 配置完成后，可以一键将AI生成的内容直接发布到各平台。"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"支持的平台"}),t.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[t.jsx("li",{children:"• 微博 - 支持文本发布"}),t.jsx("li",{children:"• 知乎 - 支持文章发布"}),t.jsx("li",{children:"• Twitter - 支持推文发布"}),t.jsx("li",{children:"• 更多平台开发中..."})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"配置步骤"}),t.jsxs("ol",{className:"text-sm text-gray-600 space-y-1",children:[t.jsx("li",{children:'1. 点击"授权"按钮，在平台官网完成授权'}),t.jsx("li",{children:"2. 获取API密钥和访问令牌"}),t.jsx("li",{children:"3. 在配置页面填入相关信息"}),t.jsx("li",{children:"4. 保存配置，即可使用API直发功能"})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold mb-2",children:"安全说明"}),t.jsx("p",{className:"text-sm text-gray-600",children:"所有API密钥和访问令牌仅存储在您的浏览器本地，不会上传到服务器。 请妥善保管您的密钥信息，不要泄露给他人。"})]})]})]})})})]})}),t.jsx(Z,{open:c,onOpenChange:d,children:t.jsxs(Q,{children:[t.jsx(ee,{children:t.jsxs(se,{children:["配置 ",null==l?void 0:l.platformName," API"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(X,{htmlFor:"apiKey",children:"API密钥"}),t.jsx(ae,{id:"apiKey",type:"password",placeholder:"请输入API密钥",value:m,onChange:e=>h(e.target.value)})]}),t.jsxs("div",{children:[t.jsx(X,{htmlFor:"accessToken",children:"访问令牌"}),t.jsx(ae,{id:"accessToken",type:"password",placeholder:"请输入访问令牌",value:u,onChange:e=>x(e.target.value)})]}),t.jsxs("div",{children:[t.jsx(X,{htmlFor:"userId",children:"用户ID"}),t.jsx(ae,{id:"userId",placeholder:"请输入用户ID（可选）",value:p,onChange:e=>f(e.target.value)})]})]}),t.jsxs(te,{children:[t.jsx(k,{variant:"outline",onClick:()=>d(!1),children:"取消"}),t.jsx(k,{onClick:()=>{if(!l)return;const e={apiKey:m.trim()||void 0,accessToken:u.trim()||void 0,userId:p.trim()||void 0,isAuthorized:!!u.trim()};!function(e,s){const t=`platform_api_config_${e}`;localStorage.setItem(t,JSON.stringify(s))}(l.platformId,e),n(s=>s.map(s=>s.platformId===l.platformId?{...s,...e}:s)),d(!1),o(null),r({title:"配置已保存",description:`${l.platformName}的API配置已更新`})},children:"保存配置"})]})]})})]})})}function Rs({isOpen:e,onClose:s,onUpgrade:a,remainingCount:r,userType:i}){const n="trial"===i?{title:"使用次数即将用完",description:`仅剩 ${r} 次调用机会，立即升级享受更多功能！`,upgradeText:"立即升级",upgradeDescription:"升级后享受更多使用次数和高级功能"}:"pro"===i?{title:"使用次数即将用完",description:`仅剩 ${r} 次调用机会，升级后不限次！`,upgradeText:"升级高级版",upgradeDescription:"升级到高级版享受不限量使用"}:{title:"使用次数即将用完",description:`仅剩 ${r} 次调用机会`,upgradeText:"立即升级",upgradeDescription:"升级后享受更多使用次数"};return t.jsx(Z,{open:e,onOpenChange:s,children:t.jsxs(Q,{className:"sm:max-w-md",children:[t.jsx(ee,{children:t.jsxs(se,{className:"flex items-center gap-2 text-amber-600",children:[t.jsx(de,{className:"h-5 w-5"}),n.title]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-2xl font-bold text-red-600 mb-2",children:["仅剩 ",r," 次"]}),t.jsx("p",{className:"text-gray-600",children:n.description})]}),"trial"===i&&t.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border border-blue-200",children:[t.jsxs("h4",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[t.jsx(me,{className:"h-4 w-4"}),"升级专业版特权"]}),t.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[t.jsx("li",{children:"• 30次/月AI内容适配"}),t.jsx("li",{children:"• 创意魔方功能"}),t.jsx("li",{children:"• 高级AI模型"}),t.jsx("li",{children:"• 余额继承机制"})]})]}),"pro"===i&&t.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-lg border border-amber-200",children:[t.jsxs("h4",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[t.jsx(me,{className:"h-4 w-4"}),"升级高级版特权"]}),t.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[t.jsx("li",{children:"• 不限量AI内容适配"}),t.jsx("li",{children:"• 全网雷达功能"}),t.jsx("li",{children:"• 品牌库功能"}),t.jsx("li",{children:"• 最新AI模型"})]})]})]}),t.jsxs(te,{className:"flex gap-2",children:[t.jsx(k,{variant:"outline",onClick:s,children:"稍后再说"}),t.jsxs(k,{onClick:a,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:[n.upgradeText,t.jsx(he,{className:"h-4 w-4 ml-2"})]})]})]})})}function Bs({isOpen:e,onClose:s,onUpgrade:a,featureName:r,featureDescription:i}){return t.jsx(Z,{open:e,onOpenChange:s,children:t.jsxs(Q,{className:"sm:max-w-md",children:[t.jsx(ee,{children:t.jsxs(se,{className:"flex items-center gap-2 text-purple-600",children:[t.jsx(be,{className:"h-5 w-5"}),"高级功能权限"]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-bold text-gray-800 mb-2",children:r}),t.jsx("p",{className:"text-gray-600",children:i})]}),t.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200",children:[t.jsxs("h4",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[t.jsx(me,{className:"h-4 w-4"}),"升级高级版解锁特权"]}),t.jsxs("ul",{className:"text-sm text-purple-700 space-y-1",children:[t.jsx("li",{children:"• 不限量AI内容适配"}),t.jsx("li",{children:"• 创意魔方功能"}),t.jsx("li",{children:"• 全网雷达功能"}),t.jsx("li",{children:"• 品牌库功能"}),t.jsx("li",{children:"• 最新AI模型"}),t.jsx("li",{children:"• 余额继承机制"})]})]}),t.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 p-3 rounded-lg border border-amber-200",children:t.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[t.jsx(C,{className:"h-4 w-4"}),t.jsx("span",{className:"text-sm font-medium",children:"限时优惠：年付省80-202元"})]})})]}),t.jsxs(te,{className:"flex gap-2",children:[t.jsx(k,{variant:"outline",onClick:s,children:"稍后再说"}),t.jsxs(k,{onClick:a,className:"bg-gradient-to-r from-purple-500 to-blue-600 hover:from-purple-600 hover:to-blue-700",children:["立即升级解锁",t.jsx(he,{className:"h-4 w-4 ml-2"})]})]})]})})}const Ls={weibo:"https://weibo.com/newpost",xiaohongshu:"https://creator.xiaohongshu.com/publish",zhihu:"https://zhuanlan.zhihu.com/write",bilibili:"https://member.bilibili.com/platform/upload/text",douyin:"https://creator.douyin.com/creator-micro/content/upload",toutiao:"https://mp.toutiao.com/profile_v4/graphic/publish",baijiahao:"https://baijiahao.baidu.com/builder/rc/edit",kuaishou:"https://cp.kuaishou.com/article/publish",wechat:"https://mp.weixin.qq.com/",facebook:"https://www.facebook.com/",twitter:"https://twitter.com/compose/tweet",linkedin:"https://www.linkedin.com/feed/",v2ex:"https://www.v2ex.com/new",github:"https://github.com/new",sspai:"https://sspai.com/write",juejin:"https://juejin.cn/editor/drafts/new",csdn:"https://mp.csdn.net/mp_blog/creation/editor",hellogithub:"https://hellogithub.com/",ithome:"https://my.ithome.com/#/write",ngabbs:"https://bbs.nga.cn/thread.php?fid=-7",weatheralarm:"https://www.nmc.cn/",earthquake:"https://www.ceic.ac.cn/",history:"https://baike.baidu.com/item/%E5%8E%86%E5%8F%B2%E4%B8%8A%E7%9A%84%E4%BB%8A%E5%A4%A9/42704"};function Fs(e){const s=Ss[e],a=(null==s?void 0:s.name)||e;switch(e){case"zhihu":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(ve,{className:"h-4 w-4 text-blue-500 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"weibo":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(pe,{className:"h-4 w-4 text-orange-500 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"xiaohongshu":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(ue,{className:"h-4 w-4 text-rose-500 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"wechat":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(ve,{className:"h-4 w-4 text-green-500 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"douyin":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(xe,{className:"h-4 w-4 text-black mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"video":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(ge,{className:"h-4 w-4 text-green-600 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"twitter":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(fe,{className:"h-4 w-4 text-black mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});case"bilibili":return t.jsxs("div",{className:"flex items-center",children:[t.jsx(xe,{className:"h-4 w-4 text-blue-400 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]});default:return t.jsxs("div",{className:"flex items-center",children:[t.jsx(ve,{className:"h-4 w-4 mr-1"}),t.jsx("span",{className:"text-xs",children:a})]})}}function Us(e){switch(e){case"zhihu":return 200;case"douyin":case"video":default:return 50;case"xiaohongshu":case"bilibili":return 100;case"wechat":return 300;case"weibo":return 20;case"twitter":return 10}}function Js(e){switch(e){case"zhihu":return 1e4;case"douyin":case"xiaohongshu":case"video":return 1e3;case"wechat":return 2e4;case"weibo":default:return 2e3;case"twitter":return 280;case"bilibili":return 5e3}}function Hs({icon:e,title:s,description:a,checked:r,onChange:i}){return t.jsxs(A,{className:b("relative border cursor-pointer transition-all duration-200 h-36 flex flex-col",r?"border-primary bg-primary/5 shadow-md ring-1 ring-primary/20":"bg-background hover:shadow-sm hover:border-gray-300"),onClick:()=>i(!r),children:[t.jsx(P,{className:"pb-1 pt-4 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[t.jsx("div",{className:"flex-shrink-0",children:e}),t.jsx(z,{className:"text-sm font-semibold truncate leading-tight",children:s})]}),t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Is,{checked:r,onCheckedChange:i,className:"data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground"})})]})}),t.jsx(D,{className:"pt-0 pb-4 flex-grow flex items-start",children:t.jsx(_,{className:"text-xs leading-relaxed overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical",maxHeight:"4.8rem"},children:a})})]})}function qs(){var e,a,r;const{toast:i}=N(),n=I(),[l,o]=s.useState(""),[c,d]=s.useState([]),[m,h]=s.useState([]),[u,x]=s.useState(!1),[p,f]=s.useState(!1),[g,j]=s.useState({}),[b,v]=s.useState({}),[w,C]=s.useState(!1),[V,ae]=s.useState(null),[re,ne]=s.useState({}),[oe,ce]=s.useState(new Set),[de,me]=s.useState({charCountPreset:"auto",globalEmoji:!1,globalMd:!1}),[be,Ee]=s.useState("openai"),[Ae,Pe]=s.useState(Ts),[ze,_e]=s.useState("trial"),De=(Os[ze]||[]).map(e=>Es[e]).filter(Boolean),$e=Object.values(Es),{usageRemaining:Me,decrementUsage:Re}=S(),[Be,Le]=s.useState(!1),[Fe,Ue]=s.useState(0),[Je,He]=s.useState(!1),[qe,Ke]=s.useState({name:"",description:""}),Ge=s.useMemo(()=>[{id:"xiaohongshu",name:"小红书",description:"适合生活方式、美妆、旅行等分享，强调个人体验和情感共鸣",icon:t.jsx(ue,{className:"h-4 w-4 text-rose-500"})},{id:"zhihu",name:"知乎",description:"适合专业知识分享和理性讨论，强调逻辑和论证",icon:t.jsx(ve,{className:"h-4 w-4 text-blue-500"})},{id:"douyin",name:"抖音脚本",description:"适合短视频脚本，活泼有趣，强调视听效果",icon:t.jsx(xe,{className:"h-4 w-4 text-black"})},{id:"weibo",name:"新浪微博",description:"简短有力的观点表达，适合热点话题讨论",icon:t.jsx(pe,{className:"h-4 w-4 text-orange-500"})},{id:"wechat",name:"公众号",description:"深度内容，适合教程、观点和专业分析",icon:t.jsx(ve,{className:"h-4 w-4 text-green-500"})},{id:"bilibili",name:"B站",description:"适合视频脚本，兼具专业性和趣味性",icon:t.jsx(xe,{className:"h-4 w-4 text-blue-400"})},{id:"twitter",name:"X（推特）",description:"简短、直接的表达，支持多种语言和国际化视角",icon:t.jsx(fe,{className:"h-4 w-4 text-black"})},{id:"video",name:"视频号",description:"视频内容与互动引导并重，亲和力强",icon:t.jsx(ge,{className:"h-4 w-4 text-green-600"})},{id:"baijia",name:"百家号",description:"长篇深度内容，SEO友好，权威感强，适合资讯类内容",icon:t.jsx(Ne,{className:"h-4 w-4 text-blue-700"})},{id:"kuaishou",name:"快手",description:"接地气表达，真实朴实，亲民风格，适合生活记录",icon:t.jsx(ye,{className:"h-4 w-4 text-yellow-600"})},{id:"wangyi",name:"网易小蜜蜂",description:"注重原创性，文笔流畅，观点独特，适合深度评论",icon:t.jsx(je,{className:"h-4 w-4 text-red-500"})},{id:"toutiao",name:"头条号",description:"标题党友好，热点敏感，算法推荐，适合时事评论",icon:t.jsx(Ne,{className:"h-4 w-4 text-purple-600"})}],[]),Ve=s.useCallback(()=>{const e={};Ge.forEach(s=>{e[s.id]={charCount:Math.floor(.6*Js(s.id)),useEmoji:"xiaohongshu"===s.id||"weibo"===s.id,useMdFormat:"zhihu"===s.id||"wechat"===s.id,useAutoFormat:!0}}),j(e);const s={};Ge.forEach(e=>{s[e.id]=!1}),v(s)},[Ge]),Xe=()=>{try{localStorage.setItem("platformSettings",JSON.stringify(g)),localStorage.setItem("globalSettings",JSON.stringify(de)),localStorage.setItem("selectedPlatforms",JSON.stringify(c)),i({title:"设置已保存",description:"您的平台设置已成功保存"})}catch{i({title:"保存设置失败",description:"无法保存您的设置，请稍后再试",variant:"destructive"})}};s.useEffect(()=>{Object.keys(g).length>0&&localStorage.setItem("platformSettings",JSON.stringify(g))},[g]),s.useEffect(()=>{Object.keys(de).length>0&&localStorage.setItem("globalSettings",JSON.stringify(de))},[de]),s.useEffect(()=>{c.length>0&&localStorage.setItem("selectedPlatforms",JSON.stringify(c))},[c]),s.useEffect(()=>{const e=localStorage.getItem("platformSettings"),s=localStorage.getItem("globalSettings"),t=localStorage.getItem("selectedPlatforms");if(e)try{const s=JSON.parse(e);j(s)}catch{Ve()}else Ve();if(s)try{const e=JSON.parse(s);me(e)}catch{}if(t)try{const e=JSON.parse(t);d(e)}catch{}const a={};Ge.forEach(e=>{a[e.id]=!1}),v(a)},[Ve,Ge]),s.useEffect(()=>{Ve()},[Ve]);const We=l.length,Ye=l.trim().length>10&&c.length>0&&Me>0,Ze=(e,s,t)=>{j(a=>({...a,[e]:{...a[e],[s]:t}}))},Qe=(e,s)=>{me(t=>({...t,[e]:s}))},[es,ss]=s.useState(!1),[ts,as]=s.useState(null),rs=async e=>{await new Promise(e=>setTimeout(e,1e3));let s=e;return Object.entries({"小红书":"Xiaohongshu","抖音":"TikTok","微博":"Weibo","知乎":"Zhihu","公众号":"WeChat Official Account","B站":"Bilibili","视频号":"Video Account","试了":"tried","味道":"taste","治愈":"healing","小时候":"childhood","牛奶糖":"milk candy","甜而不腻":"sweet but not cloying","质地":"texture","冰淇淋":"ice cream","慕斯":"mousse","水润":"moisturizing","吸收":"absorption","粘腻":"sticky","秋冬":"autumn and winter","干皮":"dry skin","姐妹们":"sisters","闭眼冲":"go for it blindly","身体乳":"body lotion","护肤":"skincare","救星":"savior","推荐":"recommend","真的":"really","超级":"super","好用":"good to use","喜欢":"like","分享":"share","体验":"experience","感觉":"feel","效果":"effect","产品":"product","品牌":"brand","购买":"buy","价格":"price","优惠":"discount","活动":"activity","限时":"limited time","抢购":"rush to buy","赶紧":"hurry up","不要":"don't","错过":"miss","机会":"opportunity","最后":"last","一次":"once","时间":"time","结束":"end","开始":"start","立刻":"immediately","今天":"today","明天":"tomorrow","昨天":"yesterday","这周":"this week","下周":"next week","本月":"this month","下月":"next month","今年":"this year","明年":"next year"}).forEach(([e,t])=>{s=s.replace(new RegExp(e,"g"),t)}),s=s.replace(/。/g,". ").replace(/，/g,", ").replace(/！/g,"! ").replace(/？/g,"? ").replace(/：/g,": ").replace(/；/g,"; "),s},[is,ds]=s.useState(""),[ms,hs]=s.useState(!1),[us,xs]=s.useState([]),[ps,fs]=s.useState([]),[gs,js]=s.useState(null),[bs,vs]=s.useState(!1),[ws,Ns]=s.useState([]),ys=s.useCallback(()=>{const e=JSON.parse(localStorage.getItem("shareHistory")||"[]");Ns(e)},[]);s.useEffect(()=>{bs&&ys()},[bs,ys]);const[ks,Cs]=s.useState(!1),[Ps,zs]=s.useState("jump"),[_s,qs]=s.useState(new Set);return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(E,{title:"AI内容适配器",description:"一次创作，多平台适配，让您的内容在每个平台都能发挥最大效果",showAdaptButton:!1,actions:t.jsxs(t.Fragment,{children:[t.jsxs(k,{variant:"outline",onClick:()=>window.location.href="/history",children:[t.jsx(T,{className:"h-4 w-4 mr-1"}),"历史记录"]}),t.jsxs(k,{variant:"outline",onClick:()=>Cs(!0),children:[t.jsx(y,{className:"h-4 w-4 mr-1"}),"API配置"]})]})}),t.jsxs("div",{className:"container mx-auto py-6 px-4",children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-medium mb-2",children:"内容创作"}),t.jsx(ns,{children:t.jsxs(ls,{children:[t.jsx(os,{asChild:!0,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"剩余次数:"}),t.jsx(W,{variant:Me<=5?"destructive":"default",children:Me})]})}),t.jsxs(cs,{side:"bottom",children:[t.jsx("p",{children:"每次多平台内容生成消耗1次使用额度"}),t.jsx("p",{children:"每月自动获得20次免费使用机会"}),t.jsx("p",{children:"通过邀请好友可获得额外使用次数"})]})]})})]}),t.jsx(A,{className:"mb-6",children:t.jsx(D,{className:"pt-6",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(X,{className:"text-sm font-medium",children:"发布模式:"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(k,{variant:"jump"===Ps?"default":"outline",size:"sm",onClick:()=>zs("jump"),children:[t.jsx(le,{className:"w-4 h-4 mr-1"}),"跳转发布"]}),t.jsxs(k,{variant:"api"===Ps?"default":"outline",size:"sm",onClick:()=>zs("api"),children:[t.jsx(ye,{className:"w-4 h-4 mr-1"}),"API直发"]})]}),"api"===Ps&&t.jsxs(W,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[t.jsx(ye,{className:"w-3 h-3 mr-1"}),"需要配置API密钥"]})]})})}),t.jsxs(A,{className:"mb-8",children:[t.jsxs(P,{children:[t.jsx(z,{className:"text-lg",children:"输入原始内容"}),t.jsx(_,{children:"请输入您想要进行多平台适配的原始内容"})]}),t.jsxs(D,{children:[t.jsx(O,{placeholder:"在此输入您的原始内容，我们将为您适配到不同平台...",className:"min-h-[200px]",value:l,onChange:e=>o(e.target.value)}),t.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto justify-center",children:[t.jsx(Is,{id:"use-brand-library",checked:p,onCheckedChange:e=>{e&&("trial"===ze&&(Ke({name:"品牌库功能",description:"使用品牌库资料进行创作，AI会自动遵循您的品牌语言规范"}),He(!0),1))||f(!!e)}}),t.jsxs("div",{children:[t.jsx(X,{htmlFor:"use-brand-library",className:"text-sm cursor-pointer",children:"使用品牌库资料进行创作"}),t.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["上传您的品牌资料库，AI在创作时会自动遵循您的语言规范，融入品牌价值，规避公关风险。分发再多平台，品牌形象始终如一。",t.jsx("span",{className:"text-xs text-amber-500 ml-1",children:"（需开通高级功能）"})]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto justify-center",children:[t.jsxs(k,{variant:"outline",size:"sm",onClick:()=>C(e=>!e),className:"text-xs rounded-lg shadow-sm border border-blue-200",children:["适配设置",w?t.jsx(L,{className:"ml-1 h-3 w-3"}):t.jsx(F,{className:"ml-1 h-3 w-3"})]}),t.jsxs(W,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[We," 字符"]})]})]}),w&&t.jsx("div",{className:"mt-2 w-full",children:t.jsxs("div",{className:"bg-white rounded-lg shadow p-3 flex flex-col items-center w-full max-w-full",children:[t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 w-full px-4",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(X,{className:"text-xs w-28 flex-shrink-0",children:"全局字符数限制"}),t.jsxs(U,{value:de.charCountPreset,onValueChange:e=>Qe("charCountPreset",e),children:[t.jsx(J,{className:"h-7 w-36 text-xs",children:t.jsx(H,{placeholder:"选择字符数限制"})}),t.jsxs(q,{children:[t.jsx(K,{value:"auto",children:"自动"}),t.jsx(K,{value:"mini",children:"精简(50-200字)"}),t.jsx(K,{value:"standard",children:"标准(200-800字)"}),t.jsx(K,{value:"detailed",children:"详细(800+)"})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(X,{className:"text-xs w-28 flex-shrink-0",children:"启用表情符号"}),t.jsx(Is,{id:"global-emoji",checked:de.globalEmoji,onCheckedChange:e=>Qe("globalEmoji",!!e)})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(X,{className:"text-xs w-28 flex-shrink-0",children:"启用Markdown格式"}),t.jsx(Is,{id:"global-md",checked:de.globalMd,onCheckedChange:e=>Qe("globalMd",!!e)})]})]}),t.jsx("div",{className:"flex justify-center mt-2 w-full",children:t.jsxs(k,{variant:"outline",size:"sm",onClick:Xe,className:"flex items-center h-7 text-xs px-3",children:[t.jsx(ke,{className:"h-3 w-3 mr-1"}),"保存"]})})]})})]})]}),t.jsxs(A,{className:"mb-8",children:[t.jsx(P,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(z,{className:"text-lg",children:"AI 模型选择"}),t.jsx(_,{children:"选择您喜欢的AI模型生成内容，默认优先推荐GPT-4o"})]}),"trial"===ze&&t.jsx(k,{variant:"outline",size:"sm",onClick:()=>n("/payment"),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:"去解锁"})]})}),t.jsx(D,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$e.map(e=>{let s=!De.some(s=>s.id===e.id),a="",r=!1;return"gpt-4o"===e.id&&"trial"===ze&&(a="专业版/高级版专属",r=!0),t.jsx("div",{className:"p-6 border-2 rounded-xl cursor-pointer transition-all hover:shadow-md "+(Ae===e.id?"border-blue-500 bg-blue-50 shadow-sm":s?"border-gray-200 bg-gray-100 opacity-60 cursor-not-allowed":"border-gray-200 hover:border-blue-300"),onClick:()=>((e,s)=>{if(s)return;Pe(e),Ts=e;const t=function(e){var s;return(null==(s=Es[e])?void 0:s.provider)||"Unknown"}(e);"OpenAI"===t&&Ee("openai"),"DeepSeek"===t&&Ee("deepseek")})(e.id,s),children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 mt-0.5 "+(Ae===e.id?"border-blue-500 bg-blue-500":"border-gray-300"),children:Ae===e.id&&t.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-full"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"font-semibold text-blue-600 text-base",children:e.name}),a&&t.jsx(W,{className:"bg-gray-200 text-gray-600 text-xs",children:a})]}),t.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:e.description}),r&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-md",children:t.jsxs("p",{className:"text-xs text-yellow-700 flex items-center",children:[t.jsx("span",{className:"mr-1",children:"🔒"}),"去解锁高级功能"]})})]})]})},e.id)})}),Ae&&t.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[t.jsx("p",{className:"font-medium",children:null==(e=As(Ae))?void 0:e.name}),t.jsx("p",{children:null==(a=As(Ae))?void 0:a.description})]}),t.jsxs("div",{className:"mt-4 flex gap-2 items-center",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"模拟订阅等级："}),t.jsx(k,{size:"sm",variant:"trial"===ze?"default":"outline",onClick:()=>_e("trial"),children:"免费版"}),t.jsx(k,{size:"sm",variant:"pro"===ze?"default":"outline",onClick:()=>_e("pro"),children:"专业版"}),t.jsx(k,{size:"sm",variant:"premium"===ze?"default":"outline",onClick:()=>_e("premium"),children:"高级版"})]})]})})]}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h2",{className:"text-lg font-medium mb-4",children:"选择目标平台"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 auto-rows-fr",children:Ge.map(e=>t.jsx(Hs,{icon:e.icon,title:e.name,description:e.description,checked:c.includes(e.id),onChange:s=>{return t=e.id,void d(s?e=>[...e,t]:e=>e.filter(e=>e!==t));var t}},e.id))}),c.length>0&&t.jsxs(A,{className:"mt-6",children:[t.jsx(P,{className:"pb-3",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(y,{className:"h-4 w-4"}),t.jsx(z,{className:"text-base",children:"平台设置"}),t.jsxs(W,{variant:"secondary",className:"text-xs",children:[c.length,"个平台"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(k,{variant:"outline",size:"sm",onClick:Xe,children:[t.jsx(ke,{className:"h-3 w-3 mr-1"}),"保存设置"]}),t.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>C(!w),children:[w?"收起":"展开",w?t.jsx(L,{className:"ml-1 h-4 w-4"}):t.jsx(F,{className:"ml-1 h-4 w-4"})]})]})]})}),w&&t.jsx(D,{className:"pt-0",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"border-b pb-4",children:[t.jsx("h4",{className:"text-sm font-medium mb-3 text-gray-700",children:"全局设置"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Is,{id:"global-emoji",checked:de.globalEmoji,onCheckedChange:e=>Qe("globalEmoji",!!e)}),t.jsxs(X,{htmlFor:"global-emoji",className:"text-sm cursor-pointer flex items-center",children:[t.jsx(Ce,{className:"h-3 w-3 mr-1"}),"全局添加emoji表情"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Is,{id:"global-md",checked:de.globalMd,onCheckedChange:e=>Qe("globalMd",!!e)}),t.jsxs(X,{htmlFor:"global-md",className:"text-sm cursor-pointer flex items-center",children:[t.jsx(T,{className:"h-3 w-3 mr-1"}),"全局MD格式"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Is,{id:"global-auto",checked:!0,disabled:!0}),t.jsxs(X,{htmlFor:"global-auto",className:"text-sm cursor-pointer flex items-center text-gray-500",children:[t.jsx(we,{className:"h-3 w-3 mr-1"}),"全局自动排版"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium mb-3 text-gray-700",children:"平台特定设置"}),t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:c.map(e=>{const s=Ge.find(s=>s.id===e),a=g[e]||{},r=["zhihu","wechat","weibo","xiaohongshu"].includes(e);return s?t.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50/50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.icon,t.jsx("span",{className:"text-sm font-medium",children:s.name}),r&&t.jsx(W,{variant:"outline",className:"text-xs",children:"优化"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs(X,{className:"text-xs",children:["字符数: ",a.charCount||Js(e)]}),t.jsxs("span",{className:"text-xs text-muted-foreground",children:[Us(e),"-",Js(e)]})]}),t.jsx(G,{value:[a.charCount||Js(e)],min:Us(e),max:Js(e),step:10,onValueChange:s=>Ze(e,"charCount",s[0]),className:"w-full"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Is,{id:`${e}-emoji`,checked:a.useEmoji,onCheckedChange:s=>Ze(e,"useEmoji",!!s)}),t.jsxs(X,{htmlFor:`${e}-emoji`,className:"text-xs cursor-pointer flex items-center",children:[t.jsx(Ce,{className:"h-3 w-3 mr-1"}),"emoji"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Is,{id:`${e}-md`,checked:a.useMdFormat,onCheckedChange:s=>Ze(e,"useMdFormat",!!s)}),t.jsxs(X,{htmlFor:`${e}-md`,className:"text-xs cursor-pointer flex items-center",children:[t.jsx(T,{className:"h-3 w-3 mr-1"}),"MD格式"]})]})]}),r&&t.jsxs("div",{className:"bg-blue-50 p-2 rounded text-xs text-blue-600",children:["zhihu"===e&&"知乎: MD格式优化专业排版，自动排版添加分割线","wechat"===e&&"公众号: MD格式适合深度阅读，专业排版","weibo"===e&&"微博: emoji提升互动性，字数限制2000字","xiaohongshu"===e&&"小红书: emoji增加亲和力，自动排版优化视觉效果"]})]})]},e):null})})]})]})})]})]}),t.jsx("div",{className:"flex justify-center mb-12",children:t.jsx(k,{size:"lg",disabled:!Ye||u,onClick:async()=>{if(!Ye)return;if(Me<=3&&Me>0&&(Ue(Me),Le(!0),1))return;if(Me<=0)return void i({title:"使用次数已用完",description:"请通过邀请好友获取更多使用机会",variant:"destructive"});x(!0),(()=>{const e={...g};de.globalEmoji&&Object.keys(e).forEach(s=>{e[s].useEmoji=!0}),de.globalMd&&Object.keys(e).forEach(s=>{e[s].useMdFormat=!0}),"auto"!==de.charCountPreset&&Object.keys(e).forEach(s=>{switch(de.charCountPreset){case"mini":e[s].charCount=Math.min(200,Js(s));break;case"standard":e[s].charCount=Math.min(800,Js(s));break;case"detailed":e[s].charCount=Js(s)}}),j(e)})();const e=c.map(e=>({platformId:e,content:"",steps:[{status:"loading",message:"分析原始内容..."},{status:"waiting",message:"提取核心信息..."},{status:"waiting",message:"进行平台适配..."},{status:"waiting",message:"优化输出结果..."}]}));h(e);try{const e={};c.forEach(s=>{const t=g[s];e[`${s}-charCount`]=(null==t?void 0:t.charCount)||.6*Js(s),e[`${s}-emoji`]=(null==t?void 0:t.useEmoji)||!1,e[`${s}-mdFormat`]=(null==t?void 0:t.useMdFormat)||!1,e[`${s}-autoFormat`]=(null==t?void 0:t.useAutoFormat)||!1,e[`${s}-brandLibrary`]=p});const s=await async function(e,s,t){try{const a=await Y.adaptContent(e,s,t);return{success:a.success,data:a.data,error:a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"内容适配失败"}}}(l,c,e);for(let t=0;t<c.length;t++){const e=c[t],a=(s,t)=>{h(a=>a.map(a=>a.platformId===e?{...a,steps:a.steps.map((e,a)=>a===s?{...e,status:t}:e)}:a))};a(0,"completed"),await new Promise(e=>setTimeout(e,300)),a(1,"loading"),await new Promise(e=>setTimeout(e,300)),a(1,"completed"),a(2,"loading"),await new Promise(e=>setTimeout(e,300)),a(2,"completed"),a(3,"loading"),await new Promise(e=>setTimeout(e,300));for(const t of c){const e=s[t];e&&e.content?(a(3,"completed"),h(s=>s.map(s=>s.platformId===t?{...s,content:e.content,source:e.source,error:e.error}:s))):(a(3,"error"),h(e=>e.map(e=>e.platformId===t?{...e,error:"生成失败：无法获取适配内容"}:e)))}}Re(),(e=>{const s="history_anonymous",t=localStorage.getItem(s);let a=[];if(t)try{a=JSON.parse(t)}catch{}const r=(new Date).toISOString();e.forEach(e=>{e.content&&a.push({platformId:e.platformId,content:e.content,timestamp:r})}),localStorage.setItem(s,JSON.stringify(a))})(m),i({title:"内容已生成",description:`已成功为${c.length}个平台生成内容`})}catch(s){h(e=>e.map(e=>({...e,steps:e.steps.map(e=>"loading"===e.status?{...e,status:"error"}:e),error:s instanceof Error?s.message:"生成失败"}))),i({title:"生成失败",description:s instanceof Error?s.message:"内容生成过程中发生错误，请稍后重试",variant:"destructive"})}finally{x(!1)}},className:"w-full max-w-md",children:u?t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"正在生成中..."]}):t.jsxs(t.Fragment,{children:["开始生成",t.jsx(he,{className:"ml-2 h-4 w-4"})]})})}),m.length>0&&t.jsxs("div",{className:"mt-8",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsx("h2",{className:"text-3xl font-bold",children:"平台适配结果"}),t.jsxs(k,{size:"lg",variant:"default",onClick:()=>{const e=m.filter(e=>e.content).map(e=>e.platformId);xs(e),hs(!0)},disabled:0===m.filter(e=>e.content).length,children:["api"===Ps?t.jsx(ye,{className:"h-5 w-5 mr-2"}):t.jsx(le,{className:"h-5 w-5 mr-2"}),"api"===Ps?"批量API直发":"批量一键转发"]})]}),t.jsxs($,{defaultValue:null==(r=m[0])?void 0:r.platformId,className:"w-full",children:[t.jsx(M,{className:"mb-6 grid w-full grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 h-12 overflow-x-auto",children:m.map(e=>t.jsx(R,{value:e.platformId,className:"text-xs sm:text-sm font-medium min-w-0",children:t.jsx("div",{className:"flex items-center",children:Fs(e.platformId)})},e.platformId))}),m.map(e=>{var s,a;return t.jsx(B,{value:e.platformId,children:t.jsxs(A,{className:"p-8 shadow-lg border-2",children:[t.jsx(P,{className:"pb-4",children:t.jsx("div",{className:"flex justify-between items-center",children:t.jsxs(z,{className:"text-2xl flex items-center",children:[Fs(e.platformId),t.jsx("span",{className:"ml-3",children:(null==(s=Ss[e.platformId])?void 0:s.name)||e.platformId})]})})}),t.jsxs(D,{className:"space-y-6",children:[t.jsx("div",{className:"space-y-3",children:e.steps.map((e,s)=>t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium "+("completed"===e.status?"bg-green-500 text-white":"loading"===e.status?"bg-blue-500 text-white animate-spin":"error"===e.status?"bg-red-500 text-white":"bg-gray-200 text-gray-600"),children:"completed"===e.status?"✓":"loading"===e.status?"⟳":"error"===e.status?"✗":s+1}),t.jsx("span",{className:"text-sm "+("completed"===e.status?"text-green-600":"loading"===e.status?"text-blue-600":"error"===e.status?"text-red-600":"text-gray-500"),children:e.message})]},s))}),e.error&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-5 h-5 bg-red-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white text-xs",children:"✗"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"生成失败"}),t.jsx("div",{className:"mt-1 text-sm text-red-700",children:e.error})]})]})}),e.content&&!e.error&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-white text-xs",children:"✓"})})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-green-800",children:"AI生成内容"}),t.jsx("div",{className:"mt-1 text-sm text-green-700",children:"内容已成功生成，您可以编辑、复制或收藏"})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"生成结果"}),t.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-600 mx-auto rounded-full"})]}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8 items-start",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-center xl:justify-start gap-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),t.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"生成内容"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),e.content?V===e.platformId?t.jsxs("div",{className:"space-y-3",children:[t.jsx(O,{value:e.content,onChange:s=>{h(t=>t.map(t=>t.platformId===e.platformId?{...t,content:s.target.value}:t))},className:"min-h-[300px] text-base resize-none"}),t.jsxs("div",{className:"flex gap-3 justify-center lg:justify-start",children:[t.jsx(k,{size:"sm",onClick:()=>{return s=e.platformId,t=e.content,h(e=>e.map(e=>e.platformId===s?{...e,content:t}:e)),ae(null),void i({title:"保存成功",description:"内容已更新"});var s,t},className:"bg-green-600 hover:bg-green-700",children:"保存"}),t.jsx(k,{size:"sm",variant:"outline",onClick:()=>ae(null),children:"取消"})]})]}):t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"whitespace-pre-wrap rounded-lg border-2 p-6 overflow-auto max-h-[600px] text-base leading-relaxed shadow-sm "+("xiaohongshu"===e.platformId?"bg-rose-50 border-rose-200":"douyin"===e.platformId?"bg-black text-white border-gray-800":"weibo"===e.platformId?"bg-orange-50 border-orange-200":"zhihu"===e.platformId?"bg-blue-50 border-blue-200":"wechat"===e.platformId?"bg-green-50 border-green-200":"bilibili"===e.platformId?"bg-pink-50 border-pink-200":"video"===e.platformId?"bg-emerald-50 border-emerald-200":"twitter"===e.platformId?"bg-sky-50 border-sky-200":"bg-gray-50 border-gray-200"),children:e.content}),t.jsx("div",{className:"absolute top-4 right-4",children:t.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-full px-3 py-1 text-xs font-medium text-gray-700 shadow-sm",children:(null==(a=Ss[e.platformId])?void 0:a.name)||e.platformId})})]}):e.error?t.jsx("div",{className:"rounded-lg border-2 border-dashed border-red-200 p-12 flex items-center justify-center bg-red-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-red-600 text-lg font-medium",children:"生成失败"}),t.jsx("p",{className:"text-red-500 text-sm mt-2",children:e.error})]})}):t.jsx("div",{className:"rounded-lg border-2 border-dashed border-gray-200 p-12 flex items-center justify-center bg-gray-50",children:t.jsx("p",{className:"text-muted-foreground text-lg",children:"生成的内容将显示在这里..."})})]}),re[e.platformId]&&t.jsx("div",{className:"hidden lg:flex items-center justify-center absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10",children:t.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg",children:t.jsx("div",{className:"w-0 h-0 border-l-2 border-r-2 border-t-2 border-white"})})}),re[e.platformId]&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-center lg:justify-start gap-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),t.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"翻译内容"}),t.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"whitespace-pre-wrap rounded-lg border-2 border-blue-200 p-6 bg-blue-50 overflow-auto max-h-[600px] text-base leading-relaxed shadow-sm",children:re[e.platformId]}),t.jsx("div",{className:"absolute top-4 right-4",children:t.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-full px-3 py-1 text-xs font-medium text-blue-700 shadow-sm",children:"翻译版本"})})]})]})]})]}),e.content&&t.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[t.jsxs(k,{size:"lg",variant:"outline",onClick:()=>(async e=>{if(!u){h(s=>s.map(s=>s.platformId===e?{...s,steps:[{status:"loading",message:"重新分析内容..."},{status:"waiting",message:"提取核心信息..."},{status:"waiting",message:"进行平台适配..."},{status:"waiting",message:"优化输出结果..."}]}:s));try{const s={},t=g[e];s[`${e}-charCount`]=(null==t?void 0:t.charCount)||.6*Js(e),s[`${e}-emoji`]=(null==t?void 0:t.useEmoji)||!1,s[`${e}-mdFormat`]=(null==t?void 0:t.useMdFormat)||!1,s[`${e}-autoFormat`]=(null==t?void 0:t.useAutoFormat)||!1,s[`${e}-brandLibrary`]=p;const a=await async function(e,s,t){try{const a=await Y.adaptContent(s,[e],t);return{success:a.success,data:a.data,error:a.error}}catch(a){return{success:!1,error:a instanceof Error?a.message:"内容重新生成失败"}}}(e,l,s),r=(s,t)=>{h(a=>a.map(a=>a.platformId===e?{...a,steps:a.steps.map((e,a)=>a===s?{...e,status:t}:e)}:a))};r(0,"completed"),await new Promise(e=>setTimeout(e,300)),r(1,"loading"),await new Promise(e=>setTimeout(e,300)),r(1,"completed"),r(2,"loading"),await new Promise(e=>setTimeout(e,300)),r(2,"completed"),r(3,"loading"),await new Promise(e=>setTimeout(e,300));const n=a[e];r(3,"completed"),h(s=>s.map(s=>s.platformId===e?{...s,content:n.content,source:n.source,error:n.error}:s)),i({title:"重新生成成功",description:`已为${e}重新生成内容`})}catch(s){h(t=>t.map(t=>t.platformId===e?{...t,steps:t.steps.map(e=>"loading"===e.status?{...e,status:"error"}:e),error:s instanceof Error?s.message:"重新生成失败"}:t)),i({title:"重新生成失败",description:s instanceof Error?s.message:`适配${e}内容时出错`,variant:"destructive"})}}})(e.platformId),disabled:u,children:[t.jsx(ie,{className:"h-5 w-5 mr-2"}),"重新生成"]}),t.jsxs(k,{size:"lg",variant:"outline",onClick:()=>{return s=e.platformId,void ae(V===s?null:s);var s},children:[t.jsx(Ie,{className:"h-5 w-5 mr-2"}),V===e.platformId?"取消编辑":"编辑"]}),t.jsxs(k,{size:"lg",variant:"outline",onClick:()=>(e=>{const s=m.find(s=>s.platformId===e);if(!s||!s.content)return void i({title:"无法收藏",description:"没有可收藏的内容",variant:"destructive"});const t=JSON.parse(localStorage.getItem("favorites")||"[]"),a={id:Date.now().toString(),platformId:e,content:s.content,platformName:e,timestamp:(new Date).toISOString()};t.push(a),localStorage.setItem("favorites",JSON.stringify(t)),i({title:"收藏成功",description:"内容已添加到收藏，可在我的页面查看"})})(e.platformId),children:[t.jsx(Se,{className:"h-5 w-5 mr-2"}),"收藏"]}),t.jsxs(k,{size:"lg",variant:"outline",onClick:()=>{return s=e.content,navigator.clipboard.writeText(s),void i({title:"已复制到剪贴板",description:"内容已成功复制，可直接粘贴使用"});var s},children:[t.jsx(Te,{className:"h-5 w-5 mr-2"}),"一键复制"]}),t.jsxs(k,{size:"lg",variant:"outline",onClick:()=>(async(e,s)=>{if(oe.has(e))i({title:"请勿频繁点击",description:"翻译进行中，请稍候...",variant:"destructive"});else{ce(s=>new Set(s).add(e));try{const t=await(async e=>{try{const s=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,targetLang:"en",sourceLang:"zh"})});if(!s.ok)throw new Error("Translation API failed");return(await s.json()).translatedText||e}catch{return rs(e)}})(s);ne(s=>({...s,[e]:t})),i({title:"翻译完成",description:"内容已翻译为英文"})}catch{i({title:"翻译失败",description:"翻译过程中出现错误，请稍后重试",variant:"destructive"})}finally{setTimeout(()=>{ce(s=>{const t=new Set(s);return t.delete(e),t})},3e3)}}})(e.platformId,e.content),disabled:oe.has(e.platformId),children:[t.jsx(Oe,{className:"h-5 w-5 mr-2"}),"一键翻译"]}),t.jsxs(k,{size:"lg",variant:"default",onClick:()=>(e=>{const s=m.find(s=>s.platformId===e);s&&s.content?(as({platformId:e,content:s.content}),ss(!0)):i({title:"无法发布",description:"没有可发布的内容",variant:"destructive"})})(e.platformId),disabled:_s.has(e.platformId),children:[_s.has(e.platformId)?t.jsx(ie,{className:"h-5 w-5 mr-2 animate-spin"}):"api"===Ps?t.jsx(ye,{className:"h-5 w-5 mr-2"}):t.jsx(le,{className:"h-5 w-5 mr-2"}),_s.has(e.platformId)?"发布中...":"api"===Ps?"API直发":"立刻发布"]})]})]})]})},e.platformId)})]})]})]}),t.jsx(Z,{open:es,onOpenChange:ss,children:t.jsxs(Q,{children:[t.jsx(ee,{children:t.jsx(se,{children:"一键转发确认"})}),t.jsxs("div",{className:"py-2 text-gray-700",children:[t.jsx("p",{children:"api"===Ps?"是否通过API直接发布内容？":"内容已复制到剪贴板，是否跳转到平台发布页？"}),t.jsx("div",{className:"bg-gray-100 rounded p-2 mt-2 text-xs break-all max-h-32 overflow-auto",children:null==ts?void 0:ts.content})]}),t.jsxs(te,{children:[t.jsx(k,{variant:"outline",onClick:()=>ss(!1),children:"取消"}),t.jsx(k,{variant:"default",onClick:()=>{if(!ts)return;const{platformId:e,content:s}=ts;if("api"===Ps)(async(e,s)=>{if(!$s(e))return i({title:"未授权",description:"请先配置平台API授权信息",variant:"destructive"}),void Cs(!0);qs(s=>new Set(s).add(e));try{const t={text:s,title:`AI生成内容 - ${(new Date).toLocaleString()}`,hashtags:[]},a=await Ds(e,t);if(a.success){const t=JSON.parse(localStorage.getItem("shareHistory")||"[]");t.unshift({id:Date.now().toString(),platformId:e,platformName:e,content:s,time:(new Date).toISOString()}),localStorage.setItem("shareHistory",JSON.stringify(t)),i({title:"发布成功",description:`内容已成功发布到${e}`}),a.publishUrl&&window.open(a.publishUrl,"_blank","noopener,noreferrer")}else i({title:"发布失败",description:a.error||"发布过程中出现错误",variant:"destructive"})}catch(t){i({title:"发布失败",description:t instanceof Error?t.message:"网络错误",variant:"destructive"})}finally{qs(s=>{const t=new Set(s);return t.delete(e),t})}})(e,s);else{navigator.clipboard.writeText(s);const t=JSON.parse(localStorage.getItem("shareHistory")||"[]");t.unshift({id:Date.now().toString(),platformId:e,platformName:e,content:s,time:(new Date).toISOString()}),localStorage.setItem("shareHistory",JSON.stringify(t));const a=Ls[e];a?(window.open(a,"_blank","noopener,noreferrer"),i({title:"内容已复制，正在跳转",description:`内容已复制到剪贴板，正在打开${e}官网`})):i({title:"内容已复制",description:"内容已复制到剪贴板，但该平台的发布链接暂未配置"})}ss(!1),as(null)},children:"api"===Ps?"确认发布":"跳转并发布"})]})]})}),t.jsx(Z,{open:ms,onOpenChange:hs,children:t.jsxs(Q,{children:[t.jsx(ee,{children:t.jsx(se,{children:"批量一键转发"})}),t.jsxs("div",{className:"py-2 text-gray-700",children:[t.jsx("p",{children:"请选择要批量转发的平台："}),t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:m.filter(e=>e.content).map(e=>t.jsx(k,{variant:us.includes(e.platformId)?"default":"outline",onClick:()=>xs(s=>s.includes(e.platformId)?s.filter(s=>s!==e.platformId):[...s,e.platformId]),children:e.platformId},e.platformId))})]}),t.jsxs(te,{children:[t.jsx(k,{variant:"outline",onClick:()=>hs(!1),children:"取消"}),t.jsx(k,{variant:"default",onClick:()=>{const e=us.map(e=>{const s=m.find(s=>s.platformId===e);return s&&s.content?{platformId:e,content:s.content}:null}).filter(Boolean);"api"===Ps?((async e=>{const s=e.filter(e=>!$s(e));if(s.length>0)return i({title:"部分平台未授权",description:`请先配置 ${s.join(", ")} 的API授权信息`,variant:"destructive"}),void Cs(!0);const t=e.filter(e=>$s(e));if(0===t.length)return void i({title:"无可用平台",description:"请先配置至少一个平台的API授权信息",variant:"destructive"});const a=m.find(e=>e.platformId===t[0]);if(null==a?void 0:a.content){qs(new Set(t));try{const e={text:a.content,title:`AI生成内容 - ${(new Date).toLocaleString()}`,hashtags:[]},s=await async function(e,s){const t=[];for(const r of e)try{const e=await Ds(r,s);t.push(e)}catch(a){t.push({success:!1,error:a instanceof Error?a.message:"发布失败"})}return t}(t,e),r=s.filter(e=>e.success).length,n=s.length-r,l=JSON.parse(localStorage.getItem("shareHistory")||"[]");s.forEach((e,s)=>{e.success&&l.unshift({id:Date.now().toString()+s,platformId:t[s],platformName:t[s],content:a.content,time:(new Date).toISOString()})}),localStorage.setItem("shareHistory",JSON.stringify(l)),i({title:"批量发布完成",description:`成功: ${r}个平台，失败: ${n}个平台`}),s.forEach((e,s)=>{e.success&&e.publishUrl&&setTimeout(()=>{window.open(e.publishUrl,"_blank","noopener,noreferrer")},500*s)})}catch(r){i({title:"批量发布失败",description:r instanceof Error?r.message:"网络错误",variant:"destructive"})}finally{qs(new Set)}}else i({title:"无内容可发布",description:"请先生成内容",variant:"destructive"})})(us),hs(!1)):(fs(e),hs(!1),e.length>0&&js(e[0]))},disabled:0===us.length,children:"开始批量转发"})]})]})}),t.jsx(Z,{open:!!gs,onOpenChange:e=>{e||js(null)},children:t.jsxs(Q,{children:[t.jsx(ee,{children:t.jsx(se,{children:"批量一键转发"})}),t.jsxs("div",{className:"py-2 text-gray-700",children:[t.jsxs("p",{children:["内容已复制到剪贴板，是否跳转到 ",null==gs?void 0:gs.platformId," 发布页？"]}),t.jsx("div",{className:"bg-gray-100 rounded p-2 mt-2 text-xs break-all max-h-32 overflow-auto",children:null==gs?void 0:gs.content})]}),t.jsxs(te,{children:[t.jsx(k,{variant:"outline",onClick:()=>{if(!gs)return;const e=ps.findIndex(e=>e.platformId===gs.platformId);e>=0&&e<ps.length-1?js(ps[e+1]):(js(null),fs([]),i({title:"批量转发完成",description:"已完成所有平台的转发"}))},children:"跳过"}),t.jsx(k,{variant:"default",onClick:()=>{if(!gs)return;const{platformId:e,content:s}=gs;navigator.clipboard.writeText(s);const t=JSON.parse(localStorage.getItem("shareHistory")||"[]");t.unshift({id:Date.now().toString(),platformId:e,platformName:e,content:s,time:(new Date).toISOString()}),localStorage.setItem("shareHistory",JSON.stringify(t));const a=Ls[e];a&&window.open(a,"_blank","noopener,noreferrer");const r=ps.findIndex(s=>s.platformId===e);r>=0&&r<ps.length-1?js(ps[r+1]):(js(null),fs([]),i({title:"批量转发完成",description:"已完成所有平台的转发"}))},children:"跳转并发布"})]})]})}),t.jsx(Z,{open:bs,onOpenChange:vs,children:t.jsxs(Q,{className:"max-w-2xl",children:[t.jsx(ee,{children:t.jsx(se,{children:"转发历史"})}),t.jsx("div",{className:"py-2 text-gray-700 max-h-[60vh] overflow-auto",children:0===ws.length?t.jsx("div",{className:"text-center text-gray-400 py-8",children:"暂无转发历史"}):t.jsx("div",{className:"space-y-4",children:ws.map(e=>t.jsxs("div",{className:"border rounded p-2 bg-gray-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("span",{className:"font-bold text-blue-600",children:e.platformName}),t.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.time).toLocaleString()})]}),t.jsx("div",{className:"text-xs break-all mb-1",children:e.content}),t.jsx(k,{size:"sm",variant:"outline",onClick:()=>navigator.clipboard.writeText(e.content),children:"复制内容"})]},e.id))})}),t.jsxs(te,{children:[t.jsx(k,{variant:"outline",onClick:()=>{localStorage.removeItem("shareHistory"),Ns([]),i({title:"已清空",description:"转发历史已清空"})},disabled:0===ws.length,children:"清空历史"}),t.jsx(k,{variant:"default",onClick:()=>vs(!1),children:"关闭"})]})]})}),t.jsx(Ms,{open:ks,onOpenChange:Cs}),t.jsx(Rs,{isOpen:Be,onClose:()=>Le(!1),onUpgrade:()=>{Le(!1),n("/payment")},remainingCount:Fe,userType:"trial"===ze?"trial":"pro"}),t.jsx(Bs,{isOpen:Je,onClose:()=>He(!1),onUpgrade:()=>{He(!1),n("/payment")},featureName:qe.name,featureDescription:qe.description})]})}export{qs as default};
