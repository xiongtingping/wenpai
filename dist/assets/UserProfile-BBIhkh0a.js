import{r as s,_ as e,aB as a,u as t,p as i,j as c,C as l,i as n,ax as r,B as m,at as x,au as d,av as h,e as o,f as j,h as p,g as N,n as g,o as u,aC as f,k as v,S as w,aD as y}from"./index-CYvVoP-H.js";import{S}from"./separator-DS2DK2Rh.js";import{L as k}from"./log-out-B1dfFBRV.js";import{M as C}from"./mail-CwIle1ib.js";import{P as A}from"./phone-DLvaRB6j.js";import{S as D}from"./square-pen-DqPou0km.js";function L({className:L="",showActions:U=!0,compact:b=!1}){const[z,I]=s.useState(null),[P,E]=s.useState(!0),[F,V]=s.useState(null),{isAuthenticated:B,logout:O}=e(),{checkLoginStatus:q,getCurrentUser:M,showLogin:$}=a(),{toast:_}=t(),G=i(),H=async()=>{try{await O(),_({title:"登出成功",description:"您已安全退出登录"}),G("/")}catch(s){_({title:"登出失败",description:"请稍后重试",variant:"destructive"})}};return s.useEffect(()=>{B?(async()=>{try{if(E(!0),V(null),!(await q()))return V("用户未登录"),void E(!1);const s=await M();if(s){const e={id:String(s.id||s.userId||""),username:String(s.username||""),nickname:String(s.nickname||s.username||"用户"),email:String(s.email||""),phone:String(s.phone||""),photo:String(s.photo||s.avatar||""),createdAt:String(s.createdAt||(new Date).toISOString()),updatedAt:String(s.updatedAt||(new Date).toISOString()),...s};I(e),y.secureLog("用户信息加载成功",{userId:e.id,hasEmail:!!e.email,hasPhone:!!e.phone})}else V("无法获取用户信息")}catch(s){V("加载用户信息失败"),y.secureLog("用户信息加载失败",{error:s instanceof Error?s.message:"未知错误"},"error")}finally{E(!1)}})():(E(!1),V("用户未登录"))},[B]),P?c.jsx(l,{className:L,children:c.jsx(n,{className:"p-6",children:c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"animate-pulse bg-gray-200 rounded-full w-16 h-16"}),c.jsxs("div",{className:"space-y-2 flex-1",children:[c.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-3/4"}),c.jsx("div",{className:"animate-pulse bg-gray-200 h-3 rounded w-1/2"})]})]})})}):F||!z?c.jsx(l,{className:L,children:c.jsx(n,{className:"p-6",children:c.jsxs("div",{className:"text-center text-gray-500",children:[c.jsx(r,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),c.jsx("p",{className:"text-sm",children:F||"用户信息不可用"}),U&&c.jsx(m,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>$(),children:"去登录"})]})})}):b?c.jsx(l,{className:L,children:c.jsx(n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs(x,{className:"w-10 h-10",children:[c.jsx(d,{src:z.photo,alt:z.nickname}),c.jsx(h,{children:z.nickname.charAt(0).toUpperCase()})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-sm font-medium truncate",children:z.nickname}),c.jsx("p",{className:"text-xs text-gray-500 truncate",children:z.email||z.phone||"未设置联系方式"})]}),U&&c.jsx(m,{variant:"ghost",size:"sm",onClick:H,children:c.jsx(k,{className:"w-4 h-4"})})]})})}):c.jsxs(l,{className:L,children:[c.jsxs(o,{children:[c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(r,{className:"w-5 h-5"}),"用户信息"]}),c.jsx(p,{children:"您的账户信息和设置"})]}),c.jsxs(n,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-start space-x-4",children:[c.jsxs(x,{className:"w-20 h-20",children:[c.jsx(d,{src:z.photo,alt:z.nickname}),c.jsx(h,{className:"text-lg",children:z.nickname.charAt(0).toUpperCase()})]}),c.jsxs("div",{className:"flex-1 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"text-xl font-semibold",children:z.nickname}),c.jsx(N,{variant:z.isProUser?"default":"secondary",children:z.isProUser?c.jsxs(c.Fragment,{children:[c.jsx(g,{className:"w-3 h-3 mr-1"}),"专业版"]}):c.jsxs(c.Fragment,{children:[c.jsx(u,{className:"w-3 h-3 mr-1"}),"体验版"]})})]}),c.jsxs("p",{className:"text-sm text-gray-600",children:["@",z.username]}),z.email&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[c.jsx(C,{className:"w-4 h-4"}),c.jsx("span",{children:f.maskValue(z.email,"email")})]}),z.phone&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[c.jsx(A,{className:"w-4 h-4"}),c.jsx("span",{children:f.maskValue(z.phone,"phone")})]})]})]}),c.jsx(S,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[c.jsx(v,{className:"w-4 h-4"}),"账户信息"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"用户ID:"}),c.jsx("p",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1",children:f.maskValue(z.id,"id")})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"注册时间:"}),c.jsx("p",{className:"mt-1",children:new Date(z.createdAt).toLocaleDateString()})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"最后更新:"}),c.jsx("p",{className:"mt-1",children:new Date(z.updatedAt).toLocaleDateString()})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"账户类型:"}),c.jsx("p",{className:"mt-1",children:"premium"===z.plan?"高级版":"pro"===z.plan?"专业版":"体验版"})]})]})]}),U&&c.jsxs(c.Fragment,{children:[c.jsx(S,{}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{G("/profile")},className:"flex items-center gap-1",children:[c.jsx(D,{className:"w-4 h-4"}),"编辑资料"]}),c.jsxs(m,{variant:"outline",size:"sm",onClick:()=>G("/settings"),className:"flex items-center gap-1",children:[c.jsx(w,{className:"w-4 h-4"}),"设置"]}),!z.isProUser&&c.jsxs(m,{variant:"default",size:"sm",onClick:()=>{G("/payment")},className:"flex items-center gap-1",children:[c.jsx(g,{className:"w-4 h-4"}),"升级账户"]}),c.jsxs(m,{variant:"destructive",size:"sm",onClick:H,className:"flex items-center gap-1 ml-auto",children:[c.jsx(k,{className:"w-4 h-4"}),"退出登录"]})]})]})]})]})}export{L as U};
