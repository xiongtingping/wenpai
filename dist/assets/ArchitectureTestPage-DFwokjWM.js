import{j as s}from"./ui-core-BoM6Gtru.js";import{r as e}from"./router-CDHmMMQ-.js";import{u as t,C as r,a,b as i,e as n,d as c,B as l,s as d}from"./pages-home-B-YLcn0z.js";import{B as o}from"./pages-adapt-CSkmXLuc.js";import{S as m}from"./pages-hot-topics-Cqw0YZgk.js";import{d as x}from"./components-auth-BBdw3eti.js";import"./react-vendor-D7XYiaTe.js";import"./components-landing-CGa4OaD-.js";import"./components-layout-B8FsrdzO.js";import"./utils-Ck01-_Du.js";import"./pages-brand-BuX6qQ3s.js";import"./api-services-DPZFfcoz.js";import"./pages-content-extractor-C4B3q1d0.js";function h(){const[h,j]=e.useState([]),[u,g]=e.useState(!1),[p,f]=e.useState(null),{toast:y}=t();e.useEffect(()=>{w()},[]);const w=async()=>{try{const s=await x.getCurrentUser();f(s)}catch(s){}},N=(s,e,t,r)=>{j(a=>[...a,{name:s,status:e,message:t,data:r}])},b=(s,e,t,r)=>{j(a=>a.map(a=>a.name===s?{...a,status:e,message:t,data:r}:a))},v=async()=>{N("Authing身份认证","pending","正在测试Authing身份认证功能...");try{const s=await x.getCurrentUser();s?b("Authing身份认证","success","用户身份认证成功",s):b("Authing身份认证","error","用户未登录，请先登录")}catch(s){b("Authing身份认证","error",`身份认证失败: ${s instanceof Error?s.message:"未知错误"}`)}},S=async()=>{if(p){N("后端业务逻辑","pending","正在测试后端业务逻辑功能...");try{const s=await x.getUserProfile(p.id);b("后端业务逻辑","success","后端业务逻辑测试成功",s)}catch(s){b("后端业务逻辑","error",`后端业务逻辑测试失败: ${s instanceof Error?s.message:"未知错误"}`)}}else N("后端业务逻辑","error","请先登录后再测试后端功能")};return s.jsx("div",{className:"container mx-auto px-6 py-8",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"架构分离测试页面"}),s.jsx("p",{className:"text-lg text-gray-600",children:"验证Authing身份认证和自建后端业务逻辑的分离架构"})]}),s.jsxs(r,{className:"mb-6",children:[s.jsx(a,{children:s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(o,{variant:p?"default":"secondary",children:p?"已登录":"未登录"}),"当前用户状态"]})}),s.jsx(n,{children:p?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"用户ID:"})," ",p.id]}),s.jsxs("p",{children:[s.jsx("strong",{children:"用户名:"})," ",p.username]}),s.jsxs("p",{children:[s.jsx("strong",{children:"邮箱:"})," ",p.email]}),s.jsxs("p",{children:[s.jsx("strong",{children:"手机号:"})," ",p.phone]})]}):s.jsx("p",{className:"text-gray-500",children:"请先登录以测试完整功能"})})]}),s.jsxs(r,{className:"mb-6",children:[s.jsxs(a,{children:[s.jsx(i,{children:"测试控制"}),s.jsx(c,{children:"运行各种测试来验证架构分离的正确性"})]}),s.jsx(n,{children:s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx(l,{onClick:async()=>{g(!0),j([]),d.secureLog("开始架构测试",{timestamp:(new Date).toISOString()}),await v(),await new Promise(s=>setTimeout(s,1e3)),await S(),await new Promise(s=>setTimeout(s,1e3)),await(async()=>{if(p){N("邀请系统","pending","正在测试邀请系统功能...");try{const s=await x.generateInviteLink(p.id);b("邀请系统","success","邀请系统测试成功",{inviteLink:s})}catch(s){b("邀请系统","error",`邀请系统测试失败: ${s instanceof Error?s.message:"未知错误"}`)}}else N("邀请系统","error","请先登录后再测试邀请功能")})(),await new Promise(s=>setTimeout(s,1e3)),await(async()=>{if(p){N("使用次数管理","pending","正在测试使用次数管理功能...");try{const s=await x.getUserUsage(p.id);b("使用次数管理","success","使用次数管理测试成功",s)}catch(s){b("使用次数管理","error",`使用次数管理测试失败: ${s instanceof Error?s.message:"未知错误"}`)}}else N("使用次数管理","error","请先登录后再测试使用次数功能")})(),await new Promise(s=>setTimeout(s,1e3)),await(async()=>{if(p){N("余额管理","pending","正在测试余额管理功能...");try{const s=await x.getUserBalance(p.id);b("余额管理","success","余额管理测试成功",s)}catch(s){b("余额管理","error",`余额管理测试失败: ${s instanceof Error?s.message:"未知错误"}`)}}else N("余额管理","error","请先登录后再测试余额功能")})(),await new Promise(s=>setTimeout(s,1e3)),await(async()=>{if(p){N("用户行为记录","pending","正在测试用户行为记录功能...");try{await x.recordUserAction(p.id,"test_action",{page:"ArchitectureTestPage",action:"test",timestamp:(new Date).toISOString()}),b("用户行为记录","success","用户行为记录测试成功")}catch(s){b("用户行为记录","error",`用户行为记录测试失败: ${s instanceof Error?s.message:"未知错误"}`)}}else N("用户行为记录","error","请先登录后再测试行为记录功能")})(),d.secureLog("架构测试完成",{timestamp:(new Date).toISOString(),results:h}),g(!1);const s=h.filter(s=>"success"===s.status).length,e=h.length;y({title:"测试完成",description:`成功: ${s}/${e}`})},disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:u?"测试中...":"运行所有测试"}),s.jsx(l,{onClick:v,disabled:u,variant:"outline",children:"测试Authing功能"}),s.jsx(l,{onClick:S,disabled:u,variant:"outline",children:"测试后端功能"}),s.jsx(l,{onClick:()=>{j([])},disabled:u,variant:"outline",children:"清除结果"})]})})]}),s.jsxs(r,{children:[s.jsxs(a,{children:[s.jsx(i,{children:"测试结果"}),s.jsx(c,{children:"显示各项功能的测试结果和详细信息"})]}),s.jsx(n,{children:0===h.length?s.jsx("p",{className:"text-gray-500 text-center py-8",children:"暂无测试结果，请运行测试"}):s.jsx("div",{className:"space-y-4",children:h.map((e,t)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"font-semibold",children:e.name}),s.jsx(o,{variant:"success"===e.status?"default":"error"===e.status?"destructive":"secondary",children:"success"===e.status?"成功":"error"===e.status?"失败":"进行中"})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),e.data&&s.jsxs("div",{className:"mt-2",children:[s.jsx(m,{className:"my-2"}),s.jsxs("details",{className:"text-sm",children:[s.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"查看详细数据"}),s.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(e.data,null,2)})]})]})]},t))})})]}),s.jsxs(r,{className:"mt-6",children:[s.jsx(a,{children:s.jsx(i,{children:"架构说明"})}),s.jsx(n,{children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-blue-600",children:"Authing处理的功能"}),s.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 mt-2",children:[s.jsx("li",{children:"用户身份认证（登录/注册）"}),s.jsx("li",{children:"用户基本信息管理"}),s.jsx("li",{children:"Token生成和验证"}),s.jsx("li",{children:"会话管理"}),s.jsx("li",{children:"基础角色管理"})]})]}),s.jsx(m,{}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-green-600",children:"自建后端处理的功能"}),s.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 mt-2",children:[s.jsx("li",{children:"用户业务数据管理"}),s.jsx("li",{children:"邀请系统（链接生成、关系绑定、奖励发放）"}),s.jsx("li",{children:"使用次数管理（发放、消费、查询）"}),s.jsx("li",{children:"余额/积分管理"}),s.jsx("li",{children:"订阅/套餐管理"}),s.jsx("li",{children:"支付处理"}),s.jsx("li",{children:"用户行为记录"})]})]})]})})]})]})})}export{h as default};
