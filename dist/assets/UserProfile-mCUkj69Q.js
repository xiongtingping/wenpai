import{r as s,_ as e,aC as a,u as t,p as i,j as c,C as l,i as n,ay as r,B as m,au as x,av as d,aw as h,e as o,f as j,h as p,g as N,n as g,o as u,aD as f,k as v,S as w,aE as y}from"./index-Dk-gCvGC.js";import{S}from"./separator-BIt6tbUO.js";import{L as k}from"./log-out-Deq_tWBf.js";import{M as C}from"./mail-BkG_m5ft.js";import{P as A}from"./phone-CLPPOhiD.js";import{S as D}from"./square-pen-Bvl9tt87.js";function z({className:z="",showActions:L=!0,compact:U=!1}){const[b,I]=s.useState(null),[P,E]=s.useState(!0),[F,V]=s.useState(null),{isAuthenticated:O,logout:q}=e(),{checkLoginStatus:B,getCurrentUser:M,showLogin:_}=a(),{toast:G}=t(),H=i(),J=async()=>{try{await q(),G({title:"登出成功",description:"您已安全退出登录"}),H("/")}catch(s){G({title:"登出失败",description:"请稍后重试",variant:"destructive"})}};return s.useEffect(()=>{O?(async()=>{try{if(E(!0),V(null),!(await B()))return V("用户未登录"),void E(!1);const s=await M();if(s){const e={id:String(s.id||s.userId||""),username:String(s.username||""),nickname:String(s.nickname||s.username||"用户"),email:String(s.email||""),phone:String(s.phone||""),photo:String(s.photo||s.avatar||""),createdAt:String(s.createdAt||(new Date).toISOString()),updatedAt:String(s.updatedAt||(new Date).toISOString()),...s};I(e),y.secureLog("用户信息加载成功",{userId:e.id,hasEmail:!!e.email,hasPhone:!!e.phone})}else V("无法获取用户信息")}catch(s){V("加载用户信息失败"),y.secureLog("用户信息加载失败",{error:s instanceof Error?s.message:"未知错误"},"error")}finally{E(!1)}})():(E(!1),V("用户未登录"))},[O]),P?c.jsx(l,{className:z,children:c.jsx(n,{className:"p-6",children:c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"animate-pulse bg-gray-200 rounded-full w-16 h-16"}),c.jsxs("div",{className:"space-y-2 flex-1",children:[c.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-3/4"}),c.jsx("div",{className:"animate-pulse bg-gray-200 h-3 rounded w-1/2"})]})]})})}):F||!b?c.jsx(l,{className:z,children:c.jsx(n,{className:"p-6",children:c.jsxs("div",{className:"text-center text-gray-500",children:[c.jsx(r,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),c.jsx("p",{className:"text-sm",children:F||"用户信息不可用"}),L&&c.jsx(m,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>_(),children:"去登录"})]})})}):U?c.jsx(l,{className:z,children:c.jsx(n,{className:"p-4",children:c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs(x,{className:"w-10 h-10",children:[c.jsx(d,{src:b.photo,alt:b.nickname}),c.jsx(h,{children:b.nickname.charAt(0).toUpperCase()})]}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-sm font-medium truncate",children:b.nickname}),c.jsx("p",{className:"text-xs text-gray-500 truncate",children:b.email||b.phone||"未设置联系方式"})]}),L&&c.jsx(m,{variant:"ghost",size:"sm",onClick:J,children:c.jsx(k,{className:"w-4 h-4"})})]})})}):c.jsxs(l,{className:z,children:[c.jsxs(o,{children:[c.jsxs(j,{className:"flex items-center gap-2",children:[c.jsx(r,{className:"w-5 h-5"}),"用户信息"]}),c.jsx(p,{children:"您的账户信息和设置"})]}),c.jsxs(n,{className:"space-y-6",children:[c.jsxs("div",{className:"flex items-start space-x-4",children:[c.jsxs(x,{className:"w-20 h-20",children:[c.jsx(d,{src:b.photo,alt:b.nickname}),c.jsx(h,{className:"text-lg",children:b.nickname.charAt(0).toUpperCase()})]}),c.jsxs("div",{className:"flex-1 space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("h3",{className:"text-xl font-semibold",children:b.nickname}),c.jsx(N,{variant:b.isProUser?"default":"secondary",children:b.isProUser?c.jsxs(c.Fragment,{children:[c.jsx(g,{className:"w-3 h-3 mr-1"}),"专业版"]}):c.jsxs(c.Fragment,{children:[c.jsx(u,{className:"w-3 h-3 mr-1"}),"体验版"]})})]}),c.jsxs("p",{className:"text-sm text-gray-600",children:["@",b.username]}),b.email&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[c.jsx(C,{className:"w-4 h-4"}),c.jsx("span",{children:f.maskValue(b.email,"email")})]}),b.phone&&c.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[c.jsx(A,{className:"w-4 h-4"}),c.jsx("span",{children:f.maskValue(b.phone,"phone")})]})]})]}),c.jsx(S,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[c.jsx(v,{className:"w-4 h-4"}),"账户信息"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"用户ID:"}),c.jsx("p",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1",children:f.maskValue(b.id,"id")})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"注册时间:"}),c.jsx("p",{className:"mt-1",children:new Date(b.createdAt).toLocaleDateString()})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"最后更新:"}),c.jsx("p",{className:"mt-1",children:new Date(b.updatedAt).toLocaleDateString()})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"账户类型:"}),c.jsx("p",{className:"mt-1",children:"premium"===b.plan?"高级版":"pro"===b.plan?"专业版":"体验版"})]})]})]}),L&&c.jsxs(c.Fragment,{children:[c.jsx(S,{}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{H("/profile")},className:"flex items-center gap-1",children:[c.jsx(D,{className:"w-4 h-4"}),"编辑资料"]}),c.jsxs(m,{variant:"outline",size:"sm",onClick:()=>H("/settings"),className:"flex items-center gap-1",children:[c.jsx(w,{className:"w-4 h-4"}),"设置"]}),!b.isProUser&&c.jsxs(m,{variant:"default",size:"sm",onClick:()=>{H("/payment")},className:"flex items-center gap-1",children:[c.jsx(g,{className:"w-4 h-4"}),"升级账户"]}),c.jsxs(m,{variant:"destructive",size:"sm",onClick:J,className:"flex items-center gap-1 ml-auto",children:[c.jsx(k,{className:"w-4 h-4"}),"退出登录"]})]})]})]})]})}export{z as U};
