import{j as e}from"./ui-core-CkDiOLPZ.js";import{r as s}from"./router-CDHmMMQ-.js";import{C as a,a as t,b as l,e as i,B as n,u as r,S as c,d as o}from"./pages-home-cm4XWoxC.js";import{B as d,L as m,T as x,I as h,o as u,i as j,j as p,k as g,l as v,S as N,e as f,f as w,g as b,h as y}from"./pages-adapt-BekQTgf9.js";import{n as k,U as C,N as S}from"./api-services-CFC91rmd.js";import{a as $}from"./pages-content-extractor-BZ1ALdwH.js";import{A as E,a as T,P as z}from"./pages-brand-CdVj9KMe.js";import{ab as P,as as I,e as R,C as A,X as U,at as B,au as F,av as L,n as D,g as M,x as O,aw as G,z as V,W as q,w as J,ar as W,h as _,a5 as H,m as K}from"./utils-DOwhHgxs.js";import"./react-vendor-D7XYiaTe.js";import"./components-landing-lYQV1woT.js";import"./components-layout-Dpkc7dU5.js";import"./components-auth-Cmg7TtKX.js";function Q({onUploadComplete:r,onReset:c}){const[o,h]=s.useState("image"),[u,j]=s.useState(null),[p,g]=s.useState(""),[v,N]=s.useState(!1),[f,w]=s.useState(null),b=s.useRef(null),y=()=>{j(null),g(""),w(null),N(!1),b.current&&(b.current.value=""),c()},k=()=>{var e;null==(e=b.current)||e.click()};return e.jsxs(a,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(t,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"上传品牌素材"]})}),e.jsxs(i,{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"image"===o?"default":"outline",onClick:()=>h("image"),className:"flex-1",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"上传图片"]}),e.jsxs(n,{variant:"description"===o?"default":"outline",onClick:()=>h("description"),className:"flex-1",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"文字描述"]})]}),f&&e.jsx(E,{variant:"destructive",children:e.jsx(T,{children:f})}),"image"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors",onClick:k,children:u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:URL.createObjectURL(u),alt:"预览",className:"w-32 h-32 object-cover rounded-lg"}),e.jsxs(d,{className:"absolute -top-2 -right-2 bg-green-500",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"已上传"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:u.name})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"点击上传品牌图片"}),e.jsx("p",{className:"text-sm text-gray-500",children:"支持 JPG、PNG 格式，最大 5MB"})]})]})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&(a.type.startsWith("image/")?a.size>5242880?w("图片大小不能超过5MB"):(w(null),j(a),N(!0),setTimeout(()=>{N(!1),r({image:a})},1e3)):w("请上传图片文件"))},className:"hidden"}),u&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:k,variant:"outline",className:"flex-1",children:"重新选择"}),e.jsx(n,{onClick:y,variant:"outline",children:e.jsx(U,{className:"w-4 h-4"})})]})]}),"description"===o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"品牌描述"}),e.jsx(x,{id:"description",placeholder:"请描述您的品牌特点，例如：科技公司，蓝色主题，简约现代风格...",value:p,onChange:e=>g(e.target.value),rows:4,className:"resize-none"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:()=>{p.trim()?(w(null),N(!0),setTimeout(()=>{N(!1),r({description:p.trim()})},500)):w("请输入品牌描述")},disabled:v||!p.trim(),className:"flex-1",children:v?"处理中...":"提交描述"}),e.jsx(n,{onClick:y,variant:"outline",children:e.jsx(U,{className:"w-4 h-4"})})]})]}),v&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"image"===o?"正在上传图片...":"正在处理描述..."})]})]})]})}const X=["开心微笑","大笑","生气","哭泣","惊讶","疑惑","睡觉","吐舌","鼓掌","比心","点赞","OK 手势","拒绝","拍头","举手提问","加油","挑眉","害羞","眨眼","黑脸","鼻涕泡","流口水","咀嚼","偷笑","吓到","打喷嚏","爱心眼","庆祝","拿红包","举杯微笑"],Y=[{value:"cute",label:"可爱风格",emoji:"🥰"},{value:"modern",label:"现代简约",emoji:"✨"},{value:"vintage",label:"复古经典",emoji:"📷"},{value:"cartoon",label:"卡通动漫",emoji:"🎨"},{value:"minimalist",label:"极简主义",emoji:"⚪"},{value:"3d",label:"3D立体",emoji:"🎯"}],Z=["简单","适中","复杂","非常复杂","极度复杂"];function ee(e,s){return X.map(a=>({emotion:a,prompt:`一个${s}品牌卡通形象正在${a}，${e}，表情风格为 emoji，扁平卡通风，透明背景`}))}function se(e,s,a){const t=function(e,s){var a;if(!e)return"";let t="";const l=(null==(a=Y.find(e=>e.value===s))?void 0:a.label)||"可爱";return e.image?t=`基于上传的品牌图片，创建一个${l}的Emoji表情`:e.description&&(t=`基于描述"${e.description}"，创建一个${l}的Emoji表情`),t}(e,s);let l=`${t}，${Z[a-1]}程度的设计，`;switch(s){case"cute":l+="圆润的线条，温暖的色彩，充满亲和力";break;case"modern":l+="简洁的几何形状，清晰的轮廓，现代感十足";break;case"vintage":l+="复古色调，经典元素，怀旧风格";break;case"cartoon":l+="夸张的表情，鲜艳的色彩，卡通风格";break;case"minimalist":l+="极简设计，单一色彩，简洁明了";break;case"3d":l+="立体效果，光影层次，3D渲染风格"}return l}function ae({uploadedData:o,onPromptReady:j,onBatchPromptsReady:p,onBrandChange:g,onBack:v}){const[N,f]=s.useState(""),[w,b]=s.useState(""),[y,k]=s.useState(!1),[C,S]=s.useState("cute"),[$,E]=s.useState([3]),[T,z]=s.useState(!1),[P,I]=s.useState(""),[R,A]=s.useState("single"),[U,G]=s.useState([]),{toast:V}=r();return s.useEffect(()=>{if(o&&"single"===R){const e=se(o,C,$[0]);f(e),T||b(e)}},[o,C,$,R,T]),e.jsxs(a,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(t,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"构建生成提示词"]})}),e.jsxs(i,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"生成模式"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"single"===R?"default":"outline",onClick:()=>A("single"),className:"flex-1",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"单个提示词"]}),e.jsxs(n,{variant:"batch"===R?"default":"outline",onClick:()=>A("batch"),className:"flex-1",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"批量情绪"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"brand-name",children:"品牌名称"}),e.jsx(h,{id:"brand-name",placeholder:"请输入您的品牌名称",value:P,onChange:e=>{I(e.target.value),null==g||g(e.target.value)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"选择风格"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Y.map(s=>e.jsxs(n,{variant:C===s.value?"default":"outline",onClick:()=>S(s.value),className:"flex flex-col items-center gap-1 h-auto py-3",children:[e.jsx("span",{className:"text-lg",children:s.emoji}),e.jsx("span",{className:"text-xs",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{children:["设计复杂度: ",Z[$[0]-1]]}),e.jsx(u,{value:$,onValueChange:E,max:5,min:1,step:1,className:"w-full"})]}),e.jsx(n,{onClick:async()=>{k(!0),setTimeout(()=>{if("single"===R){const e=se(o,C,$[0]);f(e),b(e)}else{const e=function(e,s,a,t="品牌"){return ee((null==e?void 0:e.description)||"卡通形象",t).map(({emotion:e,prompt:t})=>{var l;return{emotion:e,prompt:`${t}，${(null==(l=Y.find(e=>e.value===s))?void 0:l.label)||"可爱"}风格，${Z[a-1]}程度的设计`}})}(o,C,$[0],P);G(e)}k(!1),V({title:"Prompt生成完成",description:"single"===R?"已为您生成个性化的Emoji生成提示词":`已生成${U.length}个情绪提示词`})},2e3)},disabled:y||!o||"batch"===R&&!P.trim(),className:"w-full",children:y?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"single"===R?"自动生成Prompt":"生成批量情绪Prompt"]})}),"single"===R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{htmlFor:"custom-prompt",children:"自定义Prompt"}),e.jsx(c,{id:"custom-prompt",checked:T,onCheckedChange:z})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"生成提示词"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{value:T?w:N,onChange:e=>b(e.target.value),placeholder:"正在生成个性化提示词...",rows:4,className:"resize-none pr-12",disabled:!T}),e.jsx(n,{size:"sm",variant:"ghost",onClick:async()=>{const e=T?w:N;try{await navigator.clipboard.writeText(e),V({title:"复制成功",description:"Prompt已复制到剪贴板"})}catch(s){V({title:"复制失败",description:"请手动复制文本",variant:"destructive"})}},className:"absolute top-2 right-2",children:e.jsx(O,{className:"w-4 h-4"})})]})]})]}),"batch"===R&&U.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{children:["批量情绪提示词 (",U.length,"个)"]}),e.jsxs(n,{size:"sm",variant:"ghost",onClick:async()=>{const e=U.map(e=>`${e.emotion}: ${e.prompt}`).join("\n\n");try{await navigator.clipboard.writeText(e),V({title:"复制成功",description:"批量提示词已复制到剪贴板"})}catch(s){V({title:"复制失败",description:"请手动复制文本",variant:"destructive"})}},children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"复制全部"]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border rounded-lg p-3",children:U.map((s,a)=>e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(d,{variant:"secondary",children:s.emotion}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>navigator.clipboard.writeText(s.prompt),children:e.jsx(O,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.prompt})]},a))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:v,variant:"outline",className:"flex-1",children:"返回"}),e.jsx(n,{onClick:()=>{if("single"===R){const e=T?w:N;if(!e.trim())return void V({title:"提示词不能为空",description:"请先生成或输入提示词",variant:"destructive"});j(e)}else{if(0===U.length)return void V({title:"批量提示词为空",description:"请先生成批量提示词",variant:"destructive"});null==p||p(U)}},disabled:"single"===R?!N.trim()&&!w.trim():0===U.length,className:"flex-1",children:"single"===R?"确认使用":"开始批量生成"})]})]})]})}function te({character:c,brand:o,uploadedImage:d}){const[m,x]=s.useState([]),[h,u]=s.useState(!1),[j,p]=s.useState(0),[g,v]=s.useState(""),[N,f]=s.useState(0),[w,b]=s.useState(0),{toast:y}=r(),k=(e,s="生成失败")=>`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(`\n      <svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">\n        <rect width="64" height="64" fill="#f3f4f6"/>\n        <text x="32" y="32" text-anchor="middle" dy=".3em" fill="#9ca3af" font-size="8">${e}</text>\n        <text x="32" y="44" text-anchor="middle" dy=".3em" fill="#9ca3af" font-size="6">${s}</text>\n      </svg>\n    `)))}`,C=async e=>{var s,a,t;let l=null;for(let n=1;n<=3;n++)try{const l={provider:"openai",action:"generate-image",prompt:e,n:1,size:"512x512",response_format:"url"};if(d){const s=await S(d);l.reference_image=s,l.prompt=`基于参考图片的风格和特征，${e}`}const i=await fetch("/.netlify/functions/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const n=await i.json();if(n.success&&(null==(t=null==(a=null==(s=n.data)?void 0:s.images)?void 0:a[0])?void 0:t.url))return n.data.images[0].url;throw new Error(n.error||n.message||"图像生成失败")}catch(i){if(l=i instanceof Error?i:new Error(String(i)),n<3){const e=1e3*n;await new Promise(s=>setTimeout(s,e))}}throw new Error(`图像生成失败，已重试3次: ${null==l?void 0:l.message}`)};function S(e){return new Promise((s,a)=>{const t=new FileReader;t.readAsDataURL(e),t.onload=a=>{const l=t.result;if(e.size<1048576){const e=l.split(",")[1];return void s(e)}const i=new Image;i.onload=()=>{const e=document.createElement("canvas"),a=e.getContext("2d");let{width:t,height:l}=i;const n=512;t>l?t>n&&(l=l*n/t,t=n):l>n&&(t=t*n/l,l=n),e.width=t,e.height=l,null==a||a.drawImage(i,0,0,t,l);const r=e.toDataURL("image/jpeg",.7).split(",")[1];s(r)},i.onerror=()=>{const e=l.split(",")[1];s(e)},i.src=l},t.onerror=e=>a(e)})}return e.jsxs(a,{className:"w-full",children:[e.jsx(t,{children:e.jsx(l,{className:"text-xl font-bold",children:"Step 3：AI 生成品牌 Emoji"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsx(n,{onClick:async()=>{u(!0),x([]),p(0),v(""),b(0);try{const s=ee(c,o);f(s.length);const a=[],t=s.length;for(let l=0;l<t;l++){const{prompt:i,emotion:n}=s[l];try{v(n),b(l+1),p((l+1)/t*100);const e=await C(i);a.push({emotion:n,url:e}),(l+1)%3==0&&l<t-1&&await new Promise(e=>setTimeout(e,3e3))}catch(e){a.push({emotion:n,url:k(n,"生成失败")}),a.slice(-2).filter(e=>e.url.includes("生成失败")).length>=2&&await new Promise(e=>setTimeout(e,8e3))}}x(a),y({title:"生成完成",description:`成功生成 ${a.length} 个个性化Emoji`})}catch(e){y({title:"生成失败",description:e instanceof Error?e.message:"请重试",variant:"destructive"})}finally{u(!1),p(0),v(""),b(0),f(0)}},disabled:h,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:h?"生成中...":"开始生成"}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"生成进度"}),e.jsxs("span",{children:[w,"/",N," (",Math.round(j),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:`${j}%`}})}),g&&e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["正在生成: ",g]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["预计剩余时间: ",Math.ceil(8*(N-w))," 秒"]})]}),m.length>0&&e.jsx("div",{className:"grid grid-cols-5 gap-4 mt-4",children:m.map(({emotion:s,url:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:a,alt:s,className:"w-16 h-16 object-contain mx-auto border rounded-lg"}),e.jsx("p",{className:"text-xs mt-1 text-gray-600",children:s})]},s))})]})]})}function le({emojis:s,onDelete:a,onRegenerate:t}){return e.jsx("div",{className:"grid grid-cols-5 gap-4",children:s.map(({emotion:s,url:l})=>e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:l,alt:s,className:"w-16 h-16 mx-auto cursor-pointer",onClick:()=>navigator.clipboard.writeText(l),title:"点击复制链接"}),e.jsx("p",{className:"text-xs",children:s}),e.jsxs("div",{className:"flex justify-center space-x-2 mt-1",children:[e.jsx("button",{className:"text-red-500 text-xs",onClick:()=>a(s),children:"删除"}),e.jsx("button",{className:"text-blue-500 text-xs",onClick:()=>t(s),children:"重生"})]})]},s))})}function ie(){const[t,l]=s.useState("upload"),[r,c]=s.useState(null),[o,d]=s.useState(""),[m,x]=s.useState([]),[h,u]=s.useState([]),[j,p]=s.useState(!1),[g,v]=s.useState("single"),[N,f]=s.useState(""),[w,b]=s.useState(""),y=[{id:"upload",title:"上传素材",description:"上传品牌图片或输入描述"},{id:"build",title:"构建提示词",description:"生成个性化生成提示词"},{id:"generate",title:"生成Emoji",description:"AI生成个性化Emoji"},{id:"gallery",title:"作品展示",description:"查看和管理生成的Emoji"}],k=y.findIndex(e=>e.id===t),C=e=>{c(e),e.description&&f(e.description),l("build")},S=e=>{d(e),v("single"),l("generate")},$=e=>{x(e),v("batch"),l("generate")},E=e=>{b(e)},T=()=>{switch(t){case"build":l("upload");break;case"generate":l("build");break;case"gallery":l("generate")}},P=()=>{l("upload"),c(null),d(""),x([]),u([]),v("single"),f(""),b("")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"个性化品牌 Emoji 生成器"}),e.jsx("p",{className:"text-gray-600",children:"基于您的品牌特色，AI智能生成专属Emoji表情"})]}),e.jsx(a,{children:e.jsxs(i,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:y.map((s,a)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`\n                      w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium\n                      ${a<=k?"bg-blue-500 text-white":"bg-gray-200 text-gray-500"}\n                    `,children:a<k?e.jsx(A,{className:"w-5 h-5"}):a+1}),e.jsxs("div",{className:"text-xs mt-2 text-center max-w-20",children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-gray-500",children:s.description})]})]}),a<y.length-1&&e.jsx("div",{className:`\n                      w-16 h-0.5 mx-4\n                      ${a<k?"bg-blue-500":"bg-gray-200"}\n                    `})]},s.id))}),e.jsxs("div",{className:"mt-6",children:[e.jsx(z,{value:k/(y.length-1)*100,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:["步骤 ",k+1," / ",y.length]}),e.jsxs("span",{children:[Math.round(k/(y.length-1)*100),"% 完成"]})]})]})]})}),e.jsx("div",{className:"min-h-[600px]",children:(()=>{switch(t){case"upload":return e.jsx(Q,{onUploadComplete:C,onReset:P});case"build":return e.jsx(ae,{uploadedData:r,onPromptReady:S,onBatchPromptsReady:$,onBack:T,onBrandChange:E});case"generate":return e.jsx(te,{character:N||"卡通形象",brand:w||"品牌",uploadedImage:null==r?void 0:r.image});case"gallery":return e.jsx(le,{emojis:h.map(e=>({emotion:e.emotion||"未知",url:e.url})),onDelete:e=>{const s=h.find(s=>s.emotion===e);var a;s&&(a=s.id,u(e=>e.filter(e=>e.id!==a)))},onRegenerate:e=>{l("generate")}});default:return null}})()}),e.jsx(a,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["已生成 ",h.length," 个个性化Emoji","batch"===g&&m.length>0&&e.jsxs("span",{className:"ml-2 text-blue-600",children:["(批量模式: ",m.length,"个情绪)"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:["upload"!==t&&e.jsx(n,{onClick:P,variant:"outline",size:"sm",children:"重新开始"}),h.length>0&&e.jsx(n,{onClick:()=>l("gallery"),variant:"outline",size:"sm",children:"查看作品集"})]})]})})})]})})}const ne=()=>{const[c,u]=s.useState([]),[E,T]=s.useState([]),[z,P]=s.useState(""),[I,R]=s.useState("all"),[A,U]=s.useState("color"),[B,F]=s.useState(null),[Q,X]=s.useState("gallery"),[Y,Z]=s.useState(!1),[ee,se]=s.useState("grid"),[ae,te]=s.useState(new Set),[le,ne]=s.useState(""),[re,ce]=s.useState(!1),[oe,de]=s.useState([]),[me,xe]=s.useState(""),{toast:he}=r(),ue=s.useMemo(()=>k.getEmojiStats().byGroup,[]);s.useEffect(()=>{const e=k.getAllEmojis();u(e),T(e)},[]),s.useEffect(()=>{let e=c;z&&(e=k.searchEmojis(z)),"all"!==I&&(e=e.filter(e=>e.group===I)),T(e)},[c,z,I]);const je=async e=>{try{let s=e.unicode;e.hasSkinTone&&(s=k.applySkinToneModifier(e.unicode,"medium")),await navigator.clipboard.writeText(s),he({title:"复制成功",description:`已复制 ${s} 到剪贴板`})}catch(s){he({title:"复制失败",description:"请手动复制",variant:"destructive"})}},pe=e=>e.hasSkinTone?k.applySkinToneModifier(e.unicode,"medium"):e.unicode;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8 space-y-6",children:e.jsxs(j,{value:Q,onValueChange:X,children:[e.jsxs(p,{className:"grid w-full grid-cols-3",children:[e.jsxs(g,{value:"gallery",className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Emoji图库"]}),e.jsxs(g,{value:"ai-recommend",className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"AI推荐"]}),e.jsxs(g,{value:"brand-emoji",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"品牌Emoji生成器"]})]}),e.jsxs(v,{value:"gallery",className:"space-y-6",children:[e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"搜索emoji、名称或关键词...",value:z,onChange:e=>P(e.target.value),className:"pl-10"})]}),e.jsxs(N,{value:I,onValueChange:R,children:[e.jsx(f,{className:"w-48",children:e.jsx(w,{placeholder:"选择分类"})}),e.jsxs(b,{children:[e.jsx(y,{value:"all",children:"全部分类"}),C.map(s=>e.jsxs(y,{value:s,children:[s," (",ue[s]||0,")"]},s))]})]}),e.jsxs(N,{value:A,onValueChange:e=>U(e),children:[e.jsx(f,{className:"w-40",children:e.jsx(w,{placeholder:"选择风格"})}),e.jsx(b,{children:Object.entries(S).map(([s,a])=>e.jsx(y,{value:s,children:a.name},s))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"grid"===ee?"default":"outline",size:"sm",onClick:()=>se("grid"),children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx(n,{variant:"list"===ee?"default":"outline",size:"sm",onClick:()=>se("list"),children:e.jsx(q,{className:"w-4 h-4"})})]})]})})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(n,{variant:"all"===I?"default":"outline",size:"sm",onClick:()=>R("all"),children:"全部"}),C.map(s=>e.jsxs(n,{variant:I===s?"default":"outline",size:"sm",onClick:()=>R(s),className:"flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline",children:s}),e.jsx(d,{variant:"secondary",className:"text-xs",children:ue[s]||0})]},s))]}),e.jsx("div",{className:"grid"===ee?"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 xl:grid-cols-12 gap-4":"space-y-2",children:E.map(s=>e.jsx(a,{className:"group cursor-pointer hover:shadow-lg transition-all duration-200 "+("grid"===ee?"aspect-square":"flex-row"),children:e.jsxs(i,{className:"p-4 "+("list"===ee?"flex items-center gap-4":""),children:[e.jsxs("div",{className:`relative ${"grid"===ee?"aspect-square mb-2":"w-12 h-12"} flex items-center justify-center`,children:[e.jsx("div",{className:"text-4xl cursor-pointer hover:scale-110 transition-transform",onClick:()=>je(s),title:`${s.name} (${s.unicode})`,children:pe(s)}),e.jsx(n,{variant:"ghost",size:"sm",className:"absolute top-0 right-0 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity "+("list"===ee?"relative opacity-100":""),onClick:e=>{var a;e.stopPropagation(),a=s.unicode,te(e=>{const s=new Set(e);return s.has(a)?s.delete(a):s.add(a),s})},children:e.jsx(J,{className:"w-3 h-3 "+(ae.has(s.unicode)?"fill-red-500 text-red-500":"")})})]}),e.jsxs("div",{className:"text-center "+("list"===ee?"flex-1 text-left":""),children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 truncate",children:s.name}),"list"===ee&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"mr-2",children:s.group}),s.hasSkinTone&&e.jsx(d,{variant:"outline",className:"text-xs mr-1",children:"肤色"}),s.hasGender&&e.jsx(d,{variant:"outline",className:"text-xs",children:"性别"})]})]}),"list"===ee&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),je(s)},children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{try{const s=k.generateEmojiUrl(e.codepoint,"color",128),a=await fetch(s);if(!a.ok)throw new Error("下载失败");const t=await a.blob(),l=window.URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=`${e.name.replace(/\s+/g,"-")}-${e.unicode}-noto-color.png`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(l),document.body.removeChild(i),he({title:"下载成功",description:`已下载 ${e.name}`})}catch(s){he({title:"下载失败",description:"图片资源可能不可用，请稍后重试",variant:"destructive"})}})(s)},children:e.jsx(W,{className:"w-4 h-4"})})]})]})},s.codepoint))}),0===E.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"没有找到相关emoji"}),e.jsx("p",{className:"text-gray-500",children:"尝试调整搜索条件或选择其他分类"})]})]}),e.jsx(v,{value:"ai-recommend",className:"space-y-6",children:e.jsxs(a,{children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"AI Emoji推荐"]}),e.jsx(o,{children:"输入内容场景，AI将为您推荐最合适的emoji表情符号"})]}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-2 block",children:"内容场景"}),e.jsx(x,{placeholder:"请输入需要emoji的内容场景，例如：分享一个健身减肥的成功案例、庆祝项目完成、表达对美食的喜爱等...",value:le,onChange:e=>ne(e.target.value),rows:4,className:"w-full"})]}),e.jsx(n,{onClick:async()=>{var e,s,a;if(le.trim()){ce(!0);try{const t=await $.recommendEmojis(le),l=t.data,i=null==l?void 0:l.data;if(!t.success||!(null==(a=null==(s=null==(e=null==i?void 0:i.choices)?void 0:e[0])?void 0:s.message)?void 0:a.content))throw new Error("AI响应格式异常");{const e=i.choices[0].message.content,s=e.match(/推荐emoji[:：]\s*(.+?)(?:\n|推荐理由|$)/i);if(s){const e=s[1].split(/\s+/).filter(e=>e.trim());de(e)}const a=e.match(/推荐理由[:：]\s*(.+?)$/is);xe(a?a[1].trim():e),he({title:"AI推荐完成",description:`已为您推荐 ${oe.length} 个emoji`})}}catch(t){he({title:"推荐失败",description:"请稍后重试AI推荐功能",variant:"destructive"})}finally{ce(!1)}}else he({title:"请输入内容",description:"请提供需要推荐emoji的内容场景",variant:"destructive"})},disabled:re||!le.trim(),className:"w-full",children:re?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"AI推荐中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"获取AI推荐"]})}),oe.length>0&&e.jsxs(a,{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200",children:[e.jsx(t,{children:e.jsxs(l,{className:"text-lg flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-purple-600"}),"AI推荐结果"]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-2 block",children:"推荐的Emoji"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:oe.map((s,a)=>e.jsx(n,{variant:"outline",size:"lg",className:"text-2xl h-12 w-12 p-0",onClick:()=>{navigator.clipboard.writeText(s),he({title:"已复制",description:`已复制 ${s}`})},children:s},a))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:async()=>{try{const e=oe.join(" ");await navigator.clipboard.writeText(e),he({title:"复制成功",description:`已复制推荐的emoji: ${e}`})}catch(e){he({title:"复制失败",description:"请手动复制",variant:"destructive"})}},variant:"outline",size:"sm",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"复制所有"]}),e.jsxs(n,{onClick:()=>{de([]),xe("")},variant:"outline",size:"sm",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"清空结果"]})]})]}),me&&e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-2 block",children:"推荐理由"}),e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:me})})]})]})]}),e.jsxs(a,{className:"bg-gradient-to-r from-green-50 to-teal-50 border-green-200",children:[e.jsx(t,{children:e.jsxs(l,{className:"text-lg flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-green-600"}),"使用建议"]})}),e.jsx(i,{children:e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"标题使用："}),"在标题中放置1-2个最关键的emoji增强吸引力"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"正文穿插："}),"在正文段落间适量使用emoji增加节奏感"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"结尾强化："}),"在结尾使用emoji增强情感表达和互动性"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"平台适配："}),"不同平台的emoji使用习惯有差异，注意调整"]})]})})]})]})]})}),e.jsx(v,{value:"brand-emoji",className:"space-y-6",children:e.jsxs(a,{children:[e.jsxs(t,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"品牌Emoji生成器"]}),e.jsx(o,{children:"输入品牌角色和品牌名，AI将为您生成专属的品牌emoji"})]}),e.jsx(i,{className:"space-y-6",children:e.jsx(ie,{})})]})})]})})})};export{ne as default};
