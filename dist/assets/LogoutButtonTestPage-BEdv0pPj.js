import{r as e,aC as s,u as r,j as i,B as c,k as a,aE as l,p as n,C as t,e as o,f as d,ay as m,h as x,i as h,m as j,l as g,g as u,S as f,al as N,L as p}from"./index-Dk-gCvGC.js";import{S as b}from"./separator-BIt6tbUO.js";import{I as v}from"./input-DhHrf3ht.js";import{u as L}from"./useAuthingStatus-vPdB057W.js";import{A as y,a as w,b as S,c as C,d as U,e as B,f as D,g as k,h as T}from"./alert-dialog-DumHFHKK.js";import{T as z}from"./triangle-alert-gr-ocKAK.js";import{L as F}from"./log-out-Deq_tWBf.js";import{A as I}from"./arrow-left-D5FHeCmc.js";function A({variant:n="destructive",size:t="default",children:o="退出登录",redirectUri:d="/",showConfirm:m=!0,confirmTitle:x="确认退出登录",confirmDescription:h="您确定要退出登录吗？退出后需要重新登录才能访问受保护的功能。",enableSecurityLog:j=!0,className:g="",disabled:u=!1,onLogout:f,onBeforeLogout:N}){const[p,b]=e.useState(!1),{logout:v}=s(),{toast:L}=r(),I=(e,s,r="info")=>{j&&l.secureLog(e,s,r)},A=async()=>{try{if(b(!0),I("用户点击退出登录",{redirectUri:d,timestamp:(new Date).toISOString()}),N&&!(await N()))return void I("退出登录被取消",{reason:"onBeforeLogout returned false"});await v(),I("用户退出登录成功",{redirectUri:d,timestamp:(new Date).toISOString()}),f&&f(),L({title:"退出成功",description:"您已安全退出登录，正在跳转..."})}catch(e){const s=e instanceof Error?e.message:"退出登录失败";I("退出登录失败",{error:s,redirectUri:d,timestamp:(new Date).toISOString()},"error"),L({title:"退出失败",description:s,variant:"destructive"})}finally{b(!1)}},$=i.jsx(i.Fragment,{children:p?i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"退出中..."]}):i.jsxs(i.Fragment,{children:[i.jsx(F,{className:"w-4 h-4 mr-2"}),o]})});return m?i.jsxs(y,{children:[i.jsx(w,{asChild:!0,children:i.jsx(c,{variant:n,size:t,className:g,disabled:u||p,children:$})}),i.jsxs(S,{children:[i.jsxs(C,{children:[i.jsxs(U,{className:"flex items-center gap-2",children:[i.jsx(a,{className:"w-5 h-5 text-orange-500"}),x]}),i.jsxs(B,{className:"flex items-start gap-2",children:[i.jsx(z,{className:"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0"}),h]})]}),i.jsxs(D,{children:[i.jsx(k,{disabled:p,children:"取消"}),i.jsx(T,{onClick:A,disabled:p,className:"bg-red-600 hover:bg-red-700",children:p?i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"退出中..."]}):"确认退出"})]})]})]}):i.jsx(c,{variant:n,size:t,className:g,disabled:u||p,onClick:()=>{A()},children:$})}function $({redirectUri:e="/",children:s="退出登录",className:r="",...c}){return i.jsx(A,{showConfirm:!1,redirectUri:e,className:r,...c,children:s})}function O({redirectUri:e="/",children:s="退出登录",className:r="",...c}){return i.jsx(A,{showConfirm:!0,redirectUri:e,className:r,...c,children:s})}function E(){const s=n(),[r,l]=e.useState("/"),[y,w]=e.useState(!0),[S,C]=e.useState(!0),[U,B]=e.useState("确认退出登录"),[D,k]=e.useState("您确定要退出登录吗？退出后需要重新登录才能访问受保护的功能。"),[T,E]=e.useState([]),{isLoggedIn:W,user:Z,loading:q,error:G}=L({autoCheck:!0,redirectUri:"/logout-button-test",enableSecurityLog:!0}),H=e=>{E(s=>[`${(new Date).toLocaleTimeString()}: ${e}`,...s.slice(0,9)])},J=async()=>(H("退出前检查触发"),!0),K=()=>{H("退出后回调触发")};return i.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs(c,{variant:"ghost",onClick:()=>{s(-1)},className:"mb-4",children:[i.jsx(I,{className:"w-4 h-4 mr-2"}),"返回"]}),i.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"退出登录按钮测试"}),i.jsx("p",{className:"text-gray-600",children:"测试LogoutButton组件的各种功能和样式"})]}),i.jsxs(t,{className:"mb-8",children:[i.jsxs(o,{children:[i.jsxs(d,{className:"flex items-center gap-2",children:[i.jsx(m,{className:"w-5 h-5"}),"当前登录状态"]}),i.jsx(x,{children:"显示当前用户的登录状态和信息"})]}),i.jsx(h,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[q?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}):W?i.jsx(j,{className:"w-4 h-4 text-green-600"}):i.jsx(g,{className:"w-4 h-4 text-red-600"}),i.jsx("span",{className:"font-medium text-blue-900",children:"登录状态"})]}),i.jsx(u,{variant:W?"default":"secondary",children:q?"检查中...":W?"已登录":"未登录"})]}),i.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(m,{className:"w-4 h-4 text-green-600"}),i.jsx("span",{className:"font-medium text-green-900",children:"用户信息"})]}),i.jsx("p",{className:"text-sm text-green-700",children:q?"加载中...":Z?`${Z.nickname} (${Z.username})`:"未获取"})]}),i.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(z,{className:"w-4 h-4 text-red-600"}),i.jsx("span",{className:"font-medium text-red-900",children:"错误状态"})]}),i.jsx("p",{className:"text-sm text-red-700",children:G||"无错误"})]})]})})]}),i.jsxs(t,{className:"mb-8",children:[i.jsxs(o,{children:[i.jsxs(d,{className:"flex items-center gap-2",children:[i.jsx(f,{className:"w-5 h-5"}),"配置选项"]}),i.jsx(x,{children:"自定义退出登录按钮的行为和样式"})]}),i.jsx(h,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(N,{id:"show-confirm",checked:S,onCheckedChange:C}),i.jsx(p,{htmlFor:"show-confirm",children:"显示确认对话框"})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(N,{id:"security-log",checked:y,onCheckedChange:w}),i.jsx(p,{htmlFor:"security-log",children:"启用安全日志"})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(p,{htmlFor:"redirect-uri",children:"跳转路径"}),i.jsx(v,{id:"redirect-uri",value:r,onChange:e=>l(e.target.value),placeholder:"/"})]}),i.jsxs("div",{children:[i.jsx(p,{htmlFor:"custom-title",children:"确认标题"}),i.jsx(v,{id:"custom-title",value:U,onChange:e=>B(e.target.value),placeholder:"确认退出登录"})]}),i.jsxs("div",{children:[i.jsx(p,{htmlFor:"custom-description",children:"确认描述"}),i.jsx(v,{id:"custom-description",value:D,onChange:e=>k(e.target.value),placeholder:"您确定要退出登录吗？"})]})]})]})})]}),i.jsxs("div",{className:"mb-8",children:[i.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(F,{className:"w-5 h-5 text-red-600"}),"按钮样式展示"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs(t,{children:[i.jsxs(o,{children:[i.jsx(d,{children:"基础样式"}),i.jsx(x,{children:"不同变体的退出登录按钮"})]}),i.jsxs(h,{className:"space-y-3",children:[i.jsx(A,{variant:"default",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"默认样式退出"}),i.jsx(A,{variant:"destructive",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"危险样式退出"}),i.jsx(A,{variant:"outline",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"轮廓样式退出"}),i.jsx(A,{variant:"ghost",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"幽灵样式退出"})]})]}),i.jsxs(t,{children:[i.jsxs(o,{children:[i.jsx(d,{children:"按钮大小"}),i.jsx(x,{children:"不同尺寸的退出登录按钮"})]}),i.jsxs(h,{className:"space-y-3",children:[i.jsx(A,{size:"sm",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"小尺寸退出"}),i.jsx(A,{size:"default",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"默认尺寸退出"}),i.jsx(A,{size:"lg",showConfirm:S,redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"大尺寸退出"})]})]})]})]}),i.jsx(b,{className:"my-8"}),i.jsxs("div",{className:"mb-8",children:[i.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[i.jsx(a,{className:"w-5 h-5 text-blue-600"}),"便捷组件"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs(t,{children:[i.jsxs(o,{children:[i.jsx(d,{children:"简化退出按钮"}),i.jsx(x,{children:"基于您提供的代码逻辑，无确认对话框"})]}),i.jsxs(h,{className:"space-y-3",children:[i.jsx($,{redirectUri:r,enableSecurityLog:y,onBeforeLogout:J,onLogout:K,children:"直接退出登录"}),i.jsx($,{variant:"outline",size:"sm",redirectUri:r,enableSecurityLog:y,onBeforeLogout:J,onLogout:K,children:"小尺寸直接退出"})]})]}),i.jsxs(t,{children:[i.jsxs(o,{children:[i.jsx(d,{children:"确认退出按钮"}),i.jsx(x,{children:"带确认对话框的安全退出"})]}),i.jsxs(h,{className:"space-y-3",children:[i.jsx(O,{redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"安全退出登录"}),i.jsx(O,{variant:"outline",size:"lg",redirectUri:r,enableSecurityLog:y,confirmTitle:U,confirmDescription:D,onBeforeLogout:J,onLogout:K,children:"大尺寸安全退出"})]})]})]})]}),i.jsx(b,{className:"my-8"}),i.jsxs(t,{children:[i.jsxs(o,{children:[i.jsxs(d,{className:"flex items-center gap-2",children:[i.jsx(a,{className:"w-5 h-5"}),"退出事件日志"]}),i.jsx(x,{children:"记录退出登录过程中的各种事件"})]}),i.jsxs(h,{children:[i.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-60 overflow-y-auto",children:0===T.length?i.jsx("p",{className:"text-gray-500 text-center",children:"暂无事件记录"}):i.jsx("div",{className:"space-y-2",children:T.map((e,s)=>i.jsx("div",{className:"text-sm text-gray-700 bg-white p-2 rounded border",children:e},s))})}),i.jsx("div",{className:"mt-4",children:i.jsx(c,{variant:"outline",size:"sm",onClick:()=>E([]),children:"清空日志"})})]})]}),i.jsxs(t,{className:"mt-8",children:[i.jsxs(o,{children:[i.jsx(d,{children:"功能特性"}),i.jsx(x,{children:"LogoutButton组件的主要功能和特性"})]}),i.jsx(h,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-3",children:"核心功能"}),i.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[i.jsx("li",{children:"• 安全退出登录"}),i.jsx("li",{children:"• 确认对话框"}),i.jsx("li",{children:"• 自定义跳转路径"}),i.jsx("li",{children:"• 多种样式变体"}),i.jsx("li",{children:"• 加载状态显示"}),i.jsx("li",{children:"• 错误处理"})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-3",children:"安全特性"}),i.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[i.jsx("li",{children:"• 安全日志记录"}),i.jsx("li",{children:"• 退出前回调"}),i.jsx("li",{children:"• 退出后回调"}),i.jsx("li",{children:"• 状态验证"}),i.jsx("li",{children:"• 防重复操作"}),i.jsx("li",{children:"• 用户确认机制"})]})]})]})})]})]})}export{E as default};
