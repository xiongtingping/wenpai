import{Q as r}from"./browser-Cnf2s-_L.js";async function t(r,t){try{const o=await fetch("http://localhost:8888/.netlify/functions/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:r,customerEmail:t})});if(!o.ok){const r=await o.json();throw new Error(r.error||`HTTP error! status: ${o.status}`)}const c=await o.json();return{success:!0,checkout:c.checkout,url:c.url,qrCodeUrl:c.qrCodeUrl,qrCodeDataURL:c.qrCodeDataURL,price:c.price}}catch(o){throw new Error(o.message||"创建支付失败")}}async function o(r,o){var c,a,e;try{const s=await t(r,o),n=s.qrCodeUrl||(null==(c=s.checkout)?void 0:c.alipayQrCodeUrl)||(null==(a=s.checkout)?void 0:a.alipay_qr_code_url)||(null==(e=s.checkout)?void 0:e.qrCodes)&&s.checkout.qrCodes.alipay||s.url||null;if(!n)throw new Error("该产品未配置支付宝二维码支付");return{success:!0,qrUrl:n,price:s.price}}catch(s){throw s}}async function c(c,a){try{const e=await t(c,a);if(e.qrCodeDataURL)return{success:!0,qrCodeDataURL:e.qrCodeDataURL,price:e.price,originalUrl:e.qrCodeUrl||e.url};const s=await o(c,a);if(!s.success||!s.qrUrl)throw new Error("无法获取支付链接");return{success:!0,qrCodeDataURL:await r.toDataURL(s.qrUrl,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}}),price:s.price,originalUrl:s.qrUrl}}catch(e){throw e}}async function a(r,t){try{const o=await async function(r,t){try{const o=await fetch("http://localhost:8888/.netlify/functions/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:r,customerEmail:t})});if(!o.ok){const r=await o.json();throw new Error(r.error||`HTTP error! status: ${o.status}`)}const c=await o.json();if(!c.success||!c.url)throw new Error("无法获取支付页面URL");return{success:!0,url:c.url,checkout:c.checkout}}catch(o){throw o}}(r,t);if(!o.success||!o.url)throw new Error("无法获取支付页面URL");window.location.href=o.url}catch(o){throw o}}export{o as a,t as c,c as g,a as r};
