import{al as e,i as s,j as r,an as n,ao as i,r as d,B as c}from"./index-CqEx2ZQ2.js";import{C as l,a as t,b as a,d as x,c as o}from"./card-DrUj54Xk.js";const m=({children:i,requireAuth:d=!0,redirectTo:c="/login",loadingComponent:l=r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"正在验证权限..."})]})})})=>{const t=e(),{user:a,isAuthenticated:x,loading:o}=s(),m=x;return o?r.jsx(r.Fragment,{children:l}):d&&!m?r.jsx(n,{to:c,state:{from:t},replace:!0}):r.jsx(r.Fragment,{children:i})},h=({children:d,requiredPermissions:c=[],requiredRoles:l=[],redirectTo:t,loadingComponent:a=r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"正在验证权限..."})]})}),noPermissionComponent:x=r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"权限不足"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"您没有访问此页面的权限"}),r.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"返回上一页"})]})})})=>{const o=e(),{loading:m,isAuthenticated:h}=s(),{loading:j,checkPermissions:g}=i();return m||j?r.jsx(r.Fragment,{children:a}):h?0===c.length&&0===l.length||g(c.map(e=>{const[s,r]=e.split(":");return{resource:s,action:r}}),l).hasPermission?r.jsx(r.Fragment,{children:d}):t?r.jsx(n,{to:t,replace:!0}):r.jsx(r.Fragment,{children:x}):r.jsx(n,{to:"/login",state:{from:o},replace:!0})},j=()=>{const{user:e,isAuthenticated:n,error:j}=s(),{roles:g,permissions:p,checkPermissions:u}=i(),[N,b]=d.useState([]),v=e=>{b(s=>[...s,`${(new Date).toLocaleTimeString()}: ${e}`])};return r.jsxs("div",{className:"container mx-auto px-4 py-8",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-4",children:"权限测试页面"}),!1,r.jsx("p",{className:"text-gray-600",children:"此页面用于测试权限系统的各项功能，包括认证、权限检查、角色验证等。"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[r.jsxs(l,{children:[r.jsx(t,{children:r.jsx(a,{children:"认证状态"})}),r.jsx(x,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"已认证:"})," ",n?"✅ 是":"❌ 否"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"用户:"})," ",e?e.username||e.email||e.id:"无"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"错误:"})," ",j||"无"]})]})})]}),r.jsxs(l,{children:[r.jsx(t,{children:r.jsx(a,{children:"权限信息"})}),r.jsx(x,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"角色数量:"})," ",g.length]}),r.jsxs("p",{children:[r.jsx("strong",{children:"权限数量:"})," ",p.length]}),r.jsxs("p",{children:[r.jsx("strong",{children:"环境:"})," ","生产环境"]})]})})]})]}),r.jsxs(l,{className:"mb-8",children:[r.jsxs(t,{children:[r.jsx(a,{children:"测试功能"}),r.jsx(o,{children:"点击按钮测试各项权限功能"})]}),r.jsx(x,{children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx(c,{onClick:()=>{v(`错误信息: ${j||"无"} | 已认证: ${n}`),e&&v(`用户信息: ${e.username||e.email||e.id}`)},variant:"outline",children:"测试基本认证"}),r.jsx(c,{onClick:()=>{v("测试权限守卫 - 需要 content:read 权限")},variant:"outline",children:"测试权限守卫"}),r.jsx(c,{onClick:()=>{v("测试角色守卫 - 需要 admin 角色")},variant:"outline",children:"测试角色守卫"}),r.jsx(c,{onClick:()=>{v("测试复杂权限 - 需要 content:create 权限")},variant:"outline",children:"测试复杂权限"}),r.jsx(c,{onClick:()=>{const e=u([{resource:"content",action:"read"}],["admin"]);v(`权限检查结果: ${JSON.stringify(e)}`)},variant:"outline",children:"测试权限检查"}),r.jsx(c,{onClick:()=>{b([])},variant:"destructive",children:"清除结果"})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[r.jsxs(l,{children:[r.jsxs(t,{children:[r.jsx(a,{children:"基本认证守卫"}),r.jsx(o,{children:"测试需要登录才能访问的内容"})]}),r.jsx(x,{children:r.jsx(m,{children:r.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[r.jsx("p",{className:"text-green-800 font-medium",children:"✅ 认证成功"}),r.jsx("p",{className:"text-green-600 text-sm mt-1",children:"您已通过认证，可以访问此内容"})]})})})]}),r.jsxs(l,{children:[r.jsxs(t,{children:[r.jsx(a,{children:"权限守卫"}),r.jsx(o,{children:"测试需要特定权限才能访问的内容"})]}),r.jsx(x,{children:r.jsx(h,{requiredPermissions:["content:read"],noPermissionComponent:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx("p",{className:"text-red-800 font-medium",children:"❌ 权限不足"}),r.jsx("p",{className:"text-red-600 text-sm mt-1",children:"您没有 content:read 权限"})]}),children:r.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[r.jsx("p",{className:"text-green-800 font-medium",children:"✅ 权限验证通过"}),r.jsx("p",{className:"text-green-600 text-sm mt-1",children:"您有 content:read 权限，可以访问此内容"})]})})})]}),r.jsxs(l,{children:[r.jsxs(t,{children:[r.jsx(a,{children:"角色守卫"}),r.jsx(o,{children:"测试需要特定角色才能访问的内容"})]}),r.jsx(x,{children:r.jsx(h,{requiredRoles:["admin"],noPermissionComponent:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx("p",{className:"text-red-800 font-medium",children:"❌ 角色不足"}),r.jsx("p",{className:"text-red-600 text-sm mt-1",children:"您没有 admin 角色"})]}),children:r.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[r.jsx("p",{className:"text-green-800 font-medium",children:"✅ 角色验证通过"}),r.jsx("p",{className:"text-green-600 text-sm mt-1",children:"您有 admin 角色，可以访问此内容"})]})})})]}),r.jsxs(l,{children:[r.jsxs(t,{children:[r.jsx(a,{children:"复杂权限守卫"}),r.jsx(o,{children:"测试需要多个权限才能访问的内容"})]}),r.jsx(x,{children:r.jsx(h,{requiredPermissions:["content:create"],noPermissionComponent:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx("p",{className:"text-red-800 font-medium",children:"❌ 权限不足"}),r.jsx("p",{className:"text-red-600 text-sm mt-1",children:"您没有 content:create 权限"})]}),children:r.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[r.jsx("p",{className:"text-green-800 font-medium",children:"✅ 权限验证通过"}),r.jsx("p",{className:"text-green-600 text-sm mt-1",children:"您有 content:create 权限，可以访问此内容"})]})})})]})]}),r.jsxs(l,{children:[r.jsxs(t,{children:[r.jsx(a,{children:"测试结果"}),r.jsx(o,{children:"测试操作的详细结果"})]}),r.jsx(x,{children:r.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1",children:0===N.length?r.jsx("p",{className:"text-gray-500",children:"暂无测试结果"}):N.map((e,s)=>r.jsx("div",{className:"text-sm font-mono bg-gray-100 p-2 rounded",children:e},s))})})]})]})};export{j as default};
