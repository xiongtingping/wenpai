var e=Object.defineProperty;import{ao as t}from"./index-CZg_0vaA.js";const r=()=>({openai:{apiKey:"sk-***[已隐藏]***",baseURL:"https://api.openai.com/v1",model:"gpt-4o-mini",timeout:parseInt("30000")},deepseek:{apiKey:"sk-c195bdaf58941978ec7322fc6dd88",baseURL:"https://api.deepseek.com/v1",model:"deepseek-chat",timeout:parseInt("30000")},gemini:{apiKey:"your-gemini-api-key",baseURL:"https://generativelanguage.googleapis.com/v1beta",model:"gemini-pro",timeout:parseInt("30000")},authing:{appId:"6867fdc88034eb95ae86167d",secret:"",host:"https://qutkgzkfaezk-demo.authing.cn",redirectUri:"https://www.wenpai.xyz/callback"},creem:{apiKey:"your-creem-api-key-here",baseURL:"https://api.creem.com",timeout:parseInt("30000")},backend:{baseUrl:"https://www.wenpai.xyz/api",port:parseInt("3001"),timeout:parseInt("30000")},payment:{alipay:{appId:"",publicKey:"",privateKey:""},wechat:{appId:"",mchId:"",apiKey:""}},environment:{isDev:!1,isProd:!0,debugMode:!1,logLevel:"info",nodeEnv:"production"},features:{enableAI:!0,enableImageGeneration:!0,enableContentAdaptation:!0,enableSecurityLogging:!0,enablePayment:!0}});async function n(e){var n,o,a;const i=Date.now(),{prompt:c,model:p="gpt-4",maxTokens:m=2e3,temperature:u=.7,systemPrompt:l,stream:d=!1,userId:g,extraParams:y={}}=e;try{const e=r();if(t(),!e.openai.apiKey)throw new Error("OpenAI API密钥未配置");const h=[];l&&h.push({role:"system",content:l}),h.push({role:"user",content:c});const f={model:s(p),messages:h,max_tokens:m,temperature:u,stream:d,...y},w={"Content-Type":"application/json",Authorization:`Bearer ${e.openai.apiKey}`};g&&(w["X-User-ID"]=g);const v=await fetch(e.openai.baseURL+"/v1/chat/completions",{method:"POST",headers:w,body:JSON.stringify(f)});if(!v.ok){const e=await v.json().catch(()=>({}));throw new Error(`API请求失败: ${v.status} ${v.statusText} - ${(null==(n=e.error)?void 0:n.message)||"未知错误"}`)}if(d)return async function(e,t,r){var n,s,o;const a=null==(n=e.body)?void 0:n.getReader();if(!a)throw new Error("无法读取流式响应");let i="";const c=new TextDecoder;try{for(;;){const{done:e,value:n}=await a.read();if(e)break;const m=c.decode(n).split("\n");for(const a of m)if(a.startsWith("data: ")){const e=a.slice(6);if("[DONE]"===e)return{content:i,model:t,responseTime:Date.now()-r,success:!0};try{const t=null==(o=null==(s=JSON.parse(e).choices[0])?void 0:s.delta)?void 0:o.content;t&&(i+=t)}catch(p){}}}return{content:i,model:t,responseTime:Date.now()-r,success:!0}}finally{a.releaseLock()}}(v,p,i);const b=await v.json();return{content:(null==(a=null==(o=b.choices[0])?void 0:o.message)?void 0:a.content)||"",model:p,usage:b.usage,responseTime:Date.now()-i,success:!0}}catch(h){return{content:"",model:p,responseTime:Date.now()-i,success:!1,error:h instanceof Error?h.message:"未知错误"}}}function s(e){return{"gpt-4":"gpt-4","gpt-4-turbo":"gpt-4-1106-preview","gpt-3.5-turbo":"gpt-3.5-turbo","gemini-pro":"gemini-pro","gemini-pro-vision":"gemini-pro-vision","deepseek-chat":"deepseek-chat","deepseek-coder":"deepseek-coder",qwen:"qwen-turbo",llama:"llama-2-70b-chat",mistral:"mistral-7b-instruct","claude-3":"claude-3-opus-20240229","claude-3-sonnet":"claude-3-sonnet-20240229","claude-3-haiku":"claude-3-haiku-20240307"}[e]||e}function o(e){return{"dall-e-3":"dall-e-3","dall-e-2":"dall-e-2",midjourney:"midjourney","stable-diffusion":"stable-diffusion-xl",deepfloyd:"deepfloyd-if"}[e]||e}const a={model:"gpt-4o",temperature:.7,maxTokens:1e3,timeout:3e4,maxRetries:3,retryDelay:1e3};class i{constructor(){var t,n,s;((t,r,n)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n})(this,"symbol"!=typeof(n="config")?n+"":n,s),this.config=r(),(t=this.config.openai.apiKey)&&"sk-your-openai-api-key-here"!==t&&"your-gemini-api-key-here"!==t&&t.startsWith("sk-")&&t.length}async checkStatus(e="openai"){try{const t=await fetch(function(){r();return"/.netlify/functions/api"}(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e,action:"status"})}),n=await t.json();return{success:t.ok,available:n.available||!1,provider:e,message:n.message,error:n.error}}catch(t){return{success:!1,available:!1,provider:e,error:t instanceof Error?t.message:"网络连接失败"}}}async generateText(e){var t;const{messages:r,model:s=a.model,temperature:o=a.temperature,maxTokens:i=a.maxTokens,provider:c="openai"}=e;try{const e=r.filter(e=>"user"===e.role).map(e=>e.content).join("\n\n"),p=null==(t=r.find(e=>"system"===e.role))?void 0:t.content,m=await async function(e,t=3){let r=null;for(let o=0;o<t;o++){try{const t=await n(e);if(t.success)return t;r=new Error(t.error||"调用失败")}catch(s){r=s instanceof Error?s:new Error("未知错误")}o<t-1&&await new Promise(e=>setTimeout(e,1e3*Math.pow(2,o)))}throw r||new Error("所有重试都失败了")}({prompt:e,model:s,temperature:o,maxTokens:i,systemPrompt:p,extraParams:{provider:c}},a.maxRetries);return m.success?{success:!0,data:{data:{choices:[{message:{content:m.content}}],usage:m.usage}},provider:c,timestamp:(new Date).toISOString()}:{success:!1,error:m.error||"文本生成失败",provider:c,timestamp:(new Date).toISOString()}}catch(p){return{success:!1,error:p instanceof Error?p.message:"文本生成失败",provider:c,timestamp:(new Date).toISOString()}}}async generateImage(e){const{prompt:t,n:n=1,size:s="512x512",response_format:a="url",reference_image:i}=e;try{const e=await async function(e){var t;const n=Date.now(),{prompt:s,model:a="dall-e-3",n:i=1,size:c="1024x1024",responseFormat:p="url",referenceImage:m,userId:u}=e;try{const e=r();if(!e.openai.apiKey)throw new Error("OpenAI API密钥未配置");const l={model:o(a),prompt:s,n:i,size:c,response_format:p};m&&(l.image=m,l.model="dall-e-3");const d={"Content-Type":"application/json",Authorization:`Bearer ${e.openai.apiKey}`};u&&(d["X-User-ID"]=u);const g=await fetch(e.openai.baseURL+"/v1/images/generations",{method:"POST",headers:d,body:JSON.stringify(l)});if(!g.ok){const e=await g.json().catch(()=>({}));throw new Error(`图像生成API请求失败: ${g.status} ${g.statusText} - ${(null==(t=e.error)?void 0:t.message)||"未知错误"}`)}const y=await g.json();return{images:y.data.map(e=>({url:e.url,revisedPrompt:e.revised_prompt})),model:a,responseTime:Date.now()-n,success:!0,created:y.created}}catch(l){return{images:[],model:a,responseTime:Date.now()-n,success:!1,error:l instanceof Error?l.message:"未知错误"}}}({prompt:t,model:"dall-e-3",n:n,size:s,responseFormat:a,referenceImage:i});return e.success?{success:!0,data:{images:e.images,created:e.created},provider:"openai",timestamp:(new Date).toISOString()}:{success:!1,error:e.error||"图像生成失败",provider:"openai",timestamp:(new Date).toISOString()}}catch(c){return{success:!1,error:c instanceof Error?c.message:"图像生成失败",provider:"openai",timestamp:(new Date).toISOString()}}}async generateImagesBatch(e,t={}){const r=[];for(const s of e)try{const n=await this.generateImage({...t,prompt:s});r.push(n),e.length>1&&await new Promise(e=>setTimeout(e,1e3))}catch(n){r.push({success:!1,error:n instanceof Error?n.message:"批量图像生成失败"})}return r}async adaptContent(e,t,r){try{const r=[{role:"system",content:"你是一个专业的内容适配专家，能够将内容适配到不同的平台。"},{role:"user",content:`请将以下内容适配到平台：${t.join(", ")}\n\n内容：${e}`}];return await this.generateText({messages:r,provider:"openai"})}catch(n){return{success:!1,error:n instanceof Error?n.message:"内容适配失败"}}}async summarizeContent(e){try{const t=[{role:"system",content:"你是一个专业的内容总结专家，能够生成简洁有用的总结。"},{role:"user",content:`请为以下内容生成AI智能总结：\n\n${e}`}];return await this.generateText({messages:t,provider:"openai"})}catch(t){return{success:!1,error:t instanceof Error?t.message:"内容总结失败"}}}async analyzeBrandContent(e){try{const t=[{role:"system",content:"你是一个专业的品牌分析专家，能够分析品牌调性、关键词和建议。请以JSON格式返回结果。"},{role:"user",content:`请分析以下品牌内容：\n\n${e}\n\n请返回JSON格式的分析结果，包含：keywords（关键词数组）、tone（语气分析）、suggestions（建议数组）`}];return await this.generateText({messages:t,provider:"openai"})}catch(t){return{success:!1,error:t instanceof Error?t.message:"品牌内容分析失败"}}}async checkContentTone(e,t){try{const r=[{role:"system",content:"你是一个专业的品牌调性检查专家，能够评估内容是否符合品牌调性。"},{role:"user",content:`请检查以下内容是否符合品牌调性：\n\n内容：${e}\n\n品牌档案：${JSON.stringify(t)}`}];return await this.generateText({messages:r,provider:"openai"})}catch(r){return{success:!1,error:r instanceof Error?r.message:"内容调性检查失败"}}}async recommendEmojis(e){try{const t=[{role:"system",content:"你是一个专业的Emoji推荐专家，能够为内容推荐合适的Emoji。"},{role:"user",content:`请为以下内容推荐合适的Emoji：\n\n${e}`}];return await this.generateText({messages:t,provider:"openai"})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Emoji推荐失败"}}}async generateCreativeContent(e){try{const{prompt:t,context:r={},style:n="creative",maxTokens:s=a.maxTokens,contentType:o="text"}=e;let i="你是一个专业的创意内容创作专家，能够生成有创意的文本内容。";switch(o){case"video":i="你是一个专业的视频脚本创作专家，能够生成结构化的视频脚本。";break;case"social_media":i="你是一个专业的社交媒体内容创作专家，能够生成适合各平台的内容。";break;case"brand_consistent":i="你是一个专业的品牌内容创作专家，能够生成符合品牌调性的内容。";break;default:i="你是一个专业的创意内容创作专家，能够生成有创意的文本内容。"}let c="";Object.keys(r).length>0&&(c=`\n\n上下文信息：${JSON.stringify(r,null,2)}`);const p=[{role:"system",content:i},{role:"user",content:`${t}${c}\n\n请以${n}的风格生成内容。`}];return await this.generateText({messages:p,maxTokens:s,provider:"openai"})}catch(t){return{success:!1,error:t instanceof Error?t.message:"创意内容生成失败"}}}async extractContent(e){try{const{url:t,text:r,contentType:n,options:s={}}=e;if(!t&&!r)return{success:!1,error:"请提供URL或文本内容"};const o={provider:"openai",action:"extract-content",contentType:n,options:s};t&&(o.url=t),r&&(o.text=r);const a=await fetch("/.netlify/functions/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const i=await a.json();return i.success?{success:!0,data:i.data}:{success:!1,error:i.error||"内容提取失败"}}catch(t){return{success:!1,error:t instanceof Error?t.message:"网络请求失败"}}}}const c=new i;export{i as AIService,c as default};
