import{j as s}from"./ui-core-BoM6Gtru.js";import{r as e,u as a}from"./router-CDHmMMQ-.js";import{j as t,p as i,u as c,C as r,e as l,B as n,a as m,b as x,d,y as h,s as o}from"./pages-home-B2qezEHm.js";import{a as j,b as p,c as g}from"./components-auth-rO0vuiGv.js";import{B as N}from"./pages-adapt-BAX30gfz.js";import{S as u}from"./pages-hot-topics-DladIUhZ.js";import{U as f,aT as v,i as w,g as y,aU as S,aV as k,o as A,v as C,f as U}from"./utils-Ck01-_Du.js";function b({className:b="",showActions:D=!0,compact:z=!1}){const[L,I]=e.useState(null),[P,V]=e.useState(!0),[E,F]=e.useState(null),{isAuthenticated:B,logout:O}=t(),{checkLoginStatus:T,getCurrentUser:q,showLogin:G}=i(),{toast:H}=c(),J=a(),K=async()=>{try{await O(),H({title:"登出成功",description:"您已安全退出登录"}),J("/")}catch(s){H({title:"登出失败",description:"请稍后重试",variant:"destructive"})}};return e.useEffect(()=>{B?(async()=>{try{if(V(!0),F(null),!(await T()))return F("用户未登录"),void V(!1);const s=await q();if(s){const e={id:String(s.id||s.userId||""),username:String(s.username||""),nickname:String(s.nickname||s.username||"用户"),email:String(s.email||""),phone:String(s.phone||""),photo:String(s.photo||s.avatar||""),createdAt:String(s.createdAt||(new Date).toISOString()),updatedAt:String(s.updatedAt||(new Date).toISOString()),...s};I(e),o.secureLog("用户信息加载成功",{userId:e.id,hasEmail:!!e.email,hasPhone:!!e.phone})}else F("无法获取用户信息")}catch(s){F("加载用户信息失败"),o.secureLog("用户信息加载失败",{error:s instanceof Error?s.message:"未知错误"},"error")}finally{V(!1)}})():(V(!1),F("用户未登录"))},[B]),P?s.jsx(r,{className:b,children:s.jsx(l,{className:"p-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"animate-pulse bg-gray-200 rounded-full w-16 h-16"}),s.jsxs("div",{className:"space-y-2 flex-1",children:[s.jsx("div",{className:"animate-pulse bg-gray-200 h-4 rounded w-3/4"}),s.jsx("div",{className:"animate-pulse bg-gray-200 h-3 rounded w-1/2"})]})]})})}):E||!L?s.jsx(r,{className:b,children:s.jsx(l,{className:"p-6",children:s.jsxs("div",{className:"text-center text-gray-500",children:[s.jsx(f,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),s.jsx("p",{className:"text-sm",children:E||"用户信息不可用"}),D&&s.jsx(n,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>G(),children:"去登录"})]})})}):z?s.jsx(r,{className:b,children:s.jsx(l,{className:"p-4",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs(j,{className:"w-10 h-10",children:[s.jsx(p,{src:L.photo,alt:L.nickname}),s.jsx(g,{children:L.nickname.charAt(0).toUpperCase()})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium truncate",children:L.nickname}),s.jsx("p",{className:"text-xs text-gray-500 truncate",children:L.email||L.phone||"未设置联系方式"})]}),D&&s.jsx(n,{variant:"ghost",size:"sm",onClick:K,children:s.jsx(v,{className:"w-4 h-4"})})]})})}):s.jsxs(r,{className:b,children:[s.jsxs(m,{children:[s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-5 h-5"}),"用户信息"]}),s.jsx(d,{children:"您的账户信息和设置"})]}),s.jsxs(l,{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-start space-x-4",children:[s.jsxs(j,{className:"w-20 h-20",children:[s.jsx(p,{src:L.photo,alt:L.nickname}),s.jsx(g,{className:"text-lg",children:L.nickname.charAt(0).toUpperCase()})]}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"text-xl font-semibold",children:L.nickname}),s.jsx(N,{variant:L.isProUser?"default":"secondary",children:L.isProUser?s.jsxs(s.Fragment,{children:[s.jsx(w,{className:"w-3 h-3 mr-1"}),"专业版"]}):s.jsxs(s.Fragment,{children:[s.jsx(y,{className:"w-3 h-3 mr-1"}),"体验版"]})})]}),s.jsxs("p",{className:"text-sm text-gray-600",children:["@",L.username]}),L.email&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(S,{className:"w-4 h-4"}),s.jsx("span",{children:h.maskValue(L.email,"email")})]}),L.phone&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(k,{className:"w-4 h-4"}),s.jsx("span",{children:h.maskValue(L.phone,"phone")})]})]})]}),s.jsx(u,{}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[s.jsx(A,{className:"w-4 h-4"}),"账户信息"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"用户ID:"}),s.jsx("p",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1",children:h.maskValue(L.id,"id")})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"注册时间:"}),s.jsx("p",{className:"mt-1",children:new Date(L.createdAt).toLocaleDateString()})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"最后更新:"}),s.jsx("p",{className:"mt-1",children:new Date(L.updatedAt).toLocaleDateString()})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500",children:"账户类型:"}),s.jsx("p",{className:"mt-1",children:"premium"===L.plan?"高级版":"pro"===L.plan?"专业版":"体验版"})]})]})]}),D&&s.jsxs(s.Fragment,{children:[s.jsx(u,{}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{J("/profile")},className:"flex items-center gap-1",children:[s.jsx(C,{className:"w-4 h-4"}),"编辑资料"]}),s.jsxs(n,{variant:"outline",size:"sm",onClick:()=>J("/settings"),className:"flex items-center gap-1",children:[s.jsx(U,{className:"w-4 h-4"}),"设置"]}),!L.isProUser&&s.jsxs(n,{variant:"default",size:"sm",onClick:()=>{J("/payment")},className:"flex items-center gap-1",children:[s.jsx(w,{className:"w-4 h-4"}),"升级账户"]}),s.jsxs(n,{variant:"destructive",size:"sm",onClick:K,className:"flex items-center gap-1 ml-auto",children:[s.jsx(v,{className:"w-4 h-4"}),"退出登录"]})]})]})]})]})}export{b as U};
