import{j as e}from"./ui-core-CkDiOLPZ.js";import{r as s}from"./router-CDHmMMQ-.js";import{f as a,U as t,C as i,e as r,B as l,P as c,a as d,b as n,d as x}from"./pages-home-cm4XWoxC.js";import{B as m,i as j,j as h,k as o,l as p}from"./pages-adapt-BekQTgf9.js";import{S as u}from"./components-landing-lYQV1woT.js";import"./react-vendor-D7XYiaTe.js";import"./utils-DOwhHgxs.js";import"./components-layout-Dpkc7dU5.js";import"./components-auth-Cmg7TtKX.js";import"./pages-brand-CdVj9KMe.js";import"./api-services-CFC91rmd.js";function v(){const{getCurrentUserId:v,isTempUserIdBound:g}=a(),[N,f]=s.useState([]),[y,b]=s.useState(!0),[U,C]=s.useState(null),I=v();s.useEffect(()=>{w()},[I]);const w=async()=>{b(!0),C(null);try{const e=t.getInstance();if(g){const s=await e.getRealUserData(I);f(s)}else{const s=await e.getTempUserData(I);f(s)}}catch(e){C("加载用户数据失败")}finally{b(!1)}},$=e=>new Date(e).toLocaleString("zh-CN");return y?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"加载用户数据中..."})]})})}):U?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(i,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:U}),e.jsx(l,{onClick:w,children:"重试"})]})})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(c,{title:"用户数据管理",description:"查看和管理用户数据记录",metadata:{layout:"tool",hasNavigation:!0,pageType:"user_data"}}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"用户数据管理"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["当前用户ID: ",I,g&&e.jsx(m,{className:"ml-2",children:"正式用户"}),!g&&e.jsx(m,{variant:"secondary",className:"ml-2",children:"临时用户"})]})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(n,{children:"数据概览"}),e.jsx(x,{children:"用户行为数据统计"})]}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:N.reduce((e,s)=>e+s.userActions.pageVisits.length,0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"页面访问"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.reduce((e,s)=>e+s.userActions.featureUsage.length,0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"功能使用"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:N.reduce((e,s)=>e+s.userActions.contentCreated.length,0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"内容创建"})]})]})})]}),e.jsxs(j,{defaultValue:"pageVisits",className:"space-y-4",children:[e.jsxs(h,{className:"grid w-full grid-cols-3",children:[e.jsx(o,{value:"pageVisits",children:"页面访问"}),e.jsx(o,{value:"featureUsage",children:"功能使用"}),e.jsx(o,{value:"contentCreated",children:"内容创建"})]}),e.jsx(p,{value:"pageVisits",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(n,{children:"页面访问记录"}),e.jsx(x,{children:"用户访问的页面和停留时间"})]}),e.jsx(r,{children:e.jsx(u,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-4",children:N.map(s=>s.userActions.pageVisits.map((a,t)=>{return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:a.page}),e.jsx(m,{variant:"outline",children:s.isTempUser?"临时用户":"正式用户"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["访问时间: ",$(a.timestamp)]}),a.duration&&e.jsxs("div",{children:["停留时间: ",(i=a.duration,i?`${Math.floor(i/6e4)}分${Math.floor(i%6e4/1e3)}秒`:"未知")]}),a.page&&e.jsxs("div",{children:["页面: ",a.page]})]})]},`${s.userId}-${t}`);var i}))})})})]})}),e.jsx(p,{value:"featureUsage",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(n,{children:"功能使用记录"}),e.jsx(x,{children:"用户使用的功能和时间"})]}),e.jsx(r,{children:e.jsx(u,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-4",children:N.map(s=>s.userActions.featureUsage.map((a,t)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:a.feature}),e.jsx(m,{variant:"outline",children:s.isTempUser?"临时用户":"正式用户"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["使用时间: ",$(a.timestamp)]}),a.metadata&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"元数据:"}),e.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-auto",children:JSON.stringify(a.metadata,null,2)})]})]})]},`${s.userId}-${t}`)))})})})]})}),e.jsx(p,{value:"contentCreated",className:"space-y-4",children:e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(n,{children:"内容创建记录"}),e.jsx(x,{children:"用户创建的内容"})]}),e.jsx(r,{children:e.jsx(u,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-4",children:N.map(s=>s.userActions.contentCreated.map((a,t)=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:a.title}),e.jsx(m,{variant:"outline",children:s.isTempUser?"临时用户":"正式用户"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["类型: ",a.type]}),e.jsxs("div",{children:["创建时间: ",$(a.timestamp)]}),e.jsxs("div",{children:["内容ID: ",a.contentId]})]})]},`${s.userId}-${t}`)))})})})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(l,{onClick:w,variant:"outline",children:"刷新数据"}),e.jsx(l,{onClick:()=>{t.getInstance().deleteUserData(I).then(()=>{w()})},variant:"destructive",children:"清除数据"})]})]})]})}export{v as default};
