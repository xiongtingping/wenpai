import{r as e,u as s,j as t,at as a,au as l,av as i,R as n,B as r,_ as c,q as d,p as o,P as m,g as x}from"./index-CYvVoP-H.js";import{I as h}from"./input-C7T9kmHO.js";import{A as u,a as p}from"./alert-t5HC1c9H.js";import{C as f}from"./camera-iiSLCO1_.js";import{I as v}from"./info-x65m4toA.js";import{S as g}from"./save-DT5yk6UW.js";import{C as j}from"./copy-D3g8yJt7.js";import{G as b}from"./gift-quj9eTR5.js";function N({currentAvatar:c,nickname:d="ç”¨æˆ·",size:o="md",showUploadButton:m=!0,showRandomButton:x=!0,onAvatarChange:u,disabled:p=!1}){const[v,g]=e.useState(c||""),[j,b]=e.useState(!1),[N,y]=e.useState(!1),w=e.useRef(null),{toast:k}=s(),C=()=>{switch(o){case"sm":return"sm";case"lg":return"lg";default:return"default"}};return t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsxs("div",{className:"relative",children:[t.jsxs(a,{className:(()=>{switch(o){case"sm":return"h-16 w-16";case"lg":return"h-32 w-32";default:return"h-24 w-24"}})(),children:[t.jsx(l,{src:v,alt:d}),t.jsx(i,{className:"bg-blue-500 text-white text-lg font-semibold",children:d.charAt(0).toUpperCase()})]}),(j||N)&&t.jsx("div",{className:"absolute inset-0 bg-black/20 rounded-full flex items-center justify-center",children:t.jsx(n,{className:"h-6 w-6 text-white animate-spin"})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full max-w-xs",children:[m&&t.jsxs(r,{variant:"outline",size:C(),onClick:()=>{var e;null==(e=w.current)||e.click()},disabled:p||j||N,className:"flex-1",children:[t.jsx(f,{className:"h-4 w-4 mr-2"}),j?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ å¤´åƒ"]}),x&&t.jsxs(r,{variant:"outline",size:C(),onClick:async()=>{y(!0);try{const e=d+Date.now(),s=`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(e)}`;g(s),null==u||u(s),k({title:"å¤´åƒç”ŸæˆæˆåŠŸ",description:"å·²ä¸ºæ‚¨ç”Ÿæˆæ–°çš„éšæœºå¤´åƒ"})}catch(e){k({title:"ç”Ÿæˆå¤±è´¥",description:"éšæœºå¤´åƒç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•",variant:"destructive"})}finally{y(!1)}},disabled:p||j||N,className:"flex-1",children:[t.jsx(n,{className:"h-4 w-4 mr-2"}),N?"ç”Ÿæˆä¸­...":"éšæœºå¤´åƒ"]})]}),t.jsx(h,{ref:w,type:"file",accept:"image/*",onChange:async e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)k({title:"æ–‡ä»¶è¿‡å¤§",description:"å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB",variant:"destructive"});else{b(!0);try{const e=URL.createObjectURL(t);g(e),null==u||u(e),k({title:"å¤´åƒä¸Šä¼ æˆåŠŸ",description:"æ‚¨çš„å¤´åƒå·²æ›´æ–°"})}catch(a){k({title:"ä¸Šä¼ å¤±è´¥",description:"å¤´åƒä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•",variant:"destructive"})}finally{b(!1)}}else k({title:"æ–‡ä»¶ç±»å‹é”™è¯¯",description:"è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶",variant:"destructive"})},className:"hidden"}),t.jsx("div",{className:"text-xs text-gray-500 text-center",children:t.jsx("p",{children:'æˆ–ç‚¹å‡»"éšæœºå¤´åƒ"ç”Ÿæˆä¸ªæ€§åŒ–å¤´åƒ'})})]})}function y(){const{toast:a}=s(),{user:l,isAuthenticated:i,logout:n,login:f}=c();null==l||l.id,null==l||l.email;const{usageRemaining:y,getCurrentUserId:w,getReferrer:k}=d(),C=o(),[S,I]=e.useState({nickname:(null==l?void 0:l.nickname)||"",email:(null==l?void 0:l.email)||"",phone:(null==l?void 0:l.phone)||"",avatar:(null==l?void 0:l.avatar)||""}),[z,A]=e.useState(!1),[$,R]=e.useState(!1),[O,U]=e.useState(!1),[B,D]=e.useState(null),[_,T]=e.useState(""),[E,F]=e.useState(0),[J,L]=e.useState("");if(!i||!l)return f(),null;e.useEffect(()=>{l&&I({nickname:l.nickname||"",email:l.email||"",phone:l.phone||"",avatar:l.avatar||""})},[l]),e.useEffect(()=>{!l||S.nickname===l.nickname&&S.avatar===l.avatar?R(!1):R(!0)},[S,l]);const W=async(e,s)=>{if(!(E>0))if(s)if("phone"!==e||/^1[3-9]\d{9}$/.test(s))if("email"!==e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))try{D(e),L(s),U(!0),a({title:"éªŒè¯ç å·²å‘é€",description:"éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„"+("phone"===e?"æ‰‹æœº":"é‚®ç®±")}),F(60);const t=setInterval(()=>{F(e=>e<=1?(clearInterval(t),0):e-1)},1e3)}catch(t){a({title:"å‘é€å¤±è´¥",description:"è¯·ç¨åé‡è¯•",variant:"destructive"})}else a({title:"è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±åœ°å€",variant:"destructive"});else a({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",variant:"destructive"});else a({title:"phone"===e?"è¯·è¾“å…¥æ‰‹æœºå·":"è¯·è¾“å…¥é‚®ç®±",variant:"destructive"})},q=async()=>{try{const e=`${window.location.origin}/register?ref=${w()}`;await navigator.clipboard.writeText(e),a({title:"é‚€è¯·é“¾æ¥å·²å¤åˆ¶",description:"å»å‘ç»™å¥½å‹å§ï¼"})}catch(e){a({title:"å¤åˆ¶å¤±è´¥",description:"è¯·æ‰‹åŠ¨å¤åˆ¶é‚€è¯·é“¾æ¥",variant:"destructive"})}},G=()=>S.nickname.trim().length>0&&$;return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsx(m,{title:"ä¸ªäººä¸­å¿ƒ",description:"ç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯å’Œä½¿ç”¨ç»Ÿè®¡",showAdaptButton:!1}),t.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[t.jsx("div",{className:"mb-6",children:t.jsx(r,{variant:"ghost",size:"sm",onClick:()=>C("/"),className:"hover:bg-gray-100 text-gray-600 -ml-2",children:"è¿”å›é¦–é¡µ"})}),t.jsx("div",{className:"mb-8",children:t.jsxs("div",{className:"rounded-xl shadow-sm bg-white overflow-hidden",children:[t.jsx("div",{className:"h-20 bg-gradient-to-r from-purple-500 to-pink-400 flex items-center px-6",children:t.jsx("span",{className:"text-white text-lg font-bold",children:"ä¸ªäººèµ„æ–™"})}),t.jsxs("div",{className:"p-6 flex flex-col gap-6 lg:flex-row lg:gap-8",children:[t.jsx("div",{className:"flex flex-col items-center lg:items-start gap-3 lg:w-1/3 lg:max-w-xs",children:t.jsx(N,{currentAvatar:S.avatar,nickname:S.nickname||(null==l?void 0:l.nickname)||"ç”¨æˆ·",size:"md",onAvatarChange:e=>{I(s=>({...s,avatar:e})),R(!0)},disabled:!1})}),t.jsxs("div",{className:"flex-1 flex flex-col space-y-4 min-w-0",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æ˜µç§°"}),t.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"è¯·è¾“å…¥æ˜µç§°",value:S.nickname,onChange:e=>{return s=e.target.value,I(e=>({...e,nickname:s})),void R(!0);var s}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"æ‰‹æœºå·"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("input",{className:"flex-1 border rounded px-3 py-2 text-sm min-w-0",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",value:S.phone,onChange:e=>{return s=e.target.value,I(e=>({...e,phone:s})),void R(!0);var s},disabled:O&&"phone"===B}),S.phone!==(null==l?void 0:l.phone)&&S.phone&&t.jsx(r,{variant:"outline",size:"sm",onClick:()=>W("phone",S.phone),disabled:E>0,className:"whitespace-nowrap flex-shrink-0",children:E>0?`${E}s`:"å‘é€éªŒè¯ç "})]}),S.phone&&t.jsx(x,{className:"bg-green-500 text-white text-[11px] px-2 py-0.5 rounded-full mt-1",children:"å·²éªŒè¯"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"é‚®ç®±"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[t.jsx("input",{className:"flex-1 border rounded px-3 py-2 text-sm min-w-0",placeholder:"è¯·è¾“å…¥é‚®ç®±",value:S.email,onChange:e=>{return s=e.target.value,I(e=>({...e,email:s})),void R(!0);var s},disabled:O&&"email"===B}),S.email!==(null==l?void 0:l.email)&&S.email&&t.jsx(r,{variant:"outline",size:"sm",onClick:()=>W("email",S.email),disabled:E>0,className:"whitespace-nowrap flex-shrink-0",children:E>0?`${E}s`:"å‘é€éªŒè¯ç "})]}),!(null==l?void 0:l.email)&&t.jsxs(u,{className:"mt-2 border-amber-200 bg-amber-50",children:[t.jsx(v,{className:"h-4 w-4 text-amber-600"}),t.jsx(p,{className:"text-amber-800",children:"é¦–æ¬¡éªŒè¯å¥–åŠ±ï¼šå®Œæˆé‚®ç®±éªŒè¯å¯è·10æ¬¡å…è´¹ä½¿ç”¨"})]})]}),O&&t.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200",children:[t.jsx("div",{className:"flex items-center gap-2 mb-3",children:t.jsxs("span",{className:"text-sm font-semibold text-blue-800",children:["è¯·è¾“å…¥å‘é€åˆ°","phone"===B?"æ‰‹æœº":"é‚®ç®±","çš„éªŒè¯ç "]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(h,{placeholder:"è¯·è¾“å…¥éªŒè¯ç ",value:_,onChange:e=>T(e.target.value),className:"flex-1 border-blue-300 focus:border-blue-500"}),t.jsx(r,{onClick:async()=>{if(_)try{B&&J&&(await(async(e,s)=>{try{const t={...l,[e]:s,updatedAt:(new Date).toISOString()};localStorage.setItem("authing_user",JSON.stringify(t)),R(!1),a({title:"ä¿å­˜æˆåŠŸ",description:"ä¸ªäººä¿¡æ¯å·²æ›´æ–°"})}catch(t){a({title:"ä¿å­˜å¤±è´¥",description:"è¯·é‡è¯•",variant:"destructive"})}})(B,J),"email"!==B||(null==l?void 0:l.email)||a({title:"é‚®ç®±éªŒè¯æˆåŠŸ",description:"æ­å–œæ‚¨è·å¾—10æ¬¡å…è´¹ä½¿ç”¨æ¬¡æ•°ï¼"}),U(!1),D(null),T(""),L(""))}catch(e){a({title:"éªŒè¯å¤±è´¥",description:"è¯·æ£€æŸ¥éªŒè¯ç æ˜¯å¦æ­£ç¡®",variant:"destructive"})}else a({title:"è¯·è¾“å…¥éªŒè¯ç ",variant:"destructive"})},disabled:!_,size:"sm",className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:"ç¡®è®¤"}),t.jsx(r,{variant:"outline",onClick:()=>{U(!1),D(null),T(""),L("")},size:"sm",className:"border-gray-300",children:"å–æ¶ˆ"})]})]}),t.jsx(r,{onClick:async()=>{if($){A(!0);try{const e={...l,...S,updatedAt:(new Date).toISOString()};localStorage.setItem("authing_user",JSON.stringify(e)),R(!1),a({title:"ä¿å­˜æˆåŠŸ",description:"ä¸ªäººä¿¡æ¯å·²æ›´æ–°"})}catch(e){a({title:"ä¿å­˜å¤±è´¥",description:"è¯·é‡è¯•",variant:"destructive"})}finally{A(!1)}}},disabled:!G()||z,className:"w-full mt-2 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center "+(G()?"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-md hover:shadow-lg transform hover:scale-[1.02]":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:z?t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}),"ä¿å­˜ä¸­..."]}):t.jsxs(t.Fragment,{children:[t.jsx(g,{className:"w-4 h-4 mr-2"}),"ä¿å­˜æ‰€æœ‰æ›´æ”¹"]})}),$&&t.jsx("p",{className:"text-xs text-amber-600 mt-2 text-center",children:"æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹"})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 p-0",children:[t.jsxs("div",{className:"p-6 rounded-xl shadow-sm bg-white flex flex-col gap-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-2",children:"è´¦å·ä¿¡æ¯"}),t.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"ç”¨æˆ·ID"}),t.jsx("span",{className:"font-mono text-gray-700",children:w()})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"è´¦æˆ·ç±»å‹"}),t.jsx("span",{className:"inline-flex items-center bg-gray-100 text-blue-600 px-2 py-0.5 rounded font-semibold",children:"ä½“éªŒç‰ˆ"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"å¯ç”¨æ¬¡æ•°"}),t.jsxs("span",{className:"font-bold text-lg text-green-600",children:[y," æ¬¡"]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"Tokené™åˆ¶"}),t.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded font-semibold",children:"100,000 tokens"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"æ³¨å†Œæ—¶é—´"}),t.jsx("span",{children:"2025/7/12"})]})]}),t.jsx("div",{className:"flex gap-2 mt-auto",children:t.jsx("button",{onClick:async()=>{try{await n(),C("/")}catch(e){a({title:"ç™»å‡ºå¤±è´¥",description:"è¯·é‡è¯•",variant:"destructive"})}},className:"w-full bg-red-100 text-red-600 py-2 rounded-lg font-semibold hover:bg-red-200 transition-colors",children:"é€€å‡ºç™»å½•"})})]}),t.jsxs("div",{className:"p-6 rounded-xl shadow-sm bg-white flex flex-col gap-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-2",children:"ä½¿ç”¨ç»Ÿè®¡"}),t.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"ä½¿ç”¨æ¬¡æ•°"}),t.jsx("span",{className:"font-bold text-lg text-blue-600",children:"3/10"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"inline-flex items-center",children:"Tokenä½¿ç”¨é‡"}),t.jsx("span",{className:"font-bold text-lg text-gray-600",children:"25,000 / 100,000"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2",children:[t.jsxs("div",{className:"bg-purple-100 text-purple-800 rounded-lg flex flex-col items-center justify-center py-6",children:[t.jsx("div",{className:"text-2xl font-bold mb-1",children:"45åˆ†é’Ÿ"}),t.jsx("div",{className:"text-xs",children:"å·²èŠ‚çœæ—¶é—´"})]}),t.jsxs("div",{className:"bg-green-100 text-green-800 rounded-lg flex flex-col items-center justify-center py-6",children:[t.jsx("div",{className:"text-2xl font-bold mb-1",children:"3ä»½"}),t.jsx("div",{className:"text-xs",children:"å·²ç”Ÿæˆå†…å®¹"})]})]}),t.jsx("button",{onClick:()=>{C("/payment")},className:"w-full mt-auto py-2 rounded-lg bg-gradient-to-r from-orange-400 to-red-400 text-white font-semibold shadow-md hover:opacity-90 active:opacity-80 transition-opacity inline-flex items-center justify-center",children:"ç«‹å³è§£é”é«˜çº§åŠŸèƒ½"})]})]}),t.jsxs("div",{className:"mt-10",children:[t.jsxs("div",{className:"rounded-xl bg-gradient-to-r from-orange-400 to-red-500 p-6 text-white shadow-md flex items-center space-x-4",children:[t.jsx("div",{className:"flex-shrink-0 text-3xl",children:"ğŸ"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xl font-bold",children:"é‚€è¯·å¥½å‹ï¼Œè½»æ¾å¾—å¥–åŠ±"}),t.jsx("div",{className:"text-sm opacity-80",children:"æ¯é‚€è¯· 1 äººæ³¨å†Œï¼ŒåŒæ–¹å„å¾— 20 æ¬¡æœºä¼š"})]})]}),k()&&t.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("span",{className:"text-blue-600 font-medium",children:"æ¨èäººä¿¡æ¯"}),t.jsx(x,{variant:"outline",className:"text-blue-600 border-blue-300",children:"å·²é€šè¿‡æ¨èæ³¨å†Œ"})]}),t.jsxs("div",{className:"text-sm text-blue-700",children:["æ¨èäººID: ",k()]}),t.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"æ‚¨å·²è·å¾—æ¨èå¥–åŠ±ï¼š20æ¬¡å…è´¹ä½¿ç”¨æœºä¼š"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[t.jsxs("div",{className:"bg-blue-100 text-blue-700 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xs",children:"åŒæ–¹å„å¾—"}),t.jsx("div",{className:"text-2xl font-bold",children:"20 æ¬¡"})]}),t.jsxs("div",{className:"bg-green-100 text-green-700 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xs",children:"æœ‰æ•ˆæœŸ"}),t.jsx("div",{className:"text-2xl font-bold",children:"æ°¸ä¹…"})]}),t.jsxs("div",{className:"bg-purple-100 text-purple-700 rounded-lg p-4 text-center",children:[t.jsx("div",{className:"text-xs",children:"æˆåŠŸé‚€è¯·"}),t.jsx("div",{className:"text-2xl font-bold",children:"0"})]})]}),t.jsx("div",{className:"mt-6",children:t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"é‚€è¯·é“¾æ¥"}),t.jsxs("div",{className:"flex items-center border rounded px-2 py-1 bg-white",children:[t.jsx("input",{readOnly:!0,className:"flex-1 text-sm truncate bg-transparent outline-none",value:`${window.location.origin}/register?ref=${w()}`}),t.jsxs("button",{onClick:q,className:"flex items-center text-blue-600 hover:underline text-xs ml-2",children:[t.jsx(j,{className:"w-4 h-4 mr-1"}),"å¤åˆ¶"]})]})]})}),t.jsxs("button",{onClick:q,className:"mt-6 w-full py-3 rounded-lg bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold shadow-md hover:opacity-90 active:opacity-80 transition-opacity flex items-center justify-center gap-2",children:[t.jsx(b,{className:"w-5 h-5"}),"ç«‹å³é‚€è¯·å¥½å‹"]})]})]})]})}export{y as default};
