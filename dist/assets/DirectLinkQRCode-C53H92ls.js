import{r as e,u as s,j as a,C as t,e as r,f as i,i as l,L as c,B as n,ae as m,R as d}from"./index-CYvVoP-H.js";import{Q as o}from"./browser-Cnf2s-_L.js";import{I as x}from"./input-C7T9kmHO.js";import{C as h}from"./copy-D3g8yJt7.js";import{E as p}from"./external-link-Bguz_PIV.js";function j({defaultUrl:j="https://www.creem.io/payment/prod_3nJOuQeVStqkp6JaDcrKHf",title:u="Creem支付链接二维码",showControls:w=!0}){const[f,y]=e.useState(j),[v,N]=e.useState(""),[g,b]=e.useState(!1),[C,k]=e.useState(null),{toast:F}=s(),S=async e=>{if(!e)return k("请输入有效的支付链接"),void N("");b(!0),k(null);try{if(!new URL(e).hostname.includes("creem.io"))throw new Error("请输入有效的Creem支付链接");const s=await o.toDataURL(e,{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H"});N(s)}catch(s){k(s.message||"生成二维码失败"),N("")}finally{b(!1)}};return e.useEffect(()=>{j&&S(j)},[j]),a.jsxs(t,{className:"w-full max-w-md mx-auto",children:[a.jsx(r,{children:a.jsxs(i,{className:"text-center flex items-center justify-center gap-2",children:[a.jsx("span",{children:"📱"}),u]})}),a.jsxs(l,{className:"space-y-4",children:[w&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(c,{htmlFor:"paymentUrl",children:"Creem支付链接"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(x,{id:"paymentUrl",type:"url",placeholder:"https://www.creem.io/payment/...",value:f,onChange:e=>{y(e.target.value)},className:"flex-1"}),a.jsx(n,{onClick:()=>{S(f)},disabled:g,size:"sm",children:g?a.jsx(m,{className:"h-4 w-4 animate-spin"}):a.jsx(d,{className:"h-4 w-4"})})]})]}),C&&a.jsx("div",{className:"text-red-600 text-sm text-center p-2 bg-red-50 rounded",children:C}),g?a.jsxs("div",{className:"flex items-center justify-center space-x-2 py-8",children:[a.jsx(m,{className:"h-6 w-6 animate-spin"}),a.jsx("span",{children:"正在生成二维码..."})]}):v?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx("img",{src:v,alt:"支付二维码",className:"border-2 border-gray-200 rounded-lg",style:{width:300,height:300}})}),a.jsxs("div",{className:"flex gap-2 justify-center",children:[a.jsxs(n,{onClick:async()=>{try{await navigator.clipboard.writeText(f),F({title:"链接已复制",description:"支付链接已复制到剪贴板"})}catch(e){F({title:"复制失败",description:"无法复制链接到剪贴板",variant:"destructive"})}},variant:"outline",size:"sm",children:[a.jsx(h,{className:"h-4 w-4 mr-1"}),"复制链接"]}),a.jsxs(n,{onClick:()=>{window.open(f,"_blank")},variant:"outline",size:"sm",children:[a.jsx(p,{className:"h-4 w-4 mr-1"}),"打开链接"]}),a.jsxs(n,{onClick:async()=>{if(v)try{const e=await fetch(v),s=await e.blob();await navigator.clipboard.write([new ClipboardItem({[s.type]:s})]),F({title:"二维码已复制",description:"二维码图片已复制到剪贴板"})}catch(e){F({title:"复制失败",description:"无法复制二维码到剪贴板",variant:"destructive"})}},variant:"outline",size:"sm",children:[a.jsx(h,{className:"h-4 w-4 mr-1"}),"复制二维码"]})]}),a.jsx("div",{className:"text-sm text-gray-600 space-y-2 text-center",children:a.jsx("p",{children:"扫码后会跳转到Creem安全支付页，请放心支付"})})]}):null,w&&a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[a.jsx("h4",{className:"font-medium text-sm mb-2",children:"当前链接"}),a.jsx("p",{className:"text-xs text-gray-600 break-all",children:f})]})]})]})}export{j as D};
