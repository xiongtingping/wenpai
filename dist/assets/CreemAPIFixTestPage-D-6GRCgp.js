import{r as e,j as s,C as a,e as t,f as c,g as r,i as l,m as i,l as d,aF as n,B as m,ae as x,L as o}from"./index-Dk-gCvGC.js";import{I as h}from"./input-DhHrf3ht.js";import{c as p,a as u,g as j}from"./creemClientService-CiDBQP5G.js";import"./browser-BEa-FelJ.js";function g(){const[g,N]=e.useState([]),[f,v]=e.useState(!1),[I,y]=e.useState("prod_3nJOuQeVStqkp6JaDcrKHf"),[w,b]=e.useState("test@example.com"),C=[{name:"专业版月付",priceId:"prod_3nJOuQeVStqkp6JaDcrKHf",expectedPrice:29},{name:"专业版年付",priceId:"prod_5qBlDTLpD3h9gvOZFd4Rgu",expectedPrice:299},{name:"高级版月付",priceId:"prod_4HYBfvrcbXYnbxjlswMj28",expectedPrice:59},{name:"高级版年付",priceId:"prod_6OfIoVnRg2pXsuYceVKOYk",expectedPrice:599}],P=(e,s,a,t)=>{const c={name:e,timestamp:(new Date).toISOString(),success:s,data:a,error:t||null};N(e=>[c,...e])},D=async(e,s)=>{try{const a=await p(e,w);a.success?P(`${s} - createCreemCheckout`,!0,a):P(`${s} - createCreemCheckout`,!1,a,"API调用失败")}catch(a){P(`${s} - createCreemCheckout`,!1,null,a.message)}},A=async(e,s)=>{try{const a=await u(e,w);a.success?P(`${s} - getAlipayQRCode`,!0,a):P(`${s} - getAlipayQRCode`,!1,a,"API调用失败")}catch(a){P(`${s} - getAlipayQRCode`,!1,null,a.message)}},S=async(e,s)=>{try{const a=await j(e,w);a.success?P(`${s} - generateAlipayQRCode`,!0,a):P(`${s} - generateAlipayQRCode`,!1,a,"API调用失败")}catch(a){P(`${s} - generateAlipayQRCode`,!1,null,a.message)}},k=()=>g.filter(e=>e.success).length,$=()=>g.length;return s.jsx("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:s.jsxs(a,{children:[s.jsxs(t,{children:[s.jsxs(c,{className:"flex items-center gap-2",children:["🔧 Creem API修复测试",s.jsx(r,{variant:"secondary",children:"priceId参数修复"})]}),s.jsx("p",{className:"text-muted-foreground",children:"验证Creem API的priceId参数修复是否有效，测试所有相关函数"})]}),s.jsxs(l,{className:"space-y-6",children:[g.length>0&&s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(i,{className:"h-5 w-5 text-green-600"}),s.jsxs("span",{className:"text-green-600 font-medium",children:["成功: ",k()]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(d,{className:"h-5 w-5 text-red-600"}),s.jsxs("span",{className:"text-red-600 font-medium",children:["失败: ",$()-k()]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(n,{className:"h-5 w-5 text-blue-600"}),s.jsxs("span",{className:"text-blue-600 font-medium",children:["总计: ",$()]})]})]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["成功率: ",$()>0?Math.round(k()/$()*100):0,"%"]})]})}),s.jsxs("div",{className:"flex gap-4",children:[s.jsx(m,{onClick:async()=>{v(!0),N([]);for(const e of C)await D(e.priceId,e.name),await new Promise(e=>setTimeout(e,500)),await A(e.priceId,e.name),await new Promise(e=>setTimeout(e,500)),await S(e.priceId,e.name),await new Promise(e=>setTimeout(e,1e3));v(!1)},disabled:f,className:"flex-1",children:f?s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"h-4 w-4 mr-2 animate-spin"}),"测试中..."]}):"运行所有测试"}),s.jsx(m,{onClick:()=>{N([])},variant:"outline",children:"清除结果"})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:"自定义价格ID测试"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(o,{htmlFor:"customPriceId",children:"价格ID"}),s.jsx(h,{id:"customPriceId",value:I,onChange:e=>y(e.target.value),placeholder:"输入Creem价格ID",className:"mt-1"})]}),s.jsxs("div",{children:[s.jsx(o,{htmlFor:"customerEmail",children:"客户邮箱"}),s.jsx(h,{id:"customerEmail",type:"email",value:w,onChange:e=>b(e.target.value),placeholder:"customer@example.com",className:"mt-1"})]})]}),s.jsx(m,{onClick:async()=>{if(I.trim()){v(!0);try{const e=await p(I,w);e.success?P("自定义价格ID测试",!0,e):P("自定义价格ID测试",!1,e,"API调用失败")}catch(e){P("自定义价格ID测试",!1,null,e.message)}finally{v(!1)}}else P("自定义价格ID测试",!1,null,"请输入有效的价格ID")},disabled:f,className:"mt-3",children:"测试自定义价格ID"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:"测试配置"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(e=>s.jsx(a,{className:"p-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.priceId}),s.jsxs("p",{className:"text-xs text-gray-500",children:["预期价格: ¥",e.expectedPrice]})]}),s.jsx("div",{className:"text-right",children:s.jsx("p",{className:"text-xs text-muted-foreground",children:"将测试3个函数"})})]})},e.priceId))})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:"测试结果"}),0===g.length?s.jsx("p",{className:"text-muted-foreground",children:"暂无测试结果"}):s.jsx("div",{className:"space-y-3",children:g.map((e,t)=>s.jsx(a,{className:"p-4 "+(e.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:s.jsx("div",{className:"flex justify-between items-start",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("h4",{className:"font-medium",children:e.name}),s.jsx(r,{variant:e.success?"default":"destructive",children:e.success?"成功":"失败"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString()})]}),e.error&&s.jsx("p",{className:"text-red-600 text-sm",children:e.error}),e.success&&e.data&&s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"text-green-600",children:"API调用成功"}),s.jsxs("details",{className:"mt-2",children:[s.jsx("summary",{className:"cursor-pointer text-muted-foreground",children:"查看响应数据"}),s.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(e.data,null,2)})]})]})]})})},t))})]})]})]})})}export{g as default};
