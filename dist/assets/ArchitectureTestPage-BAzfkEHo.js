import{r as e,u as s,bj as t,j as a,C as i,e as r,f as n,g as c,i as l,h as d,B as x,aD as o}from"./index-CYvVoP-H.js";import{S as h}from"./separator-DS2DK2Rh.js";function m(){const[m,j]=e.useState([]),[u,g]=e.useState(!1),[p,y]=e.useState(null),{toast:f}=s();e.useEffect(()=>{w()},[]);const w=async()=>{try{const e=await t.getCurrentUser();y(e)}catch(e){}},N=(e,s,t,a)=>{j(i=>[...i,{name:e,status:s,message:t,data:a}])},b=(e,s,t,a)=>{j(i=>i.map(i=>i.name===e?{...i,status:s,message:t,data:a}:i))},v=async()=>{N("Authing身份认证","pending","正在测试Authing身份认证功能...");try{const e=await t.getCurrentUser();e?b("Authing身份认证","success","用户身份认证成功",e):b("Authing身份认证","error","用户未登录，请先登录")}catch(e){b("Authing身份认证","error",`身份认证失败: ${e instanceof Error?e.message:"未知错误"}`)}},S=async()=>{if(p){N("后端业务逻辑","pending","正在测试后端业务逻辑功能...");try{const e=await t.getUserProfile(p.id);b("后端业务逻辑","success","后端业务逻辑测试成功",e)}catch(e){b("后端业务逻辑","error",`后端业务逻辑测试失败: ${e instanceof Error?e.message:"未知错误"}`)}}else N("后端业务逻辑","error","请先登录后再测试后端功能")};return a.jsx("div",{className:"container mx-auto px-6 py-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"架构分离测试页面"}),a.jsx("p",{className:"text-lg text-gray-600",children:"验证Authing身份认证和自建后端业务逻辑的分离架构"})]}),a.jsxs(i,{className:"mb-6",children:[a.jsx(r,{children:a.jsxs(n,{className:"flex items-center gap-2",children:[a.jsx(c,{variant:p?"default":"secondary",children:p?"已登录":"未登录"}),"当前用户状态"]})}),a.jsx(l,{children:p?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"用户ID:"})," ",p.id]}),a.jsxs("p",{children:[a.jsx("strong",{children:"用户名:"})," ",p.username]}),a.jsxs("p",{children:[a.jsx("strong",{children:"邮箱:"})," ",p.email]}),a.jsxs("p",{children:[a.jsx("strong",{children:"手机号:"})," ",p.phone]})]}):a.jsx("p",{className:"text-gray-500",children:"请先登录以测试完整功能"})})]}),a.jsxs(i,{className:"mb-6",children:[a.jsxs(r,{children:[a.jsx(n,{children:"测试控制"}),a.jsx(d,{children:"运行各种测试来验证架构分离的正确性"})]}),a.jsx(l,{children:a.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.jsx(x,{onClick:async()=>{g(!0),j([]),o.secureLog("开始架构测试",{timestamp:(new Date).toISOString()}),await v(),await new Promise(e=>setTimeout(e,1e3)),await S(),await new Promise(e=>setTimeout(e,1e3)),await(async()=>{if(p){N("邀请系统","pending","正在测试邀请系统功能...");try{const e=await t.generateInviteLink(p.id);b("邀请系统","success","邀请系统测试成功",{inviteLink:e})}catch(e){b("邀请系统","error",`邀请系统测试失败: ${e instanceof Error?e.message:"未知错误"}`)}}else N("邀请系统","error","请先登录后再测试邀请功能")})(),await new Promise(e=>setTimeout(e,1e3)),await(async()=>{if(p){N("使用次数管理","pending","正在测试使用次数管理功能...");try{const e=await t.getUserUsage(p.id);b("使用次数管理","success","使用次数管理测试成功",e)}catch(e){b("使用次数管理","error",`使用次数管理测试失败: ${e instanceof Error?e.message:"未知错误"}`)}}else N("使用次数管理","error","请先登录后再测试使用次数功能")})(),await new Promise(e=>setTimeout(e,1e3)),await(async()=>{if(p){N("余额管理","pending","正在测试余额管理功能...");try{const e=await t.getUserBalance(p.id);b("余额管理","success","余额管理测试成功",e)}catch(e){b("余额管理","error",`余额管理测试失败: ${e instanceof Error?e.message:"未知错误"}`)}}else N("余额管理","error","请先登录后再测试余额功能")})(),await new Promise(e=>setTimeout(e,1e3)),await(async()=>{if(p){N("用户行为记录","pending","正在测试用户行为记录功能...");try{await t.recordUserAction(p.id,"test_action",{page:"ArchitectureTestPage",action:"test",timestamp:(new Date).toISOString()}),b("用户行为记录","success","用户行为记录测试成功")}catch(e){b("用户行为记录","error",`用户行为记录测试失败: ${e instanceof Error?e.message:"未知错误"}`)}}else N("用户行为记录","error","请先登录后再测试行为记录功能")})(),o.secureLog("架构测试完成",{timestamp:(new Date).toISOString(),results:m}),g(!1);const e=m.filter(e=>"success"===e.status).length,s=m.length;f({title:"测试完成",description:`成功: ${e}/${s}`})},disabled:u,className:"bg-blue-600 hover:bg-blue-700",children:u?"测试中...":"运行所有测试"}),a.jsx(x,{onClick:v,disabled:u,variant:"outline",children:"测试Authing功能"}),a.jsx(x,{onClick:S,disabled:u,variant:"outline",children:"测试后端功能"}),a.jsx(x,{onClick:()=>{j([])},disabled:u,variant:"outline",children:"清除结果"})]})})]}),a.jsxs(i,{children:[a.jsxs(r,{children:[a.jsx(n,{children:"测试结果"}),a.jsx(d,{children:"显示各项功能的测试结果和详细信息"})]}),a.jsx(l,{children:0===m.length?a.jsx("p",{className:"text-gray-500 text-center py-8",children:"暂无测试结果，请运行测试"}):a.jsx("div",{className:"space-y-4",children:m.map((e,s)=>a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h3",{className:"font-semibold",children:e.name}),a.jsx(c,{variant:"success"===e.status?"default":"error"===e.status?"destructive":"secondary",children:"success"===e.status?"成功":"error"===e.status?"失败":"进行中"})]}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),e.data&&a.jsxs("div",{className:"mt-2",children:[a.jsx(h,{className:"my-2"}),a.jsxs("details",{className:"text-sm",children:[a.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:"查看详细数据"}),a.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(e.data,null,2)})]})]})]},s))})})]}),a.jsxs(i,{className:"mt-6",children:[a.jsx(r,{children:a.jsx(n,{children:"架构说明"})}),a.jsx(l,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-600",children:"Authing处理的功能"}),a.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 mt-2",children:[a.jsx("li",{children:"用户身份认证（登录/注册）"}),a.jsx("li",{children:"用户基本信息管理"}),a.jsx("li",{children:"Token生成和验证"}),a.jsx("li",{children:"会话管理"}),a.jsx("li",{children:"基础角色管理"})]})]}),a.jsx(h,{}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-green-600",children:"自建后端处理的功能"}),a.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-600 mt-2",children:[a.jsx("li",{children:"用户业务数据管理"}),a.jsx("li",{children:"邀请系统（链接生成、关系绑定、奖励发放）"}),a.jsx("li",{children:"使用次数管理（发放、消费、查询）"}),a.jsx("li",{children:"余额/积分管理"}),a.jsx("li",{children:"订阅/套餐管理"}),a.jsx("li",{children:"支付处理"}),a.jsx("li",{children:"用户行为记录"})]})]})]})})]})]})})}export{m as default};
