import{q as e,r as s,az as a,j as i,C as l,i as t,B as c,aA as r,g as d,e as n,f as x,h as m,T as h,a as j,b as o,d as u,aB as p}from"./index-BuR5xlXm.js";function v(){const{getCurrentUserId:v,isTempUserIdBound:N}=e(),[g,f]=s.useState([]),[y,b]=s.useState(!0),[U,C]=s.useState(null),I=v();s.useEffect(()=>{w()},[I]);const w=async()=>{b(!0),C(null);try{const e=a.getInstance();if(N){const s=await e.getRealUserData(I);f(s)}else{const s=await e.getTempUserData(I);f(s)}}catch(e){C("加载用户数据失败")}finally{b(!1)}},$=e=>new Date(e).toLocaleString("zh-CN");return y?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"加载用户数据中..."})]})})}):U?i.jsx("div",{className:"container mx-auto px-4 py-8",children:i.jsx(l,{children:i.jsx(t,{className:"pt-6",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-red-600 mb-4",children:U}),i.jsx(c,{onClick:w,children:"重试"})]})})})}):i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsx(r,{title:"用户数据管理",description:"查看和管理用户数据记录",metadata:{layout:"tool",hasNavigation:!0,pageType:"user_data"}}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"用户数据管理"}),i.jsxs("p",{className:"text-gray-600 mt-2",children:["当前用户ID: ",I,N&&i.jsx(d,{className:"ml-2",children:"正式用户"}),!N&&i.jsx(d,{variant:"secondary",className:"ml-2",children:"临时用户"})]})]}),i.jsxs(l,{children:[i.jsxs(n,{children:[i.jsx(x,{children:"数据概览"}),i.jsx(m,{children:"用户行为数据统计"})]}),i.jsx(t,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.reduce((e,s)=>e+s.userActions.pageVisits.length,0)}),i.jsx("div",{className:"text-sm text-gray-600",children:"页面访问"})]}),i.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.reduce((e,s)=>e+s.userActions.featureUsage.length,0)}),i.jsx("div",{className:"text-sm text-gray-600",children:"功能使用"})]}),i.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.reduce((e,s)=>e+s.userActions.contentCreated.length,0)}),i.jsx("div",{className:"text-sm text-gray-600",children:"内容创建"})]})]})})]}),i.jsxs(h,{defaultValue:"pageVisits",className:"space-y-4",children:[i.jsxs(j,{className:"grid w-full grid-cols-3",children:[i.jsx(o,{value:"pageVisits",children:"页面访问"}),i.jsx(o,{value:"featureUsage",children:"功能使用"}),i.jsx(o,{value:"contentCreated",children:"内容创建"})]}),i.jsx(u,{value:"pageVisits",className:"space-y-4",children:i.jsxs(l,{children:[i.jsxs(n,{children:[i.jsx(x,{children:"页面访问记录"}),i.jsx(m,{children:"用户访问的页面和停留时间"})]}),i.jsx(t,{children:i.jsx(p,{className:"h-[400px]",children:i.jsx("div",{className:"space-y-4",children:g.map(e=>e.userActions.pageVisits.map((s,a)=>{return i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"font-medium",children:s.page}),i.jsx(d,{variant:"outline",children:e.isTempUser?"临时用户":"正式用户"})]}),i.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[i.jsxs("div",{children:["访问时间: ",$(s.timestamp)]}),s.duration&&i.jsxs("div",{children:["停留时间: ",(l=s.duration,l?`${Math.floor(l/6e4)}分${Math.floor(l%6e4/1e3)}秒`:"未知")]}),s.page&&i.jsxs("div",{children:["页面: ",s.page]})]})]},`${e.userId}-${a}`);var l}))})})})]})}),i.jsx(u,{value:"featureUsage",className:"space-y-4",children:i.jsxs(l,{children:[i.jsxs(n,{children:[i.jsx(x,{children:"功能使用记录"}),i.jsx(m,{children:"用户使用的功能和时间"})]}),i.jsx(t,{children:i.jsx(p,{className:"h-[400px]",children:i.jsx("div",{className:"space-y-4",children:g.map(e=>e.userActions.featureUsage.map((s,a)=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"font-medium",children:s.feature}),i.jsx(d,{variant:"outline",children:e.isTempUser?"临时用户":"正式用户"})]}),i.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[i.jsxs("div",{children:["使用时间: ",$(s.timestamp)]}),s.metadata&&i.jsxs("div",{className:"mt-2",children:[i.jsx("div",{className:"font-medium mb-1",children:"元数据:"}),i.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-auto",children:JSON.stringify(s.metadata,null,2)})]})]})]},`${e.userId}-${a}`)))})})})]})}),i.jsx(u,{value:"contentCreated",className:"space-y-4",children:i.jsxs(l,{children:[i.jsxs(n,{children:[i.jsx(x,{children:"内容创建记录"}),i.jsx(m,{children:"用户创建的内容"})]}),i.jsx(t,{children:i.jsx(p,{className:"h-[400px]",children:i.jsx("div",{className:"space-y-4",children:g.map(e=>e.userActions.contentCreated.map((s,a)=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:"font-medium",children:s.title}),i.jsx(d,{variant:"outline",children:e.isTempUser?"临时用户":"正式用户"})]}),i.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[i.jsxs("div",{children:["类型: ",s.type]}),i.jsxs("div",{children:["创建时间: ",$(s.timestamp)]}),i.jsxs("div",{children:["内容ID: ",s.contentId]})]})]},`${e.userId}-${a}`)))})})})]})})]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx(c,{onClick:w,variant:"outline",children:"刷新数据"}),i.jsx(c,{onClick:()=>{a.getInstance().deleteUserData(I).then(()=>{w()})},variant:"destructive",children:"清除数据"})]})]})]})}export{v as default};
