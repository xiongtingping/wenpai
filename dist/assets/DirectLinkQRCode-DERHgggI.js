import{j as e}from"./ui-core-BoM6Gtru.js";import{r as s}from"./router-CDHmMMQ-.js";import{Q as a}from"./browser-C5-Pn058.js";import{u as t,C as r,a as i,b as l,e as c,B as n}from"./pages-home-B-YLcn0z.js";import{L as m,I as o}from"./pages-adapt-CSkmXLuc.js";import{ad as d,n as x,x as h,E as p}from"./utils-Ck01-_Du.js";function j({defaultUrl:j="https://www.creem.io/payment/prod_3nJOuQeVStqkp6JaDcrKHf",title:u="Creem支付链接二维码",showControls:w=!0}){const[f,y]=s.useState(j),[g,v]=s.useState(""),[N,b]=s.useState(!1),[C,k]=s.useState(null),{toast:F}=t(),S=async e=>{if(!e)return k("请输入有效的支付链接"),void v("");b(!0),k(null);try{if(!new URL(e).hostname.includes("creem.io"))throw new Error("请输入有效的Creem支付链接");const s=await a.toDataURL(e,{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H"});v(s)}catch(s){k(s.message||"生成二维码失败"),v("")}finally{b(!1)}};return s.useEffect(()=>{j&&S(j)},[j]),e.jsxs(r,{className:"w-full max-w-md mx-auto",children:[e.jsx(i,{children:e.jsxs(l,{className:"text-center flex items-center justify-center gap-2",children:[e.jsx("span",{children:"📱"}),u]})}),e.jsxs(c,{className:"space-y-4",children:[w&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"paymentUrl",children:"Creem支付链接"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"paymentUrl",type:"url",placeholder:"https://www.creem.io/payment/...",value:f,onChange:e=>{y(e.target.value)},className:"flex-1"}),e.jsx(n,{onClick:()=>{S(f)},disabled:N,size:"sm",children:N?e.jsx(d,{className:"h-4 w-4 animate-spin"}):e.jsx(x,{className:"h-4 w-4"})})]})]}),C&&e.jsx("div",{className:"text-red-600 text-sm text-center p-2 bg-red-50 rounded",children:C}),N?e.jsxs("div",{className:"flex items-center justify-center space-x-2 py-8",children:[e.jsx(d,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"正在生成二维码..."})]}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:g,alt:"支付二维码",className:"border-2 border-gray-200 rounded-lg",style:{width:300,height:300}})}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(n,{onClick:async()=>{try{await navigator.clipboard.writeText(f),F({title:"链接已复制",description:"支付链接已复制到剪贴板"})}catch(e){F({title:"复制失败",description:"无法复制链接到剪贴板",variant:"destructive"})}},variant:"outline",size:"sm",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"复制链接"]}),e.jsxs(n,{onClick:()=>{window.open(f,"_blank")},variant:"outline",size:"sm",children:[e.jsx(p,{className:"h-4 w-4 mr-1"}),"打开链接"]}),e.jsxs(n,{onClick:async()=>{if(g)try{const e=await fetch(g),s=await e.blob();await navigator.clipboard.write([new ClipboardItem({[s.type]:s})]),F({title:"二维码已复制",description:"二维码图片已复制到剪贴板"})}catch(e){F({title:"复制失败",description:"无法复制二维码到剪贴板",variant:"destructive"})}},variant:"outline",size:"sm",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"复制二维码"]})]}),e.jsx("div",{className:"text-sm text-gray-600 space-y-2 text-center",children:e.jsx("p",{children:"扫码后会跳转到Creem安全支付页，请放心支付"})})]}):null,w&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"当前链接"}),e.jsx("p",{className:"text-xs text-gray-600 break-all",children:f})]})]})]})}export{j as D};
