import{j as e}from"./ui-core-CkDiOLPZ.js";import{r as s,u as t}from"./router-CDHmMMQ-.js";import{u as a,B as l,g as i,f as n}from"./pages-home-cm4XWoxC.js";import{I as r,B as c}from"./pages-adapt-BekQTgf9.js";import{A as d,a as o}from"./pages-brand-CdVj9KMe.js";import{A as x,a as m,b as h}from"./components-auth-Cmg7TtKX.js";import{n as u,aP as p,m as f,s as g,x as v}from"./utils-DOwhHgxs.js";import{P as j}from"./components-layout-Dpkc7dU5.js";import"./react-vendor-D7XYiaTe.js";import"./components-landing-lYQV1woT.js";import"./api-services-CFC91rmd.js";function b({currentAvatar:t,nickname:i="用户",size:n="md",showUploadButton:c=!0,showRandomButton:d=!0,onAvatarChange:o,disabled:f=!1}){const[g,v]=s.useState(t||""),[j,b]=s.useState(!1),[N,y]=s.useState(!1),w=s.useRef(null),{toast:k}=a(),C=()=>{switch(n){case"sm":return"sm";case"lg":return"lg";default:return"default"}};return e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(x,{className:(()=>{switch(n){case"sm":return"h-16 w-16";case"lg":return"h-32 w-32";default:return"h-24 w-24"}})(),children:[e.jsx(m,{src:g,alt:i}),e.jsx(h,{className:"bg-blue-500 text-white text-lg font-semibold",children:i.charAt(0).toUpperCase()})]}),(j||N)&&e.jsx("div",{className:"absolute inset-0 bg-black/20 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"h-6 w-6 text-white animate-spin"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full max-w-xs",children:[c&&e.jsxs(l,{variant:"outline",size:C(),onClick:()=>{var e;null==(e=w.current)||e.click()},disabled:f||j||N,className:"flex-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),j?"上传中...":"上传头像"]}),d&&e.jsxs(l,{variant:"outline",size:C(),onClick:async()=>{y(!0);try{const e=i+Date.now(),s=`https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(e)}`;v(s),null==o||o(s),k({title:"头像生成成功",description:"已为您生成新的随机头像"})}catch(e){k({title:"生成失败",description:"随机头像生成失败，请重试",variant:"destructive"})}finally{y(!1)}},disabled:f||j||N,className:"flex-1",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),N?"生成中...":"随机头像"]})]}),e.jsx(r,{ref:w,type:"file",accept:"image/*",onChange:async e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t)if(t.type.startsWith("image/"))if(t.size>5242880)k({title:"文件过大",description:"图片大小不能超过 5MB",variant:"destructive"});else{b(!0);try{const e=URL.createObjectURL(t);v(e),null==o||o(e),k({title:"头像上传成功",description:"您的头像已更新"})}catch(a){k({title:"上传失败",description:"头像上传失败，请重试",variant:"destructive"})}finally{b(!1)}}else k({title:"文件类型错误",description:"请选择图片文件",variant:"destructive"})},className:"hidden"}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[e.jsx("p",{children:"支持 JPG、PNG 格式，最大 5MB"}),e.jsx("p",{children:'或点击"随机头像"生成个性化头像'})]})]})}function N(){const{toast:x}=a(),{user:m,isAuthenticated:h,logout:u,userId:p,isTempUser:N}=i(),{usageRemaining:y,getCurrentUserId:w,getReferrer:k}=n(),C=t(),[S,I]=s.useState({nickname:(null==m?void 0:m.nickname)||"",email:(null==m?void 0:m.email)||"",phone:(null==m?void 0:m.phone)||"",avatar:(null==m?void 0:m.avatar)||""}),[A,z]=s.useState(!1),[B,O]=s.useState(!1),[R,U]=s.useState(!1),[P,$]=s.useState(null),[D,G]=s.useState(""),[J,T]=s.useState(0),[E,F]=s.useState("");if(!h||!m)return C("/login"),null;s.useEffect(()=>{m&&I({nickname:m.nickname||"",email:m.email||"",phone:m.phone||"",avatar:m.avatar||""})},[m]),s.useEffect(()=>{!m||S.nickname===m.nickname&&S.avatar===m.avatar?O(!1):O(!0)},[S,m]);const L=async(e,s)=>{if(!(J>0))if(s)if("phone"!==e||/^1[3-9]\d{9}$/.test(s))if("email"!==e||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))try{$(e),F(s),U(!0),x({title:"验证码已发送",description:"验证码已发送到您的"+("phone"===e?"手机":"邮箱")}),T(60);const t=setInterval(()=>{T(e=>e<=1?(clearInterval(t),0):e-1)},1e3)}catch(t){x({title:"发送失败",description:"请稍后重试",variant:"destructive"})}else x({title:"请输入正确的邮箱地址",variant:"destructive"});else x({title:"请输入正确的手机号",variant:"destructive"});else x({title:"phone"===e?"请输入手机号":"请输入邮箱",variant:"destructive"})},M=()=>S.nickname.trim().length>0&&B;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(j,{title:"个人中心",description:"管理您的账户信息和使用统计",showAdaptButton:!1}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 pt-8 pb-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>C("/"),className:"hover:bg-gray-100 text-gray-600 -ml-2",children:"返回首页"})}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"rounded-xl shadow-sm bg-white overflow-hidden",children:[e.jsx("div",{className:"h-20 bg-gradient-to-r from-purple-500 to-pink-400 flex items-center px-6",children:e.jsx("span",{className:"text-white text-lg font-bold",children:"个人资料"})}),e.jsxs("div",{className:"p-6 flex flex-col gap-6 lg:flex-row lg:gap-8",children:[e.jsxs("div",{className:"flex flex-col items-center lg:items-start gap-3 lg:w-1/3 lg:max-w-xs",children:[e.jsx(b,{currentAvatar:S.avatar,nickname:S.nickname||(null==m?void 0:m.nickname)||"用户",size:"lg",onAvatarChange:e=>{I(s=>({...s,avatar:e})),O(!0)},disabled:!1}),e.jsx("p",{className:"text-sm text-gray-500 text-center lg:text-left max-w-full",children:"点击上传头像，支持 JPG、PNG 格式"})]}),e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 min-w-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"昵称"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 text-sm",placeholder:"请输入昵称",value:S.nickname,onChange:e=>{return s=e.target.value,I(e=>({...e,nickname:s})),void O(!0);var s}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"手机号"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{className:"flex-1 border rounded px-3 py-2 text-sm min-w-0",placeholder:"请输入手机号",value:S.phone,onChange:e=>{return s=e.target.value,I(e=>({...e,phone:s})),void O(!0);var s},disabled:R&&"phone"===P}),S.phone!==(null==m?void 0:m.phone)&&S.phone&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>L("phone",S.phone),disabled:J>0,className:"whitespace-nowrap flex-shrink-0",children:J>0?`${J}s`:"发送验证码"})]}),S.phone&&e.jsx(c,{className:"bg-green-500 text-white text-[11px] px-2 py-0.5 rounded-full mt-1",children:"已验证"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"邮箱"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{className:"flex-1 border rounded px-3 py-2 text-sm min-w-0",placeholder:"请输入邮箱",value:S.email,onChange:e=>{return s=e.target.value,I(e=>({...e,email:s})),void O(!0);var s},disabled:R&&"email"===P}),S.email!==(null==m?void 0:m.email)&&S.email&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>L("email",S.email),disabled:J>0,className:"whitespace-nowrap flex-shrink-0",children:J>0?`${J}s`:"发送验证码"})]}),!(null==m?void 0:m.email)&&e.jsxs(d,{className:"mt-2 border-amber-200 bg-amber-50",children:[e.jsx(f,{className:"h-4 w-4 text-amber-600"}),e.jsx(o,{className:"text-amber-800",children:"首次验证奖励：完成邮箱验证可获10次免费使用"})]})]}),R&&e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("span",{className:"text-sm font-semibold text-blue-800",children:["请输入发送到","phone"===P?"手机":"邮箱","的验证码"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{placeholder:"请输入验证码",value:D,onChange:e=>G(e.target.value),className:"flex-1 border-blue-300 focus:border-blue-500"}),e.jsx(l,{onClick:async()=>{if(D)try{P&&E&&(await(async(e,s)=>{try{const t={...m,[e]:s,updatedAt:(new Date).toISOString()};localStorage.setItem("authing_user",JSON.stringify(t)),O(!1),x({title:"保存成功",description:"个人信息已更新"})}catch(t){x({title:"保存失败",description:"请重试",variant:"destructive"})}})(P,E),"email"!==P||(null==m?void 0:m.email)||x({title:"邮箱验证成功",description:"恭喜您获得10次免费使用次数！"}),U(!1),$(null),G(""),F(""))}catch(e){x({title:"验证失败",description:"请检查验证码是否正确",variant:"destructive"})}else x({title:"请输入验证码",variant:"destructive"})},disabled:!D,size:"sm",className:"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600",children:"确认"}),e.jsx(l,{variant:"outline",onClick:()=>{U(!1),$(null),G(""),F("")},size:"sm",className:"border-gray-300",children:"取消"})]})]}),e.jsx(l,{onClick:async()=>{if(B){z(!0);try{const e={...m,...S,updatedAt:(new Date).toISOString()};localStorage.setItem("authing_user",JSON.stringify(e)),O(!1),x({title:"保存成功",description:"个人信息已更新"})}catch(e){x({title:"保存失败",description:"请重试",variant:"destructive"})}finally{z(!1)}}},disabled:!M()||A,className:"w-full mt-2 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center "+(M()?"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-md hover:shadow-lg transform hover:scale-[1.02]":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:A?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}),"保存中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"保存所有更改"]})}),B&&e.jsx("p",{className:"text-xs text-amber-600 mt-2 text-center",children:"您有未保存的更改"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 p-0",children:[e.jsxs("div",{className:"p-6 rounded-xl shadow-sm bg-white flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"账号信息"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"用户ID"}),e.jsx("span",{className:"font-mono text-gray-700",children:w()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"账户类型"}),e.jsx("span",{className:"inline-flex items-center bg-gray-100 text-blue-600 px-2 py-0.5 rounded font-semibold",children:"体验版"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"可用次数"}),e.jsxs("span",{className:"font-bold text-lg text-green-600",children:[y," 次"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"Token限制"}),e.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded font-semibold",children:"100,000 tokens"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"注册时间"}),e.jsx("span",{children:"2025/7/12"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>{C("/user-data")},className:"flex-1 bg-blue-100 text-blue-600 py-2 rounded-lg font-semibold hover:bg-blue-200 transition-colors",children:"数据管理"}),e.jsx("button",{onClick:async()=>{try{await u(),C("/")}catch(e){x({title:"登出失败",description:"请重试",variant:"destructive"})}},className:"flex-1 bg-red-100 text-red-600 py-2 rounded-lg font-semibold hover:bg-red-200 transition-colors",children:"退出登录"})]})]}),e.jsxs("div",{className:"p-6 rounded-xl shadow-sm bg-white flex flex-col gap-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"使用统计"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"使用次数"}),e.jsx("span",{className:"font-bold text-lg text-blue-600",children:"3/10"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"inline-flex items-center",children:"Token使用量"}),e.jsx("span",{className:"font-bold text-lg text-gray-600",children:"25,000 / 100,000"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2",children:[e.jsxs("div",{className:"bg-purple-100 text-purple-800 rounded-lg flex flex-col items-center justify-center py-6",children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:"45分钟"}),e.jsx("div",{className:"text-xs",children:"已节省时间"})]}),e.jsxs("div",{className:"bg-green-100 text-green-800 rounded-lg flex flex-col items-center justify-center py-6",children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:"3份"}),e.jsx("div",{className:"text-xs",children:"已生成内容"})]})]}),e.jsx("button",{onClick:()=>{C("/payment")},className:"w-full mt-4 py-2 rounded-lg bg-gradient-to-r from-orange-400 to-red-400 text-white font-semibold shadow-md hover:opacity-90 active:opacity-80 transition-opacity inline-flex items-center justify-center",children:"立即解锁高级功能"})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsxs("div",{className:"rounded-xl bg-gradient-to-r from-orange-400 to-red-500 p-6 text-white shadow-md flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 text-3xl",children:"🎁"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-bold",children:"邀请好友，轻松得奖励"}),e.jsx("div",{className:"text-sm opacity-80",children:"每邀请 1 人注册，双方各得 20 次机会"})]})]}),k()&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-blue-600 font-medium",children:"推荐人信息"}),e.jsx(c,{variant:"outline",className:"text-blue-600 border-blue-300",children:"已通过推荐注册"})]}),e.jsxs("div",{className:"text-sm text-blue-700",children:["推荐人ID: ",k()]}),e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"您已获得推荐奖励：20次免费使用机会"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-blue-100 text-blue-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-xs",children:"双方各得"}),e.jsx("div",{className:"text-2xl font-bold",children:"20 次"})]}),e.jsxs("div",{className:"bg-green-100 text-green-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-xs",children:"有效期"}),e.jsx("div",{className:"text-2xl font-bold",children:"永久"})]}),e.jsxs("div",{className:"bg-purple-100 text-purple-700 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-xs",children:"成功邀请"}),e.jsx("div",{className:"text-2xl font-bold",children:"0"})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"推荐码"}),e.jsxs("div",{className:"flex items-center border rounded px-2 py-1 bg-white",children:[e.jsx("input",{readOnly:!0,className:"flex-1 text-sm truncate bg-transparent outline-none",value:w()}),e.jsxs("button",{className:"flex items-center text-blue-600 hover:underline text-xs ml-2",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"复制"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1 block",children:"邀请链接"}),e.jsxs("div",{className:"flex items-center border rounded px-2 py-1 bg-white",children:[e.jsx("input",{readOnly:!0,className:"flex-1 text-sm truncate bg-transparent outline-none",value:`https://xxx.netlify.app?ref=${w()}`}),e.jsxs("button",{className:"flex items-center text-blue-600 hover:underline text-xs ml-2",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"复制"]})]})]})]}),e.jsx("button",{onClick:()=>{C("/invite")},className:"mt-6 w-full py-3 rounded-lg bg-gradient-to-r from-orange-500 to-red-500 text-white font-semibold shadow-md hover:opacity-90 active:opacity-80 transition-opacity",children:"立即邀请好友"})]})]})]})}export{N as default};
