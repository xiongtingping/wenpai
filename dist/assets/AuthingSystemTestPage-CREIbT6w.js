import{j as s}from"./ui-core-BEqq4eN-.js";import{r as e}from"./router-CDHmMMQ-.js";import{u as a,g as t,p as r,C as i,a as n,b as c,e as l,B as d,d as m,k as o,E as u,s as h}from"./pages-home-BoZVsFKO.js";import{B as g}from"./pages-adapt-CiCh1UVu.js";import{U as x,f as p,n as j,aT as f,aS as N,Q as y,W as v,o as w,ap as b,p as I,C as A}from"./utils-U1evx29U.js";import"./react-vendor-D7XYiaTe.js";import"./components-landing-sEIB86A8.js";import"./components-layout-LKVIGOSA.js";import"./components-auth-valB4v-J.js";import"./pages-brand-CflPsgWd.js";import"./api-services-Ciw7WX26.js";import"./pages-content-extractor-DtDkVS7Z.js";function E(){const{toast:E}=a(),{user:T,isAuthenticated:_,status:k,login:U,logout:G}=t(),{user:S,isLoggedIn:C,loading:D,guard:H,checkLoginStatus:R,getCurrentUser:O,logout:L,showLogin:V}=r(),[$,z]=e.useState([]),[P,J]=e.useState(!1),[q,B]=e.useState(!1),M=e=>{switch(e){case"success":return s.jsx(A,{className:"w-4 h-4 text-green-500"});case"error":return s.jsx(I,{className:"w-4 h-4 text-red-500"});case"warning":return s.jsx(b,{className:"w-4 h-4 text-yellow-500"});default:return s.jsx(b,{className:"w-4 h-4 text-gray-500"})}},Q=s=>{switch(s){case"success":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return s.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Authing 登录系统测试"}),s.jsx("p",{className:"text-gray-600",children:"全面测试 Authing 登录系统的配置、连接、认证和安全功能"})]}),s.jsxs(i,{className:"mb-6",children:[s.jsx(n,{children:s.jsxs(c,{className:"flex items-center gap-2",children:[s.jsx(x,{className:"w-5 h-5"}),"当前状态概览"]})}),s.jsxs(l,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"Authing状态"}),s.jsx(g,{variant:C?"default":"secondary",children:C?"已登录":"未登录"})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"本地状态"}),s.jsx(g,{variant:_?"default":"secondary",children:_?"已认证":"未认证"})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"text-sm font-medium",children:"加载状态"}),s.jsx(g,{variant:D?"secondary":"default",children:D?"加载中":"就绪"})]})]}),T&&s.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"当前用户信息"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsxs("p",{children:["ID: ",T.id]}),s.jsxs("p",{children:["昵称: ",T.nickname||"未设置"]}),s.jsxs("p",{children:["邮箱: ",T.email||"未设置"]}),s.jsxs("p",{children:["手机: ",T.phone||"未设置"]})]})]})]})]}),s.jsxs(i,{className:"mb-6",children:[s.jsx(n,{children:s.jsxs(c,{className:"flex items-center gap-2",children:[s.jsx(p,{className:"w-5 h-5"}),"测试控制"]})}),s.jsx(l,{children:s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs(d,{onClick:async()=>{J(!0),z([]);try{const s=await(async()=>{const s=[];try{const e=o();e.appId&&e.host?s.push({name:"Authing配置检查",status:"success",message:"配置完整",details:e}):s.push({name:"Authing配置检查",status:"error",message:"配置不完整",details:e});const a={VITE_AUTHING_APP_ID:"6867fdc88034eb95ae86167d",VITE_AUTHING_HOST:"https://qutkgzkfaezk-demo.authing.cn",VITE_AUTHING_REDIRECT_URI:void 0},t=Object.values(a).some(s=>s);s.push({name:"环境变量检查",status:t?"success":"warning",message:t?"环境变量已配置":"使用默认配置",details:a}),H?s.push({name:"Guard实例检查",status:"success",message:"Guard实例已创建",details:{guardType:H.constructor.name}}):s.push({name:"Guard实例检查",status:"error",message:"Guard实例未创建",details:null})}catch(e){s.push({name:"配置检查",status:"error",message:"配置检查失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),e=await(async()=>{const s=[];try{const e=o(),a=await fetch(`${e.host}/api/v3/applications/${e.appId}`,{method:"GET",headers:{"Content-Type":"application/json"}});a.ok?s.push({name:"Authing服务连接",status:"success",message:"连接正常",details:{status:a.status}}):s.push({name:"Authing服务连接",status:"error",message:`连接失败: ${a.status}`,details:{status:a.status}})}catch(e){s.push({name:"Authing服务连接",status:"error",message:"连接失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),a=await(async()=>{const s=[];try{if(H){const e=await R();s.push({name:"Authing登录状态",status:e?"success":"warning",message:e?"用户已登录":"用户未登录",details:{isLoggedIn:e}})}if(s.push({name:"本地认证状态",status:_?"success":"warning",message:_?"本地认证有效":"本地未认证",details:{isAuthenticated:_,status:k,hasUser:!!T}}),_&&T&&S){const e=T.id===S.id;s.push({name:"用户信息同步",status:e?"success":"warning",message:e?"用户信息已同步":"用户信息不同步",details:{localUserId:T.id,authingUserId:S.id}})}else(_||C)&&s.push({name:"用户信息同步",status:"warning",message:"部分用户信息缺失",details:{hasLocalUser:!!T,hasAuthingUser:!!S}})}catch(e){s.push({name:"认证状态测试",status:"error",message:"认证测试失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),t=await(async()=>{const s=[];try{const a={test:"data",timestamp:Date.now()};u.setItem("test_key",a);const t=u.getItem("test_key");u.removeItem("test_key");const r=JSON.stringify(t)===JSON.stringify(a);s.push({name:"安全存储功能",status:r?"success":"error",message:r?"安全存储正常":"安全存储异常",details:{testData:a,retrievedData:t}});try{h.secureLog("测试安全日志",{test:!0}),s.push({name:"安全日志功能",status:"success",message:"安全日志正常",details:{timestamp:(new Date).toISOString()}})}catch(e){s.push({name:"安全日志功能",status:"error",message:"安全日志异常",details:e instanceof Error?e.message:"未知错误"})}}catch(e){s.push({name:"安全功能测试",status:"error",message:"安全测试失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),r=[...s,...e,...a,...t];z(r);const i=r.filter(s=>"success"===s.status).length,n=r.filter(s=>"error"===s.status).length;E({title:"测试完成",description:`成功: ${i}, 错误: ${n}, 总计: ${r.length}`,variant:n>0?"destructive":"default"})}catch(s){E({title:"测试失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}finally{J(!1)}},disabled:P,className:"flex items-center gap-2",children:[P?s.jsx(j,{className:"w-4 h-4 animate-spin"}):s.jsx(j,{className:"w-4 h-4"}),P?"测试中...":"运行完整测试"]}),s.jsxs(d,{onClick:()=>{H?(V(),E({title:"登录界面已打开",description:"请完成登录流程"})):E({title:"登录失败",description:"Guard实例未初始化",variant:"destructive"})},variant:"outline",className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4"}),"手动登录测试"]}),s.jsxs(d,{onClick:async()=>{try{await L(),G(),E({title:"登出成功",description:"已清除所有认证信息"})}catch(s){E({title:"登出失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}},variant:"outline",className:"flex items-center gap-2",children:[s.jsx(N,{className:"w-4 h-4"}),"手动登出测试"]}),s.jsxs(d,{onClick:async()=>{try{const s=await O();s?(U(s),E({title:"用户信息已刷新",description:"用户信息已更新"})):E({title:"刷新失败",description:"无法获取用户信息",variant:"destructive"})}catch(s){E({title:"刷新失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}},variant:"outline",className:"flex items-center gap-2",children:[s.jsx(j,{className:"w-4 h-4"}),"刷新用户信息"]}),s.jsxs(d,{onClick:()=>B(!q),variant:"ghost",className:"flex items-center gap-2",children:[q?s.jsx(y,{className:"w-4 h-4"}):s.jsx(v,{className:"w-4 h-4"}),q?"隐藏详情":"显示详情"]})]})})]}),$.length>0&&s.jsxs(i,{children:[s.jsxs(n,{children:[s.jsxs(c,{className:"flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5"}),"测试结果"]}),s.jsxs(m,{children:["共 ",$.length," 项测试，成功 ",$.filter(s=>"success"===s.status).length," 项"]})]}),s.jsx(l,{children:s.jsx("div",{className:"space-y-4",children:$.map((e,a)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[M(e.status),s.jsx("span",{className:"font-medium",children:e.name})]}),s.jsx(g,{className:Q(e.status),children:e.status})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.message}),q&&e.details&&s.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:s.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(e.details,null,2)})})]},a))})})]}),s.jsxs(i,{className:"mt-6",children:[s.jsx(n,{children:s.jsx(c,{children:"当前配置信息"})}),s.jsx(l,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Authing配置"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("p",{children:["App ID: ",o().appId]}),s.jsxs("p",{children:["Host: ",o().host]}),s.jsxs("p",{children:["Redirect URI: ",o().redirectUri]}),s.jsxs("p",{children:["Mode: ",o().mode]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"环境变量"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("p",{children:["VITE_AUTHING_APP_ID: ","6867fdc88034eb95ae86167d"]}),s.jsxs("p",{children:["VITE_AUTHING_HOST: ","https://qutkgzkfaezk-demo.authing.cn"]}),s.jsxs("p",{children:["VITE_AUTHING_REDIRECT_URI: ","未设置"]})]})]})]})})]})]})}export{E as default};
