import{u as s,_ as e,aB as a,r as t,j as r,C as i,e as n,f as c,ax as l,i as d,g as m,S as u,B as h,R as o,k as x,h as g,bk as p,aE as j,l as f,m as N,bl as y,aD as w}from"./index-CYvVoP-H.js";import{L as v}from"./log-in-D4Qc1_mp.js";import{L as b}from"./log-out-B1dfFBRV.js";import{E as I}from"./eye-off-C_l2G0aq.js";import{E as A}from"./eye-ByDiXS3B.js";function E(){const{toast:E}=s(),{user:_,isAuthenticated:k,status:T,login:U,logout:G}=e(),{user:S,isLoggedIn:D,loading:C,guard:H,checkLoginStatus:L,getCurrentUser:R,logout:O,showLogin:V,hideLogin:$}=a(),[z,P]=t.useState([]),[J,q]=t.useState(!1),[B,M]=t.useState(!1),F=s=>{switch(s){case"success":return r.jsx(N,{className:"w-4 h-4 text-green-500"});case"error":return r.jsx(f,{className:"w-4 h-4 text-red-500"});case"warning":return r.jsx(j,{className:"w-4 h-4 text-yellow-500"});default:return r.jsx(j,{className:"w-4 h-4 text-gray-500"})}},K=s=>{switch(s){case"success":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return r.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[r.jsxs("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Authing 登录系统测试"}),r.jsx("p",{className:"text-gray-600",children:"全面测试 Authing 登录系统的配置、连接、认证和安全功能"})]}),r.jsxs(i,{className:"mb-6",children:[r.jsx(n,{children:r.jsxs(c,{className:"flex items-center gap-2",children:[r.jsx(l,{className:"w-5 h-5"}),"当前状态概览"]})}),r.jsxs(d,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-sm font-medium",children:"Authing状态"}),r.jsx(m,{variant:D?"default":"secondary",children:D?"已登录":"未登录"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-sm font-medium",children:"本地状态"}),r.jsx(m,{variant:k?"default":"secondary",children:k?"已认证":"未认证"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-sm font-medium",children:"加载状态"}),r.jsx(m,{variant:C?"secondary":"default",children:C?"加载中":"就绪"})]})]}),_&&r.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"当前用户信息"}),r.jsxs("div",{className:"text-sm text-blue-800",children:[r.jsxs("p",{children:["ID: ",_.id]}),r.jsxs("p",{children:["昵称: ",_.nickname||"未设置"]}),r.jsxs("p",{children:["邮箱: ",_.email||"未设置"]}),r.jsxs("p",{children:["手机: ",_.phone||"未设置"]})]})]})]})]}),r.jsxs(i,{className:"mb-6",children:[r.jsx(n,{children:r.jsxs(c,{className:"flex items-center gap-2",children:[r.jsx(u,{className:"w-5 h-5"}),"测试控制"]})}),r.jsx(d,{children:r.jsxs("div",{className:"flex flex-wrap gap-3",children:[r.jsxs(h,{onClick:async()=>{q(!0),P([]);try{const s=await(async()=>{const s=[];try{const e=p();e.appId&&e.host?s.push({name:"Authing配置检查",status:"success",message:"配置完整",details:e}):s.push({name:"Authing配置检查",status:"error",message:"配置不完整",details:e});const a={VITE_AUTHING_APP_ID:"6867fdc88034eb95ae86167d",VITE_AUTHING_HOST:"https://qutkgzkfaezk-demo.authing.cn",VITE_AUTHING_REDIRECT_URI:void 0},t=Object.values(a).some(s=>s);s.push({name:"环境变量检查",status:t?"success":"warning",message:t?"环境变量已配置":"使用默认配置",details:a}),H?s.push({name:"Guard实例检查",status:"success",message:"Guard实例已创建",details:{guardType:H.constructor.name}}):s.push({name:"Guard实例检查",status:"error",message:"Guard实例未创建",details:null})}catch(e){s.push({name:"配置检查",status:"error",message:"配置检查失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),e=await(async()=>{const s=[];try{const e=p(),a=await fetch(`${e.host}/api/v3/applications/${e.appId}`,{method:"GET",headers:{"Content-Type":"application/json"}});a.ok?s.push({name:"Authing服务连接",status:"success",message:"连接正常",details:{status:a.status}}):s.push({name:"Authing服务连接",status:"error",message:`连接失败: ${a.status}`,details:{status:a.status}})}catch(e){s.push({name:"Authing服务连接",status:"error",message:"连接失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),a=await(async()=>{const s=[];try{if(H){const e=await L();s.push({name:"Authing登录状态",status:e?"success":"warning",message:e?"用户已登录":"用户未登录",details:{isLoggedIn:e}})}if(s.push({name:"本地认证状态",status:k?"success":"warning",message:k?"本地认证有效":"本地未认证",details:{isAuthenticated:k,status:T,hasUser:!!_}}),k&&_&&S){const e=_.id===S.id;s.push({name:"用户信息同步",status:e?"success":"warning",message:e?"用户信息已同步":"用户信息不同步",details:{localUserId:_.id,authingUserId:S.id}})}else(k||D)&&s.push({name:"用户信息同步",status:"warning",message:"部分用户信息缺失",details:{hasLocalUser:!!_,hasAuthingUser:!!S}})}catch(e){s.push({name:"认证状态测试",status:"error",message:"认证测试失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),t=await(async()=>{const s=[];try{const a={test:"data",timestamp:Date.now()};y.setItem("test_key",a);const t=y.getItem("test_key");y.removeItem("test_key");const r=JSON.stringify(t)===JSON.stringify(a);s.push({name:"安全存储功能",status:r?"success":"error",message:r?"安全存储正常":"安全存储异常",details:{testData:a,retrievedData:t}});try{w.secureLog("测试安全日志",{test:!0}),s.push({name:"安全日志功能",status:"success",message:"安全日志正常",details:{timestamp:(new Date).toISOString()}})}catch(e){s.push({name:"安全日志功能",status:"error",message:"安全日志异常",details:e instanceof Error?e.message:"未知错误"})}}catch(e){s.push({name:"安全功能测试",status:"error",message:"安全测试失败",details:e instanceof Error?e.message:"未知错误"})}return s})(),r=[...s,...e,...a,...t];P(r);const i=r.filter(s=>"success"===s.status).length,n=r.filter(s=>"error"===s.status).length;E({title:"测试完成",description:`成功: ${i}, 错误: ${n}, 总计: ${r.length}`,variant:n>0?"destructive":"default"})}catch(s){E({title:"测试失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}finally{q(!1)}},disabled:J,className:"flex items-center gap-2",children:[J?r.jsx(o,{className:"w-4 h-4 animate-spin"}):r.jsx(o,{className:"w-4 h-4"}),J?"测试中...":"运行完整测试"]}),r.jsxs(h,{onClick:()=>{H?(V(),E({title:"登录界面已打开",description:"请完成登录流程"})):E({title:"登录失败",description:"Guard实例未初始化",variant:"destructive"})},variant:"outline",className:"flex items-center gap-2",children:[r.jsx(v,{className:"w-4 h-4"}),"手动登录测试"]}),r.jsxs(h,{onClick:async()=>{try{await O(),G(),E({title:"登出成功",description:"已清除所有认证信息"})}catch(s){E({title:"登出失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}},variant:"outline",className:"flex items-center gap-2",children:[r.jsx(b,{className:"w-4 h-4"}),"手动登出测试"]}),r.jsxs(h,{onClick:async()=>{try{await R()?(U(),E({title:"用户信息已刷新",description:"用户信息已更新"})):E({title:"刷新失败",description:"无法获取用户信息",variant:"destructive"})}catch(s){E({title:"刷新失败",description:s instanceof Error?s.message:"未知错误",variant:"destructive"})}},variant:"outline",className:"flex items-center gap-2",children:[r.jsx(o,{className:"w-4 h-4"}),"刷新用户信息"]}),r.jsxs(h,{onClick:()=>M(!B),variant:"ghost",className:"flex items-center gap-2",children:[B?r.jsx(I,{className:"w-4 h-4"}):r.jsx(A,{className:"w-4 h-4"}),B?"隐藏详情":"显示详情"]})]})})]}),z.length>0&&r.jsxs(i,{children:[r.jsxs(n,{children:[r.jsxs(c,{className:"flex items-center gap-2",children:[r.jsx(x,{className:"w-5 h-5"}),"测试结果"]}),r.jsxs(g,{children:["共 ",z.length," 项测试，成功 ",z.filter(s=>"success"===s.status).length," 项"]})]}),r.jsx(d,{children:r.jsx("div",{className:"space-y-4",children:z.map((s,e)=>r.jsxs("div",{className:"border rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[F(s.status),r.jsx("span",{className:"font-medium",children:s.name})]}),r.jsx(m,{className:K(s.status),children:s.status})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.message}),B&&s.details&&r.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:r.jsx("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(s.details,null,2)})})]},e))})})]}),r.jsxs(i,{className:"mt-6",children:[r.jsx(n,{children:r.jsx(c,{children:"当前配置信息"})}),r.jsx(d,{children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium mb-2",children:"Authing配置"}),r.jsxs("div",{className:"text-sm space-y-1",children:[r.jsxs("p",{children:["App ID: ",p().appId]}),r.jsxs("p",{children:["Host: ",p().host]}),r.jsxs("p",{children:["Redirect URI: ",p().redirectUri]}),r.jsxs("p",{children:["Mode: ",p().mode]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium mb-2",children:"环境变量"}),r.jsxs("div",{className:"text-sm space-y-1",children:[r.jsxs("p",{children:["VITE_AUTHING_APP_ID: ","6867fdc88034eb95ae86167d"]}),r.jsxs("p",{children:["VITE_AUTHING_HOST: ","https://qutkgzkfaezk-demo.authing.cn"]}),r.jsxs("p",{children:["VITE_AUTHING_REDIRECT_URI: ","未设置"]})]})]})]})})]})]})}export{E as default};
