import{bh as e,bi as n,r as i,j as s}from"./index-BuR5xlXm.js";function a(){const i=e(),s=[],a=[],d=!!i.openai.apiKey,l=n(i.openai.apiKey,"openai");!d&&i.features.enableAI?s.push("OpenAI API密钥未配置 (VITE_OPENAI_API_KEY)"):d&&!l&&s.push("OpenAI API密钥格式无效");const r=!!i.deepseek.apiKey,t=n(i.deepseek.apiKey,"deepseek");r&&!t&&a.push("DeepSeek API密钥格式可能无效");const c=!!i.gemini.apiKey,o=n(i.gemini.apiKey,"gemini");c&&!o&&a.push("Gemini API密钥格式可能无效");const g=!(!i.authing.appId||!i.authing.host),u=g&&!!i.authing.redirectUri;g?u||s.push("Authing回调地址未配置"):s.push("Authing配置不完整 (需要VITE_AUTHING_APP_ID和VITE_AUTHING_HOST)");const h=!!i.backend.baseUrl,m=h&&i.backend.baseUrl.startsWith("http");h?m||s.push("后端API基础URL格式无效"):s.push("后端API基础URL未配置 (VITE_API_BASE_URL)");const p=!(!i.payment.alipay.appId||!i.payment.alipay.publicKey),x=!(!i.payment.wechat.appId||!i.payment.wechat.mchId),b=p||x;return b||a.push("支付配置未设置 (支付宝或微信支付)"),{isValid:0===s.length,errors:s,warnings:a,config:{openai:{configured:d,valid:l},deepseek:{configured:r,valid:t},gemini:{configured:c,valid:o},authing:{configured:g,valid:u},backend:{configured:h,valid:m},payment:{configured:b,valid:b}}}}function d(){const n=a(),i=e();let s="🔧 API配置状态:\n";return s+="\n🌍 环境: "+(i.environment.isDev?"开发":"生产"),s+="\n🔍 调试模式: "+(i.environment.debugMode?"开启":"关闭"),s+="\n\n🤖 AI服务:",s+="\n  OpenAI: "+(n.config.openai.configured?n.config.openai.valid?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"),s+="\n  DeepSeek: "+(n.config.deepseek.configured?n.config.deepseek.valid?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"),s+="\n  Gemini: "+(n.config.gemini.configured?n.config.gemini.valid?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"),s+="\n\n🔐 认证服务:",s+="\n  Authing: "+(n.config.authing.configured?n.config.authing.valid?"✅ 已配置":"⚠️ 回调地址缺失":"❌ 未配置"),s+="\n\n🔧 后端服务:",s+="\n  API: "+(n.config.backend.configured?n.config.backend.valid?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"),s+="\n\n💳 支付服务:",s+="\n  支付: "+(n.config.payment.configured?"✅ 已配置":"❌ 未配置"),n.errors.length>0&&(s+="\n\n❌ 错误:",n.errors.forEach(e=>{s+=`\n  - ${e}`})),n.warnings.length>0&&(s+="\n\n⚠️ 警告:",n.warnings.forEach(e=>{s+=`\n  - ${e}`})),s}function l(){const e=a(),n=[];return e.config.openai.configured||n.push("配置OpenAI API密钥以启用AI功能"),e.config.authing.configured||n.push("配置Authing认证服务以启用用户登录"),e.config.backend.configured||n.push("配置后端API地址以启用完整功能"),e.config.payment.configured||n.push("配置支付服务以启用付费功能"),e.config.openai.configured&&!e.config.deepseek.configured&&n.push("考虑配置DeepSeek API作为备用AI服务"),n}const r=()=>{var n,r,t,c,o,g,u,h;const[m,p]=i.useState(null),[x,b]=i.useState(""),[f,v]=i.useState([]),[y,j]=i.useState(!0),[N,k]=i.useState({});return i.useEffect(()=>{const e=a(),n=d(),i=l();p(e),b(n),v(i),j(!1)},[]),y?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"正在检查API配置..."})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"API配置测试"}),s.jsx("p",{className:"text-gray-600",children:"验证所有API配置是否正确设置"})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"配置状态概览"}),s.jsx("button",{onClick:()=>{j(!0),setTimeout(()=>{const e=a(),n=d(),i=l();p(e),b(n),v(i),j(!1)},100)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"刷新配置"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.openai.configured)&&(null==m?void 0:m.config.openai.valid)?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"OpenAI"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.openai.configured)?(null==m?void 0:m.config.openai.valid)?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"})]}),s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.deepseek.configured)&&(null==m?void 0:m.config.deepseek.valid)?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"DeepSeek"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.deepseek.configured)?(null==m?void 0:m.config.deepseek.valid)?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"})]}),s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.gemini.configured)&&(null==m?void 0:m.config.gemini.valid)?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Gemini"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.gemini.configured)?(null==m?void 0:m.config.gemini.valid)?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"})]}),s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.authing.configured)&&(null==m?void 0:m.config.authing.valid)?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"Authing"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.authing.configured)?(null==m?void 0:m.config.authing.valid)?"✅ 已配置":"⚠️ 回调地址缺失":"❌ 未配置"})]}),s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.backend.configured)&&(null==m?void 0:m.config.backend.valid)?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"后端API"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.backend.configured)?(null==m?void 0:m.config.backend.valid)?"✅ 已配置":"⚠️ 格式错误":"❌ 未配置"})]}),s.jsxs("div",{className:"p-4 rounded-lg border "+((null==m?void 0:m.config.payment.configured)?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[s.jsx("h3",{className:"font-medium text-gray-900",children:"支付服务"}),s.jsx("p",{className:"text-sm text-gray-600",children:(null==m?void 0:m.config.payment.configured)?"✅ 已配置":"❌ 未配置"})]})]}),(null==m?void 0:m.errors.length)>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-red-600 font-medium mb-2",children:"❌ 配置错误:"}),s.jsx("ul",{className:"list-disc list-inside text-red-600 space-y-1",children:m.errors.map((e,n)=>s.jsx("li",{children:e},n))})]}),(null==m?void 0:m.warnings.length)>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-yellow-600 font-medium mb-2",children:"⚠️ 配置警告:"}),s.jsx("ul",{className:"list-disc list-inside text-yellow-600 space-y-1",children:m.warnings.map((e,n)=>s.jsx("li",{children:e},n))})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"API连接测试"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"OpenAI API"}),s.jsx("button",{onClick:async()=>{k(e=>({...e,openai:{loading:!0}}));try{const e=await fetch("/.netlify/functions/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:"openai",action:"status"})}),n=await e.json();k(i=>({...i,openai:{loading:!1,success:e.ok,data:n}}))}catch(e){k(n=>({...n,openai:{loading:!1,success:!1,error:e instanceof Error?e.message:"未知错误"}}))}},disabled:null==(n=N.openai)?void 0:n.loading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:(null==(r=N.openai)?void 0:r.loading)?"测试中...":"测试连接"}),N.openai&&s.jsx("div",{className:"mt-2 text-sm",children:N.openai.success?s.jsx("span",{className:"text-green-600",children:"✅ 连接成功"}):s.jsxs("span",{className:"text-red-600",children:["❌ 连接失败: ",N.openai.error]})})]}),s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"DeepSeek API"}),s.jsx("button",{onClick:async()=>{k(e=>({...e,deepseek:{loading:!0}}));try{const e=await fetch("/.netlify/functions/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:"deepseek",action:"status"})}),n=await e.json();k(i=>({...i,deepseek:{loading:!1,success:e.ok,data:n}}))}catch(e){k(n=>({...n,deepseek:{loading:!1,success:!1,error:e instanceof Error?e.message:"未知错误"}}))}},disabled:null==(t=N.deepseek)?void 0:t.loading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:(null==(c=N.deepseek)?void 0:c.loading)?"测试中...":"测试连接"}),N.deepseek&&s.jsx("div",{className:"mt-2 text-sm",children:N.deepseek.success?s.jsx("span",{className:"text-green-600",children:"✅ 连接成功"}):s.jsxs("span",{className:"text-red-600",children:["❌ 连接失败: ",N.deepseek.error]})})]}),s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Authing配置"}),s.jsx("button",{onClick:async()=>{k(e=>({...e,authing:{loading:!0}}));try{const n=e(),i=!!(n.authing.appId&&n.authing.host&&n.authing.redirectUri);k(e=>({...e,authing:{loading:!1,success:i,data:{appId:n.authing.appId,host:n.authing.host,redirectUri:n.authing.redirectUri}}}))}catch(n){k(e=>({...e,authing:{loading:!1,success:!1,error:n instanceof Error?n.message:"未知错误"}}))}},disabled:null==(o=N.authing)?void 0:o.loading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:(null==(g=N.authing)?void 0:g.loading)?"测试中...":"测试配置"}),N.authing&&s.jsx("div",{className:"mt-2 text-sm",children:N.authing.success?s.jsx("span",{className:"text-green-600",children:"✅ 配置正确"}):s.jsxs("span",{className:"text-red-600",children:["❌ 配置错误: ",N.authing.error]})})]}),s.jsxs("div",{className:"p-4 border rounded-lg",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"后端API"}),s.jsx("button",{onClick:async()=>{k(e=>({...e,backend:{loading:!0}}));try{const n=e(),i=await fetch(`${n.backend.baseUrl}/health`,{method:"GET",headers:{"Content-Type":"application/json"}}),s=await i.json();k(e=>({...e,backend:{loading:!1,success:i.ok,data:s}}))}catch(n){k(e=>({...e,backend:{loading:!1,success:!1,error:n instanceof Error?n.message:"未知错误"}}))}},disabled:null==(u=N.backend)?void 0:u.loading,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:(null==(h=N.backend)?void 0:h.loading)?"测试中...":"测试连接"}),N.backend&&s.jsx("div",{className:"mt-2 text-sm",children:N.backend.success?s.jsx("span",{className:"text-green-600",children:"✅ 连接成功"}):s.jsxs("span",{className:"text-red-600",children:["❌ 连接失败: ",N.backend.error]})})]})]})]}),f.length>0&&s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"配置建议"}),s.jsx("ul",{className:"list-disc list-inside text-gray-700 space-y-2",children:f.map((e,n)=>s.jsx("li",{children:e},n))})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"详细配置信息"}),s.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg text-sm overflow-x-auto whitespace-pre-wrap",children:x})]})]})})};export{r as default};
