<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¯ä»˜è®¡æ—¶å™¨åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-section h2 {
            margin-top: 0;
            color: #ffd700;
            font-size: 1.5em;
        }
        .button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .button:active {
            transform: translateY(0);
        }
        .status {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .timer {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin: 20px 0;
        }
        .info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #ffd700;
        }
        .success {
            color: #2ecc71;
        }
        .error {
            color: #e74c3c;
        }
        .warning {
            color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ æ–°ç”¨æˆ·é™æ—¶ä¼˜æƒ åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
            <div class="timer" id="timer">--:--</div>
            <div class="status" id="status">æ­£åœ¨æ£€æŸ¥çŠ¶æ€...</div>
        </div>

        <div class="test-section">
            <h2>ğŸ® æµ‹è¯•æ“ä½œ</h2>
            <button class="button" onclick="simulateAccess()">ğŸš€ æ¨¡æ‹Ÿè®¿é—®æ”¯ä»˜ä¸­å¿ƒ</button>
            <button class="button" onclick="resetTimer()">ğŸ”„ é‡ç½®è®¡æ—¶å™¨</button>
            <button class="button" onclick="checkStatus()">ğŸ“‹ æ£€æŸ¥çŠ¶æ€</button>
            <button class="button" onclick="clearStorage()">ğŸ—‘ï¸ æ¸…é™¤å­˜å‚¨</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“ æµ‹è¯•è¯´æ˜</h2>
            <div class="info">
                <p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
                <ul>
                    <li>æ–°ç”¨æˆ·é™æ—¶ä¼˜æƒ ä»è®¿é—®æ”¯ä»˜ä¸­å¿ƒé¡µé¢å¼€å§‹è®¡æ—¶30åˆ†é’Ÿ</li>
                    <li>ä½¿ç”¨localStorageå­˜å‚¨è®¿é—®æ—¶é—´</li>
                    <li>æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹è®¡æ—¶ï¼Œäº’ä¸å½±å“</li>
                    <li>å®æ—¶å€’è®¡æ—¶æ˜¾ç¤ºå‰©ä½™æ—¶é—´</li>
                </ul>
            </div>
            <div class="info">
                <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong></p>
                <ol>
                    <li>ç‚¹å‡»"æ¨¡æ‹Ÿè®¿é—®æ”¯ä»˜ä¸­å¿ƒ"å¼€å§‹è®¡æ—¶</li>
                    <li>è§‚å¯Ÿå€’è®¡æ—¶å˜åŒ–</li>
                    <li>ç­‰å¾…30åˆ†é’Ÿæˆ–ç‚¹å‡»"é‡ç½®è®¡æ—¶å™¨"æµ‹è¯•ç»“æŸçŠ¶æ€</li>
                    <li>ä½¿ç”¨"æ£€æŸ¥çŠ¶æ€"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
                </ol>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”— ç›¸å…³é“¾æ¥</h2>
            <div class="info">
                <p><strong>å®é™…é¡µé¢æµ‹è¯•ï¼š</strong></p>
                <ul>
                    <li><a href="http://localhost:5173/payment" target="_blank" style="color: #ffd700;">æ”¯ä»˜ä¸­å¿ƒé¡µé¢</a></li>
                    <li><a href="http://localhost:5173/payment-timer-test" target="_blank" style="color: #ffd700;">æ”¯ä»˜è®¡æ—¶å™¨æµ‹è¯•é¡µé¢</a></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·ID
        const TEST_USER_ID = 'test_user_123';
        const PROMO_DURATION = 30 * 60 * 1000; // 30åˆ†é’Ÿ
        let timerInterval;

        // è·å–æ”¯ä»˜ä¸­å¿ƒè®¿é—®æ—¶é—´
        function getPaymentCenterAccessTime(userId) {
            const accessTimeKey = `payment_center_access_time_${userId}`;
            const accessTime = localStorage.getItem(accessTimeKey);
            
            if (accessTime) {
                return new Date(parseInt(accessTime, 10));
            }
            
            return null;
        }

        // è®¡ç®—å‰©ä½™æ—¶é—´
        function calculateRemainingTime(userId) {
            const accessTime = getPaymentCenterAccessTime(userId);
            if (!accessTime) return 0;
            
            const now = new Date();
            const timeDiff = now.getTime() - accessTime.getTime();
            return Math.max(0, PROMO_DURATION - timeDiff);
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTimeLeft(timeLeft) {
            if (timeLeft <= 0) return 'å·²ç»“æŸ';
            
            const minutes = Math.floor(timeLeft / 60000);
            const seconds = Math.floor((timeLeft % 60000) / 1000);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const remaining = calculateRemainingTime(TEST_USER_ID);
            const accessTime = getPaymentCenterAccessTime(TEST_USER_ID);
            
            document.getElementById('timer').textContent = formatTimeLeft(remaining);
            
            let statusText = '';
            if (accessTime) {
                statusText += `è®¿é—®æ—¶é—´: ${accessTime.toLocaleString()}\n`;
                statusText += `å½“å‰æ—¶é—´: ${new Date().toLocaleString()}\n`;
                statusText += `å‰©ä½™æ—¶é—´: ${formatTimeLeft(remaining)}\n`;
                statusText += `ä¼˜æƒ çŠ¶æ€: ${remaining > 0 ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}\n`;
                statusText += `å­˜å‚¨é”®å: payment_center_access_time_${TEST_USER_ID}`;
            } else {
                statusText = 'æœªå¼€å§‹è®¡æ—¶';
            }
            
            document.getElementById('status').textContent = statusText;
        }

        // æ¨¡æ‹Ÿè®¿é—®æ”¯ä»˜ä¸­å¿ƒ
        function simulateAccess() {
            const accessTimeKey = `payment_center_access_time_${TEST_USER_ID}`;
            const now = new Date();
            localStorage.setItem(accessTimeKey, now.getTime().toString());
            
            console.log('ğŸ‰ æ–°ç”¨æˆ·é™æ—¶ä¼˜æƒ å¼€å§‹è®¡æ—¶ï¼', now.toLocaleString());
            updateDisplay();
            
            // å¼€å§‹å®šæ—¶å™¨
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateDisplay, 1000);
        }

        // é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            const accessTimeKey = `payment_center_access_time_${TEST_USER_ID}`;
            localStorage.removeItem(accessTimeKey);
            console.log('ğŸ”„ æ”¯ä»˜ä¸­å¿ƒè®¿é—®æ—¶é—´å·²é‡ç½®');
            updateDisplay();
        }

        // æ£€æŸ¥çŠ¶æ€
        function checkStatus() {
            updateDisplay();
            console.log('ğŸ“‹ çŠ¶æ€æ£€æŸ¥å®Œæˆ');
        }

        // æ¸…é™¤å­˜å‚¨
        function clearStorage() {
            localStorage.clear();
            console.log('ğŸ—‘ï¸ æ‰€æœ‰localStorageæ•°æ®å·²æ¸…é™¤');
            updateDisplay();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            timerInterval = setInterval(updateDisplay, 1000);
        });
    </script>
</body>
</html> 